<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>G's-Sapporo-Dev03</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="note/index.html"><strong aria-hidden="true">1.</strong> 講義資料ノート</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="note/about.html"><strong aria-hidden="true">1.1.</strong> 受講時の注意</a></li><li class="chapter-item expanded "><a href="note/with-code.html"><strong aria-hidden="true">1.2.</strong> コードに向き合いやすくなる考え方</a></li><li class="chapter-item expanded "><a href="note/for-work.html"><strong aria-hidden="true">1.3.</strong> 課題にチャレンジするコツ</a></li></ol></li><li class="chapter-item expanded "><a href="js/index.html"><strong aria-hidden="true">2.</strong> JavaScript</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js01/index.html"><strong aria-hidden="true">2.1.</strong> JS_おみくじ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/index.html"><strong aria-hidden="true">2.1.1.</strong> JavaScript とは</a></li><li class="chapter-item expanded "><a href="components/variable.html"><strong aria-hidden="true">2.1.2.</strong> 変数と計算</a></li><li class="chapter-item expanded "><a href="components/random.html"><strong aria-hidden="true">2.1.3.</strong> ランダムな数（乱数）をつくる</a></li><li class="chapter-item expanded "><a href="components/if.html"><strong aria-hidden="true">2.1.4.</strong> 条件分岐</a></li><li class="chapter-item expanded "><a href="js/js01/omikuji.html"><strong aria-hidden="true">2.1.5.</strong> おみくじの Web アプリ実装</a></li><li class="chapter-item expanded "><a href="js/js01/work.html"><strong aria-hidden="true">2.1.6.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="js/js02/index.html"><strong aria-hidden="true">2.2.</strong> JS_メモパッド</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="components/array.html"><strong aria-hidden="true">2.2.1.</strong> 配列</a></li><li class="chapter-item expanded "><a href="components/for.html"><strong aria-hidden="true">2.2.2.</strong> 繰り返し処理</a></li><li class="chapter-item expanded "><a href="components/object.html"><strong aria-hidden="true">2.2.3.</strong> オブジェクト</a></li><li class="chapter-item expanded "><a href="js/js02/memopad01.html"><strong aria-hidden="true">2.2.4.</strong> LocalStorage（メモ帳初級）</a></li><li class="chapter-item expanded "><a href="js/js02/memopad02.html"><strong aria-hidden="true">2.2.5.</strong> JSON データ（メモ帳中級）</a></li><li class="chapter-item expanded "><a href="js/js02/work.html"><strong aria-hidden="true">2.2.6.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="js/js04/index.html"><strong aria-hidden="true">2.3.</strong> JS_Firebase</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="components/function.html"><strong aria-hidden="true">2.3.1.</strong> 関数</a></li><li class="chapter-item expanded "><a href="js/js04/chat-app.html"><strong aria-hidden="true">2.3.2.</strong> リアルタイムチャットの実装</a></li><li class="chapter-item expanded "><a href="js/js04/firebase-project.html"><strong aria-hidden="true">2.3.3.</strong> Firebase の準備 1（プロジェクトの作成）</a></li><li class="chapter-item expanded "><a href="js/js04/firebase-js.html"><strong aria-hidden="true">2.3.4.</strong> Firebase の準備 2（ソースコードの準備）</a></li><li class="chapter-item expanded "><a href="js/js04/firebase-db.html"><strong aria-hidden="true">2.3.5.</strong> Firebase の準備 3（データベースの準備）</a></li><li class="chapter-item expanded "><a href="js/js04/chat-create.html"><strong aria-hidden="true">2.3.6.</strong> チャット画面の実装とデータの送信</a></li><li class="chapter-item expanded "><a href="js/js04/chat-read.html"><strong aria-hidden="true">2.3.7.</strong> データのリアルタイム取得と画面表示</a></li><li class="chapter-item expanded "><a href="js/js04/optimize.html"><strong aria-hidden="true">2.3.8.</strong> 機能追加</a></li><li class="chapter-item expanded "><a href="js/js04/work.html"><strong aria-hidden="true">2.3.9.</strong> 課題と提出時の注意点</a></li></ol></li><li class="chapter-item expanded "><a href="js/js05/index.html"><strong aria-hidden="true">2.4.</strong> JS_API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js05/about-api.html"><strong aria-hidden="true">2.4.1.</strong> API とは</a></li><li class="chapter-item expanded "><a href="js/js05/booksapi.html"><strong aria-hidden="true">2.4.2.</strong> GoogleBooksAPI</a></li><li class="chapter-item expanded "><a href="js/js05/geolocation.html"><strong aria-hidden="true">2.4.3.</strong> 位置情報の活用</a></li><li class="chapter-item expanded "><a href="js/js05/bingmapsapi-setup.html"><strong aria-hidden="true">2.4.4.</strong> BingMapsAPI/準備</a></li><li class="chapter-item expanded "><a href="js/js05/bingmapsapi-map.html"><strong aria-hidden="true">2.4.5.</strong> BingMapsAPI/実践</a></li><li class="chapter-item expanded "><a href="js/js05/bingmapsapi-pin.html"><strong aria-hidden="true">2.4.6.</strong> 【おまけ】BingMapsAPI/機能追加</a></li><li class="chapter-item expanded "><a href="js/js05/other-api.html"><strong aria-hidden="true">2.4.7.</strong> その他の API 紹介</a></li><li class="chapter-item expanded "><a href="js/js05/work.html"><strong aria-hidden="true">2.4.8.</strong> 課題</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="php/index.html"><strong aria-hidden="true">3.</strong> PHP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php_setup/index.html"><strong aria-hidden="true">3.1.</strong> PHP 事前準備</a></li><li class="chapter-item expanded "><a href="php/php01/index.html"><strong aria-hidden="true">3.2.</strong> PHP 基礎</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php01/about-php.html"><strong aria-hidden="true">3.2.1.</strong> PHP 概要</a></li><li class="chapter-item expanded "><a href="php/php01/get-started.html"><strong aria-hidden="true">3.2.2.</strong> 開発の手順</a></li><li class="chapter-item expanded "><a href="php/php01/php-start.html"><strong aria-hidden="true">3.2.3.</strong> PHP 基礎</a></li><li class="chapter-item expanded "><a href="php/php01/get-post.html"><strong aria-hidden="true">3.2.4.</strong> クライアント - サーバ間の通信</a></li><li class="chapter-item expanded "><a href="php/php01/write-file.html"><strong aria-hidden="true">3.2.5.</strong> ファイル操作（書き込み）</a></li><li class="chapter-item expanded "><a href="php/php01/read-file.html"><strong aria-hidden="true">3.2.6.</strong> ファイル操作（読み込み）</a></li><li class="chapter-item expanded "><a href="php/php01/work.html"><strong aria-hidden="true">3.2.7.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="php/php02/index.html"><strong aria-hidden="true">3.3.</strong> PHP_DB 連携_CRUD 処理前半</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php02/about-db.html"><strong aria-hidden="true">3.3.1.</strong> DB の基本</a></li><li class="chapter-item expanded "><a href="php/php02/start-db.html"><strong aria-hidden="true">3.3.2.</strong> DB / テーブルの作成</a></li><li class="chapter-item expanded "><a href="php/php02/db-sql.html"><strong aria-hidden="true">3.3.3.</strong> SQL による DB 操作</a></li><li class="chapter-item expanded "><a href="php/php02/sql-create.html"><strong aria-hidden="true">3.3.4.</strong> PHP と DB の連携 1（データ作成処理）</a></li><li class="chapter-item expanded "><a href="php/php02/sql-read.html"><strong aria-hidden="true">3.3.5.</strong> PHP と DB の連携 2（データ参照処理）</a></li><li class="chapter-item expanded "><a href="php/php02/work.html"><strong aria-hidden="true">3.3.6.</strong> 課題と提出時の注意点</a></li></ol></li><li class="chapter-item expanded "><a href="php/php03/index.html"><strong aria-hidden="true">3.4.</strong> PHP_DB 連携_CRUD 処理後半</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php03/function-db-connect.html"><strong aria-hidden="true">3.4.1.</strong> DB 接続関数の作成</a></li><li class="chapter-item expanded "><a href="php/php03/sql-edit.html"><strong aria-hidden="true">3.4.2.</strong> PHP と DB の連携 3（編集画面の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-update.html"><strong aria-hidden="true">3.4.3.</strong> PHP と DB の連携 4（データ更新処理の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-delete.html"><strong aria-hidden="true">3.4.4.</strong> PHP と DB の連携 5（データ削除処理）</a></li><li class="chapter-item expanded "><a href="php/php03/work.html"><strong aria-hidden="true">3.4.5.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="php/php04/index.html"><strong aria-hidden="true">3.5.</strong> PHP_セッション</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php04/about-session.html"><strong aria-hidden="true">3.5.1.</strong> セッションとは</a></li><li class="chapter-item expanded "><a href="php/php04/session-variables.html"><strong aria-hidden="true">3.5.2.</strong> セッション変数</a></li><li class="chapter-item expanded "><a href="php/php04/auth-01.html"><strong aria-hidden="true">3.5.3.</strong> 認証処理の実装 1（ログインとログアウト）</a></li><li class="chapter-item expanded "><a href="php/php04/auth-02.html"><strong aria-hidden="true">3.5.4.</strong> 認証処理の実装 2（認証状態の確認）</a></li><li class="chapter-item expanded "><a href="php/php04/work.html"><strong aria-hidden="true">3.5.5.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="php/php05/index.html"><strong aria-hidden="true">3.6.</strong> PHP_DB 応用_RDB</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php05/about-rdb.html"><strong aria-hidden="true">3.6.1.</strong> RDB の構造</a></li><li class="chapter-item expanded "><a href="php/php05/like-add.html"><strong aria-hidden="true">3.6.2.</strong> Like 機能の実装 1（データの追加 1）</a></li><li class="chapter-item expanded "><a href="php/php05/like-delete.html"><strong aria-hidden="true">3.6.3.</strong> Like 機能の実装 2（データの追加 2）</a></li><li class="chapter-item expanded "><a href="php/php05/like-groupby.html"><strong aria-hidden="true">3.6.4.</strong> Like 機能の実装 3（データの集計）</a></li><li class="chapter-item expanded "><a href="php/php05/like-join.html"><strong aria-hidden="true">3.6.5.</strong> Like 機能の実装 4（データの結合）</a></li><li class="chapter-item expanded "><a href="php/php05/work.html"><strong aria-hidden="true">3.6.6.</strong> 課題</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">G's-Sapporo-Dev03</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="講義資料ノート"><a class="header" href="#講義資料ノート">講義資料ノート</a></h1>
<p>サンプルコードはこちら</p>
<p><a href="https://bit.ly/3rkcXH8">https://bit.ly/3rkcXH8</a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="受講時の注意"><a class="header" href="#受講時の注意">受講時の注意</a></h1>
<p>時間もお金も投資しているのだからむしり取れるだけむしり取れッ！</p>
<h2 id="講義中に意識するポイント"><a class="header" href="#講義中に意識するポイント">講義中に意識するポイント</a></h2>
<p>ただ受けているだけだと資料の内容しかものにできずもったいない！</p>
<p>まず下記は絶対厳守！！！</p>
<ul>
<li>うまくいかないときに黙っている「サイレント詰み」は犯罪！</li>
<li>まずはわからなくても「動くもの」をつくれ！</li>
<li>食糧飲料燃料の補給は各自のペースで！（自分にとって最適な状況を用意しろッ！）</li>
</ul>
<h2 id="いつでもコードを書けるように"><a class="header" href="#いつでもコードを書けるように">いつでもコードを書けるように！</a></h2>
<ul>
<li>授業中は常にエディタを起動！</li>
<li>資料も常に開いておこう！</li>
</ul>
<h2 id="講義中はまず動くものをつくれ"><a class="header" href="#講義中はまず動くものをつくれ">講義中はまず動くものをつくれ！</a></h2>
<ul>
<li>講義では一緒に1つのアプリケーションをつくる．</li>
<li>わからなくてもとにかく「動かす」．</li>
<li>課題に挑戦すると大抵うまくいかない．そのときに「講義でつくった動くもの」と「自分でつくった動かないもの」を比較して何がマズイのか探るんだッ！</li>
</ul>
<h2 id="聴くときは聴き書くときは書く"><a class="header" href="#聴くときは聴き書くときは書く">聴くときは聴き，書くときは書く！</a></h2>
<ul>
<li>初めて挑戦することなので，わからなくなって当然．．！</li>
<li>まずはしっかり説明を聴こう！</li>
<li>聴くときは聴くこと，手を動かすときは手を動かすことに集中！！</li>
</ul>
<h2 id="クラスのメンバーでお互いに刺激し合おう"><a class="header" href="#クラスのメンバーでお互いに刺激し合おう">クラスのメンバーでお互いに刺激し合おう！</a></h2>
<ul>
<li>考えたことや感じたことはslackの「ガヤチャンネル」でガンガン発信！</li>
<li>くだらないことでもOK！！意見を言うやつは偉い！！</li>
<li>誰かのコメントに乗っかろう！</li>
</ul>
<h2 id="疑問を共有しよう"><a class="header" href="#疑問を共有しよう">疑問を共有しよう！</a></h2>
<ul>
<li>質問はまずslackへ！</li>
<li>慣れないうちは「詰んだ」の一言から．詰みを表明することが大切！</li>
<li>慣れたら「エラーのスクショ」や「書いたコード」を貼ろう！</li>
<li>他の人の質問にも目を通そう！（同じ質問があるかも）</li>
</ul>
<h2 id="進捗を共有しよう"><a class="header" href="#進捗を共有しよう">進捗を共有しよう！</a></h2>
<ul>
<li>演習時，できた人はスクショなどslackに貼ってアウトプット！</li>
<li>できたら「できた」コメント！</li>
<li>詰んだら「詰んだ」コメント！</li>
<li>みなさんのコメントを見ながら講義を進めていきます！</li>
</ul>
<h2 id="詰みを脱するtips"><a class="header" href="#詰みを脱するtips">詰みを脱するTips</a></h2>
<ul>
<li>まずは打ち間違いを疑おう！
<ul>
<li><code>()</code> <code>[]</code> <code>{}</code> <code>'</code> <code>&quot;</code> <code>;</code> など</li>
</ul>
</li>
<li>書いたら保存しよう！（よく忘れる！）
<ul>
<li>Mac: <code>command + s</code></li>
<li>Windows: <code>ctrl + s</code></li>
</ul>
</li>
<li>他の人に見てもらおう！
<ul>
<li>自分の打ち間違いは10分探しても見つからないが，他人の打ち間違いは2秒で見つかる．</li>
<li>「隣の人」「slack + スクショ」「zoomのブレイクアウト」を活用するのだッ！</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="コードに向き合いやすくなる考え方"><a class="header" href="#コードに向き合いやすくなる考え方">コードに向き合いやすくなる考え方</a></h1>
<p>彼を知り己を知らば百戦危うからず．</p>
<h2 id="質問を制すものはコードを制す"><a class="header" href="#質問を制すものはコードを制す">質問を制すものはコードを制す！</a></h2>
<p>わからなかったり動かなかったりのときは遠慮なく質問せよ！</p>
<p>下記を記述するとお互いに幸せになれる確率が高まるッ！</p>
<ul>
<li>やりたいことは何か</li>
<li>どういう状態（動き）になればゴールなのか</li>
<li>どうやったか（考え方や書いたコードなど）</li>
<li>どうなったか（エラーメッセージやスクショなど）</li>
<li>調べたときのググりワード，参考にしたサイトのURL</li>
</ul>
<p>勿論最初から全部はできないので，まずは遠慮なく投稿するのが大事！</p>
<p>（足りない部分は講師チューターの方々が拾ってくれる）</p>
<h2 id="言語化が大事"><a class="header" href="#言語化が大事">言語化が大事！</a></h2>
<ul>
<li>「言語化」とは自分のやりたいことやうまくいかない現状を他の人に説明すること．</li>
<li>言語化は「できると良い」ではなく「できなければコードが書けない」のである．講師チューターは超能力者ではないので，みなさんが説明しなければ何をしたいのかわからないのだッ．．！</li>
<li>コードを書くにも「JavaScriptで何を書けばよいのか」「どうなればOKなのか」を自ら決めて明確にすることが第一歩．</li>
<li>無理矢理にでも言葉にしたら誰かにぶつけよう．誰かと議論することでより解像度が高まる．最初は「ちょっと何いってるかわからない」と言われるが，やらないと言語化のスキルは高まらない．沈黙は死．</li>
</ul>
<h2 id="正解を求める思考を捨てよ"><a class="header" href="#正解を求める思考を捨てよ">正解を求める思考を捨てよ！</a></h2>
<ul>
<li>「唯一の正解は存在しない」</li>
<li>提示されたヒントでは動かないこともあるし，それとは異なる方法でうまくいくこともある．</li>
<li>一つのやり方に固執することは地獄への一本道を進むことに似たり．</li>
<li>「効率のよいやり方」など一旦動かしてから改めて考えれば良い．力技だろうがまずは動けば良かろうなのだァァッ！！</li>
</ul>
<h2 id="コードは量という勝ちパターン"><a class="header" href="#コードは量という勝ちパターン">「コードは量」という勝ちパターン！</a></h2>
<ul>
<li>一発でうまくいくことはほぼない．特にはじめの頃は経験値が少なく「運ゲー」度が高いので，何度もやり直してうまく行くパターンを引かなければならない．</li>
<li>運ゲーをものにするには試行回数が必要で，そのためには時間が必要になる．敵の行動パターンを集めながら会心の一撃が出るまで粘れ！</li>
<li>わからなければ講義内容を10周くらいすれば何か見えてくるはず．わからないと嘆く時間があるならコードを書こう．レベルが足りないなら雑魚敵を狩って経験値を稼ごう．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題にチャレンジするコツ"><a class="header" href="#課題にチャレンジするコツ">課題にチャレンジするコツ</a></h1>
<p>課題を制すものは全てを制す．</p>
<h2 id="自分でネタを決めよ"><a class="header" href="#自分でネタを決めよ">自分でネタを決めよ！</a></h2>
<ul>
<li>誰かに言われたものをつくっても面白くない．．．</li>
<li>自分で「何をつくりあげるのか」を決断してチャレンジすることが大切！</li>
<li>「自分で決めたことをやり遂げる」のが最高にCoolッ！</li>
</ul>
<h2 id="つくりたいものをつくれ"><a class="header" href="#つくりたいものをつくれ">つくりたいものをつくれ！</a></h2>
<ul>
<li>「役に立つ」「ウケそう」ではない．．．</li>
<li>「自分がほしい物」「おもしろいと思うもの」にチャレンジすることで身が入る！</li>
<li>「誰かに褒められる感覚」よりも「全力でやりきった感覚」ッ！</li>
</ul>
<h2 id="まず見た目より動きをつくれ"><a class="header" href="#まず見た目より動きをつくれ">まず見た目より動きをつくれ！</a></h2>
<ul>
<li>プロダクトには「機能」「見た目」どちらも大事！</li>
<li>見た目を作り込むことでより「完成度の高いプロダクト」になる．</li>
<li>しかしまずは「機能」や「動き」をつくる．「見た目」はその後ッ！</li>
<li>見た目を先につくると，機能を変更したときに作り直しになる．．．</li>
</ul>
<h2 id="技術自体を楽しめ"><a class="header" href="#技術自体を楽しめ">技術自体を楽しめ！</a></h2>
<ul>
<li>技術は「アイデアを実現するためのツール」．</li>
<li>しかし技術をより深く知ることで「できることのイメージが広がる」！</li>
<li>「好きな技術」「やってて楽しい技術」を見つけよう！まずは技術にのめり込もう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="javascript"><a class="header" href="#javascript">JavaScript</a></h1>
<h2 id="javascriptの役割"><a class="header" href="#javascriptの役割">JavaScriptの役割</a></h2>
<table><thead><tr><th>言語</th><th>役割</th></tr></thead><tbody>
<tr><td>HTML（マスター済み）</td><td>コンテンツの指定<br>タイトル，文章，画像などの記述</td></tr>
<tr><td>CSS（マスター済み）</td><td>コンテンツの装飾<br>色，大きさ，配置などの指定</td></tr>
<tr><td>JavaScript</td><td>ユーザー操作，イベント発生による動きを実現<br>（わりとなんでもできる）</td></tr>
</tbody></table>
<h2 id="javascriptとは"><a class="header" href="#javascriptとは">JavaScriptとは</a></h2>
<p><strong>JavaScript ≠ JAVA</strong></p>
<p>JavaScriptとJAVAの違い</p>
<table><thead><tr><th>JavaScript</th><th>JAVA</th></tr></thead><tbody>
<tr><td>フロントエンド言語</td><td>サーバサイド言語</td></tr>
<tr><td>カモミール</td><td>カモ</td></tr>
<tr><td>オーストラリア</td><td>オーストリア</td></tr>
<tr><td>ハムスター</td><td>ハム</td></tr>
<tr><td>メロンパン</td><td>メロン</td></tr>
</tbody></table>
<h2 id="webアプリケーションに欠かせないjavascript"><a class="header" href="#webアプリケーションに欠かせないjavascript">Webアプリケーションに欠かせないJavaScript</a></h2>
<p><img src="js/./img/js_introduction_web_app.svg" alt="Webアプリケーションのしくみ" /></p>
<h3 id="言語別人気ランキング2020年"><a class="header" href="#言語別人気ランキング2020年">言語別人気ランキング（2020年）</a></h3>
<table><thead><tr><th>言語</th><th>使用している開発者（%）</th></tr></thead><tbody>
<tr><td>JavaScript</td><td><code>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>69.7%</td></tr>
<tr><td>HTML/CSS</td><td><code>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>62.4%</td></tr>
<tr><td>SQL</td><td><code>|||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>56.9%</td></tr>
<tr><td>Python</td><td><code>||||||||||||||||||||||||||||||||||||||||||</code>41.6%</td></tr>
<tr><td>JAVA</td><td><code>||||||||||||||||||||||||||||||||||||||</code>38.4%</td></tr>
<tr><td>C#</td><td><code>||||||||||||||||||||||||||||||||</code>32.3%</td></tr>
<tr><td>TypeScript</td><td><code>||||||||||||||||||||||||||||</code>28.3%</td></tr>
<tr><td>PHP</td><td><code>||||||||||||||||||||||||||</code>25.8%</td></tr>
</tbody></table>
<p><a href="https://insights.stackoverflow.com/survey/2020/#technology-programming-scripting-and-markup-languages">ソース: https://insights.stackoverflow.com/survey/2020/#technology-programming-scripting-and-markup-languages</a></p>
<h2 id="javascript周辺の技術"><a class="header" href="#javascript周辺の技術">JavaScript周辺の技術</a></h2>
<p><img src="js/./img/js_introduction_around_js.svg" alt="JS周辺技術" /></p>
<h3 id="よく使われる技術"><a class="header" href="#よく使われる技術">よく使われる技術</a></h3>
<table><thead><tr><th>技術</th><th>特徴</th></tr></thead><tbody>
<tr><td><img src="js/./img/1280px-JQuery-Logo.svg.png" width="200px"></td><td>- JavaScriptのライブラリ．<br>- ユーザ操作イベントやアニメーションを実現<br>- ✅ 生JSと比較して短くかける．<br>- ✅ webアプリケーションで広く普及している．<br>- ✅ 導入が簡単．<br>- ✅ 学習コストが低い．<br>- 🔼 難しいことをやろうとすると複雑になる．<br>- まずはここから！</td></tr>
<tr><td><img src="js/./img/react-logo.png" width="200px"><br><img src="js/./img/Vue-logo-001.svg" width="200px"><br></td><td>- JavaScriptのライブラリ．<br>- ✅ モダンなwebアプリケーション（SPA）を実現<br>- ✅ 高速！<br>- ✅ TypeScriptでの実装も可能<br>- ✅ スマホアプリも見据えた開発が可能．<br>- 🔼 学習コスト<br>- 🔼 環境構築がややハードル．<br>- （私はReactが好き）</td></tr>
<tr><td><img src="js/./img/nodejs-logo-vector.svg" width="200px"></td><td>- サーバサイドでJavaScriptを動かす技術．<br>- ✅ フロントもサーバもJavaScriptで書ける．．！<br>- ✅ サーバサイドの中では環境構築が容易<br>- 🔼 難しいことをやろうとすると複雑になる．</td></tr>
</tbody></table>
<h2 id="javascriptを書く"><a class="header" href="#javascriptを書く">JavaScriptを書く</a></h2>
<h3 id="書き方"><a class="header" href="#書き方">書き方</a></h3>
<p><code>&lt;script&gt;&lt;/script&gt;</code>の間に処理を記述！</p>
<h3 id="書く場所"><a class="header" href="#書く場所">書く場所</a></h3>
<ul>
<li>htmlファイルの<code>&lt;/body&gt;</code>のすぐ上に書こう！</li>
<li>ほかにもいくつか書ける場所があります．</li>
<li>別にファイルを作るやり方もあります．</li>
</ul>
<h3 id="まず動かす"><a class="header" href="#まず動かす">まず動かす！！</a></h3>
<ul>
<li><code>alert()</code></li>
<li><code>console.log()</code></li>
</ul>
<blockquote>
<p>文字列は「<code>'</code>」か「<code>&quot;</code>」で囲む．どちらでもOK！</p>
</blockquote>
<pre><code class="language-html">&lt;script&gt;
  alert('Hello world');

  console.log('Hello world');

&lt;/script&gt;

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_おみくじ"><a class="header" href="#js_おみくじ">JS_おみくじ</a></h1>
<h2 id="本講義の内容とゴール"><a class="header" href="#本講義の内容とゴール">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容"><a class="header" href="#本講義の内容">本講義の内容</a></h3>
<ul>
<li>JavaScriptを動かす！</li>
<li>変数と条件分岐の練習と実装．</li>
<li>おみくじアプリケーションの実装．</li>
</ul>
<h3 id="本講義のゴール"><a class="header" href="#本講義のゴール">本講義のゴール</a></h3>
<ul>
<li>プログラミングに慣れる！</li>
<li>「変数」「条件分岐」を扱う！</li>
<li>課題に取り組み始める！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="javascript-1"><a class="header" href="#javascript-1">JavaScript</a></h1>
<h2 id="javascriptの役割-1"><a class="header" href="#javascriptの役割-1">JavaScriptの役割</a></h2>
<table><thead><tr><th>言語</th><th>役割</th></tr></thead><tbody>
<tr><td>HTML（マスター済み）</td><td>コンテンツの指定<br>タイトル，文章，画像などの記述</td></tr>
<tr><td>CSS（マスター済み）</td><td>コンテンツの装飾<br>色，大きさ，配置などの指定</td></tr>
<tr><td>JavaScript</td><td>ユーザー操作，イベント発生による動きを実現<br>（わりとなんでもできる）</td></tr>
</tbody></table>
<h2 id="javascriptとは-1"><a class="header" href="#javascriptとは-1">JavaScriptとは</a></h2>
<p><strong>JavaScript ≠ JAVA</strong></p>
<p>JavaScriptとJAVAの違い</p>
<table><thead><tr><th>JavaScript</th><th>JAVA</th></tr></thead><tbody>
<tr><td>フロントエンド言語</td><td>サーバサイド言語</td></tr>
<tr><td>カモミール</td><td>カモ</td></tr>
<tr><td>オーストラリア</td><td>オーストリア</td></tr>
<tr><td>ハムスター</td><td>ハム</td></tr>
<tr><td>メロンパン</td><td>メロン</td></tr>
</tbody></table>
<h2 id="webアプリケーションに欠かせないjavascript-1"><a class="header" href="#webアプリケーションに欠かせないjavascript-1">Webアプリケーションに欠かせないJavaScript</a></h2>
<p><img src="js/./img/js_introduction_web_app.svg" alt="Webアプリケーションのしくみ" /></p>
<h3 id="言語別人気ランキング2020年-1"><a class="header" href="#言語別人気ランキング2020年-1">言語別人気ランキング（2020年）</a></h3>
<table><thead><tr><th>言語</th><th>使用している開発者（%）</th></tr></thead><tbody>
<tr><td>JavaScript</td><td><code>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>69.7%</td></tr>
<tr><td>HTML/CSS</td><td><code>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>62.4%</td></tr>
<tr><td>SQL</td><td><code>|||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>56.9%</td></tr>
<tr><td>Python</td><td><code>||||||||||||||||||||||||||||||||||||||||||</code>41.6%</td></tr>
<tr><td>JAVA</td><td><code>||||||||||||||||||||||||||||||||||||||</code>38.4%</td></tr>
<tr><td>C#</td><td><code>||||||||||||||||||||||||||||||||</code>32.3%</td></tr>
<tr><td>TypeScript</td><td><code>||||||||||||||||||||||||||||</code>28.3%</td></tr>
<tr><td>PHP</td><td><code>||||||||||||||||||||||||||</code>25.8%</td></tr>
</tbody></table>
<p><a href="https://insights.stackoverflow.com/survey/2020/#technology-programming-scripting-and-markup-languages">ソース: https://insights.stackoverflow.com/survey/2020/#technology-programming-scripting-and-markup-languages</a></p>
<h2 id="javascript周辺の技術-1"><a class="header" href="#javascript周辺の技術-1">JavaScript周辺の技術</a></h2>
<p><img src="js/./img/js_introduction_around_js.svg" alt="JS周辺技術" /></p>
<h3 id="よく使われる技術-1"><a class="header" href="#よく使われる技術-1">よく使われる技術</a></h3>
<table><thead><tr><th>技術</th><th>特徴</th></tr></thead><tbody>
<tr><td><img src="js/./img/1280px-JQuery-Logo.svg.png" width="200px"></td><td>- JavaScriptのライブラリ．<br>- ユーザ操作イベントやアニメーションを実現<br>- ✅ 生JSと比較して短くかける．<br>- ✅ webアプリケーションで広く普及している．<br>- ✅ 導入が簡単．<br>- ✅ 学習コストが低い．<br>- 🔼 難しいことをやろうとすると複雑になる．<br>- まずはここから！</td></tr>
<tr><td><img src="js/./img/react-logo.png" width="200px"><br><img src="js/./img/Vue-logo-001.svg" width="200px"><br></td><td>- JavaScriptのライブラリ．<br>- ✅ モダンなwebアプリケーション（SPA）を実現<br>- ✅ 高速！<br>- ✅ TypeScriptでの実装も可能<br>- ✅ スマホアプリも見据えた開発が可能．<br>- 🔼 学習コスト<br>- 🔼 環境構築がややハードル．<br>- （私はReactが好き）</td></tr>
<tr><td><img src="js/./img/nodejs-logo-vector.svg" width="200px"></td><td>- サーバサイドでJavaScriptを動かす技術．<br>- ✅ フロントもサーバもJavaScriptで書ける．．！<br>- ✅ サーバサイドの中では環境構築が容易<br>- 🔼 難しいことをやろうとすると複雑になる．</td></tr>
</tbody></table>
<h2 id="javascriptを書く-1"><a class="header" href="#javascriptを書く-1">JavaScriptを書く</a></h2>
<h3 id="書き方-1"><a class="header" href="#書き方-1">書き方</a></h3>
<p><code>&lt;script&gt;&lt;/script&gt;</code>の間に処理を記述！</p>
<h3 id="書く場所-1"><a class="header" href="#書く場所-1">書く場所</a></h3>
<ul>
<li>htmlファイルの<code>&lt;/body&gt;</code>のすぐ上に書こう！</li>
<li>ほかにもいくつか書ける場所があります．</li>
<li>別にファイルを作るやり方もあります．</li>
</ul>
<h3 id="まず動かす-1"><a class="header" href="#まず動かす-1">まず動かす！！</a></h3>
<ul>
<li><code>alert()</code></li>
<li><code>console.log()</code></li>
</ul>
<blockquote>
<p>文字列は「<code>'</code>」か「<code>&quot;</code>」で囲む．どちらでもOK！</p>
</blockquote>
<pre><code class="language-html">&lt;script&gt;
  alert('Hello world');

  console.log('Hello world');

&lt;/script&gt;

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="変数と計算"><a class="header" href="#変数と計算">変数と計算</a></h1>
<h3 id="変数とは"><a class="header" href="#変数とは">変数とは</a></h3>
<p>「変数」は文字列や数値に名前をつけて，後から使用できるようにするもの．</p>
<p>プログラミングでは，ある部分で計算などして導出した値を別の部分で使用することが多い．</p>
<p>その際，毎回同じ計算を行うと不便であるため，1回計算した結果に名前をつけておき別の部分でそのまま使えるようにする．</p>
<h3 id="-key-point"><a class="header" href="#-key-point">💡 Key Point</a></h3>
<blockquote>
<p>変数には自分で名前をつけるが，「何の値なのか」がわかるように名前をつけることが極めて重要！！</p>
</blockquote>
<h3 id="変数のルール"><a class="header" href="#変数のルール">変数のルール</a></h3>
<p>プログラミングで使用する値には「数値」「文字列」などの型が存在する．</p>
<ul>
<li>「数値」は数学で扱う数と同様に計算できる．</li>
<li>「文字列」は開発者が決めたメッセージやキーワードなどである．英語でも日本語でも扱うことができ，<code>'</code>（シングルクォーテーション）か<code>&quot;</code>（ダブルクオーテーション）で囲む必要がある．</li>
<li>変数名の先頭が数字になるパターンはNG！</li>
</ul>
<pre><code class="language-js">const number1 = 100;
const number2 = 200;
const text1 = 'hello';
const text2 = 'world';
const 3text = 'JavaScript'; // NG

</code></pre>
<h3 id="-key-point-1"><a class="header" href="#-key-point-1">💡 Key Point</a></h3>
<blockquote>
<p>シングルクォーテーションとダブルクオーテーションはどちらでも良いが統一しよう！</p>
</blockquote>
<h2 id="数値の計算"><a class="header" href="#数値の計算">数値の計算</a></h2>
<p>数値は数学と同様に四則演算を行うことができる．</p>
<pre><code class="language-js">const number1 = 1 + 9;    // 10
const number2 = 1 - 5;    // -4
const number3 = 2 * 4;    //  8
const number4 = 10 / 2;   //  5
const number5 = 10 % 3;   //  1

</code></pre>
<h2 id="文字列の結合"><a class="header" href="#文字列の結合">文字列の結合</a></h2>
<p>文字列は「<code>+</code>」の計算を行うことができる．この場合は数学と異なり，前後の文字列が連結される．</p>
<pre><code class="language-js">const number1 = 100;
const number2 = 200;
const text1 = 'hello';
const text2 = 'world';
const sum1 = number1 + number2;   // 300
const sum2 = text1 + text2;   // helloworld

</code></pre>
<h3 id="-key-point-2"><a class="header" href="#-key-point-2">💡 Key Point</a></h3>
<blockquote>
<p><code>1</code>と<code>'1'</code>は異なるッ！</p>
</blockquote>
<h2 id="ngワード"><a class="header" href="#ngワード">NGワード</a></h2>
<p>変数名には使用できない単語が存在する</p>
<p>構文で使用するもの，将来的に使われるもの，など</p>
<ul>
<li>「<code>if</code>」「<code>for</code>」など</li>
</ul>
<p>このような単語は「予約語」と呼ばれる．</p>
<ul>
<li>「MDN javascript 予約語」で検索！！</li>
<li>引っかかる場合は少ないので今は気にしなくてOK！</li>
</ul>
<h2 id="練習"><a class="header" href="#練習">練習</a></h2>
<h3 id="以下の処理をjavascriptで実装しよう"><a class="header" href="#以下の処理をjavascriptで実装しよう">以下の処理をJavaScriptで実装しよう！</a></h3>
<ul>
<li>「<code>100</code>」と「<code>200</code>」の数値をそれぞれ変数に入れ，加算した結果を<code>alert()</code>で表示．</li>
<li>「<code>G's</code>」と「<code>ACADEMY</code>」の文字列をそれぞれ変数に入れ，つなげて<code>alert()</code>で表示．</li>
<li><code>js_practice.html</code>に記述しよう！</li>
</ul>
<h3 id="動作確認"><a class="header" href="#動作確認">動作確認</a></h3>
<p>それぞれ「300」と「G'sACADEMY」が表示されればOK！</p>
<h2 id="補足"><a class="header" href="#補足">補足</a></h2>
<blockquote>
<p>JavaScriptにおける変数の定義には「<code>const</code>」「<code>let</code>」「<code>var</code>」の3種類が存在する．</p>
<p>基本的には<code>const</code>を使用し，どうしてもな場合に<code>let</code>を使用すれば良いだろう．</p>
<pre><code class="language-js">const hoge = 100;
const hoge = 200;   // エラー（同じ名前で定義するのはNG）
hoge = 300;   // エラー（異なる値を入れ直すのはNG）

// 後から上書きできる変数
let fuga = 1000;
let fuga = 2000;    // エラー（同じ名前で定義するのはNG）
foo = 3000;   // OK（予期せぬ値が入ってしまう場合があるので注意）

// むかしあったやつ（使わないほうが良い）
var piyo = 99999;
var piyo = 88888;   // OK（あぶない）
piyo = 77777;   // OK（あぶない）

</code></pre>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ランダムな数乱数をつくる"><a class="header" href="#ランダムな数乱数をつくる">ランダムな数（乱数）をつくる</a></h1>
<h2 id="乱数とは"><a class="header" href="#乱数とは">乱数とは</a></h2>
<p>毎回異なる値が出てくる数のこと（例：1回目に実行したら1，2回目に実行したら4，など）．</p>
<p>JavaScriptには最初から乱数をつくれる処理が用意されている（<code>Math.random()</code>）のでこれを利用する．しかし，この処理は0から1の範囲で小数を発生させるため，<code>Math.floor()</code>を用いて整数に直す．</p>
<pre><code class="language-js">// 0から1の間でランダムな値（乱数）を表示．
const randomNumber1 = Math.random();
alert(randomNumber1);

// 0から4までのどれかが表示される！
const randomNumber2 = Math.floor(Math.random() * 5);
alert(randomNumber2);

</code></pre>
<h3 id="-key-point-3"><a class="header" href="#-key-point-3">💡 Key Point</a></h3>
<blockquote>
<p>乱数の処理は毎回これでいけるので，覚えるよりコピペ！</p>
</blockquote>
<h3 id="補足-1"><a class="header" href="#補足-1">補足</a></h3>
<p>JavaScriptの<code>Math.~</code>には多くの種類があり，絶対値を求めたり四捨五入したりする処理も存在する．</p>
<h2 id="練習-1"><a class="header" href="#練習-1">練習</a></h2>
<p><code>math.html</code>で以下の数をランダムに発生させて<code>alert();</code>で表示させよう！</p>
<table><thead><tr><th></th><th align="right">最小値</th><th align="right">最大値</th></tr></thead><tbody>
<tr><td>問題1</td><td align="right">0</td><td align="right">9</td></tr>
<tr><td>問題2</td><td align="right">1</td><td align="right">9</td></tr>
<tr><td>問題3</td><td align="right">5</td><td align="right">10</td></tr>
<tr><td>問題4</td><td align="right">50</td><td align="right">99</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="条件分岐"><a class="header" href="#条件分岐">条件分岐</a></h1>
<h2 id="条件分岐-1"><a class="header" href="#条件分岐-1">条件分岐</a></h2>
<p>条件を満たすときと満たさないときで別々の処理を実行する！</p>
<pre><code class="language-js">if(`条件式`){
  // 条件式を満たす場合の処理
} else {
  // 条件式を満たさない場合の処理
}

</code></pre>
<p>複数の条件で処理を分岐させることもできる！</p>
<pre><code class="language-js">if(`条件式1`){
  // 条件式1を満たす場合の処理
} else if(`条件式2`) {
  // 条件式1と満たさなくて条件式2を満たす場合の処理
} else {
  // いずれの条件も満たさない場合の処理
}

</code></pre>
<h2 id="条件式"><a class="header" href="#条件式">条件式</a></h2>
<p>条件式は左辺と右辺の比較で行うことが多い（比較演算子）．</p>
<table><thead><tr><th>演算子</th><th>意味</th><th>補足</th></tr></thead><tbody>
<tr><td><code>==</code></td><td>左辺と右辺が等しい</td><td><code>1</code>と<code>'1'</code>は等しいと判定される．</td></tr>
<tr><td><code>===</code></td><td>左辺と右辺が等しい</td><td><code>1</code>と<code>'1'</code>は等しくないと判定される．</td></tr>
<tr><td><code>!=</code></td><td>左辺と右辺が等しくない</td><td><code>1</code>と<code>'1'</code>は等しいと判定される．</td></tr>
<tr><td><code>!==</code></td><td>左辺と右辺が等しくない</td><td><code>1</code>と<code>'1'</code>は等しくないと判定される．</td></tr>
<tr><td><code>&gt;</code></td><td>左辺が右辺より大きい</td><td></td></tr>
<tr><td><code>&lt;</code></td><td>左辺が右辺より小さい</td><td></td></tr>
<tr><td><code>&gt;=</code></td><td>左辺が右辺以上</td><td></td></tr>
<tr><td><code>&lt;=</code></td><td>左辺が右辺以下</td><td></td></tr>
</tbody></table>
<h3 id="-key-point-4"><a class="header" href="#-key-point-4">💡 Key Point</a></h3>
<blockquote>
<p>左辺と右辺が等しい場合に<code>a = b</code>のように記述してハマる．<code>a == b</code>が正解．</p>
</blockquote>
<h2 id="条件式の組み合わせ"><a class="header" href="#条件式の組み合わせ">条件式の組み合わせ</a></h2>
<p>条件式は複数組み合わせることができる．下記2種類がよく使われる．</p>
<ul>
<li>複数の条件式を全て満たす場合（AND条件）は条件式を<code>&amp;&amp;</code>でつなぐ．</li>
<li>複数の条件式のいずれかを満たす場合（OR条件）は条件式を<code>||</code>でつなぐ．</li>
</ul>
<pre><code class="language-js">if(`条件式1` &amp;&amp; `条件式2`){
  // 条件式1と条件式2を両方満たす場合の処理
} else {
  // 片方しか満たさない，両方満たさない場合の処理
}

if(`条件式1` || `条件式2`){
  // 条件式1か条件式2のどちらかを満たす場合の処理
} else {
  // 両方満たさない場合の処理
}

</code></pre>
<h3 id="-key-point-5"><a class="header" href="#-key-point-5">💡 Key Point</a></h3>
<blockquote>
<p>条件分岐を書くときははじめに構文（<code>if(){}else{}</code>）をつくってから条件や処理を書く！</p>
</blockquote>
<h2 id="練習-2"><a class="header" href="#練習-2">練習</a></h2>
<h3 id="乱数と条件分岐を組み合わせておみくじを実装"><a class="header" href="#乱数と条件分岐を組み合わせておみくじを実装">乱数と条件分岐を組み合わせておみくじを実装！</a></h3>
<p>ランダムに「大吉・中吉・小吉・凶・大凶」を<code>alert()</code>で表示！</p>
<p><code>omikuji01.html</code>に記述しよう！</p>
<h3 id="ヒント"><a class="header" href="#ヒント">ヒント！！</a></h3>
<ol>
<li><code>Math.rondom()</code>で0から4を発生させる．（&lt;- 前項でつくったものが使える．．！）</li>
<li>出た数値に応じて<code>if</code>文を使って条件分岐し，異なる内容を<code>alert()</code>で出力！</li>
</ol>
<p>毎回ランダムで「大吉・中吉・小吉・凶・大凶」のどれかが表示されればOK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="おみくじのwebアプリ実装"><a class="header" href="#おみくじのwebアプリ実装">おみくじのWebアプリ実装</a></h1>
<p>おみくじの処理自体はできたが，画面から操作できるWebアプリケーションにしたい！</p>
<h2 id="想定される挙動"><a class="header" href="#想定される挙動">想定される挙動</a></h2>
<ul>
<li>画面上のHTML要素（DOM）をクリックして処理を実行！</li>
<li>要素を「指定」する！</li>
<li>classやidでDOMを特定する．</li>
<li>指定したDOMに対してJavaScriptで操作を行う！</li>
</ul>
<h3 id="例"><a class="header" href="#例">例</a></h3>
<ul>
<li>「<code>id</code>が<code>button</code>」の要素を「クリック」したら．．．</li>
<li>「大吉-大凶のどれかをランダムに表示」！</li>
</ul>
<h3 id="参考dom"><a class="header" href="#参考dom">参考（DOM）</a></h3>
<blockquote>
<p>HTMLに記述されている各要素のこと（document object model）</p>
</blockquote>
<h2 id="基本の3要素"><a class="header" href="#基本の3要素">基本の3要素</a></h2>
<ul>
<li>selector（どこを）</li>
<li>event（いつ）</li>
<li>method（どうする）</li>
</ul>
<p><img src="js/js01/./img/20210622123450.png" alt="dom3要素" /></p>
<p>なんだけど．．．</p>
<pre><code>＿人人人人人人人人人人人人人人＿
＞　JavaScriptはDOM操作が苦手　＜
￣Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^￣
</code></pre>
<h2 id="jqueryライブラリ"><a class="header" href="#jqueryライブラリ">jQueryライブラリ</a></h2>
<h3 id="jqueryとは"><a class="header" href="#jqueryとは">jQueryとは</a></h3>
<ul>
<li>セレクタをcssと同じ要領で指定できる．</li>
<li>素のJavaScriptよりも短く書ける！</li>
<li>アニメーションなど手軽に設定できる．</li>
<li>書き方（順序や考え方）はJavaScriptと同様！</li>
<li>導入が簡単（フレームワークなどは環境構築で詰む）</li>
</ul>
<p><a href="https://webkikaku.co.jp/homepage/blog/hpseisaku/webdesign/jquery_start/">【参考】https://webkikaku.co.jp/homepage/blog/hpseisaku/webdesign/jquery_start/</a></p>
<h3 id="-key-point-6"><a class="header" href="#-key-point-6">💡 Key Point</a></h3>
<blockquote>
<p>jQueryはJavaScriptのDOM操作を短縮して書けるライブラリ</p>
</blockquote>
<h3 id="補足-2"><a class="header" href="#補足-2">補足</a></h3>
<blockquote>
<p>ライブラリは他の開発者がつくったコードを利用させてもらうイメージ．手間のかかる処理を一発で書けるように実装してくれている．</p>
</blockquote>
<h3 id="ライブラリ読み込み"><a class="header" href="#ライブラリ読み込み">ライブラリ読み込み</a></h3>
<p>（jQueryに限らず）ライブラリはソースコードの読み込みが必要！！</p>
<p>（読み込みのコードは毎回同じなのでコピペでOK！）</p>
<pre><code class="language-html">&lt;!-- 🔽 ここで読み込み 🔽 --&gt;
&lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
  // 自分で書いた処理
&lt;/script&gt;
</code></pre>
<h3 id="-key-point-7"><a class="header" href="#-key-point-7">💡 Key Point</a></h3>
<blockquote>
<p>ライブラリを使用する場合は「自分で書くJavaScriptより上の行で」読み込むこと．ライブラリで決められた関数を実行しようとして，読み込みが終わっていない状態だとエラーになってしまう．</p>
</blockquote>
<h2 id="jqueryの書き方と動き方"><a class="header" href="#jqueryの書き方と動き方">jQueryの書き方と動き方</a></h2>
<p>基本の考え方はJavaScriptと全く同じッ！</p>
<p><img src="js/js01/./img/20210622123450.png" alt="dom3要素" /></p>
<h3 id="コード例"><a class="header" href="#コード例">コード例</a></h3>
<ul>
<li><code>id</code>が<code>button</code>の要素を</li>
<li>クリックしたときに</li>
<li>アラートを出す</li>
</ul>
<pre><code class="language-js">$('#button').on('click', function () {
  alert('Hello World!');
});

</code></pre>
<p>コード内でそれぞれ以下の場所で指定している．</p>
<pre><code class="language-js">$(`セレクタ名`).on(`イベント名`, function () {
  `実行したい処理（メソッド）`
});

</code></pre>
<p>今回は<code>id</code>で指定しているが，セレクタの指定方法はたくさんある．イベントもたくさんある．</p>
<ul>
<li>「<code>jQuery セレクタ</code>」でググる！</li>
<li>「<code>jQuery イベント</code>」でググる！</li>
</ul>
<h2 id="まずは形の入力に慣れよう"><a class="header" href="#まずは形の入力に慣れよう">まずは形の入力に慣れよう！</a></h2>
<p>いろいろな処理を書く前に，形の入力に慣れることが大事！！（慣れないとしょうもないスペルミスで時間溶かす）</p>
<pre><code class="language-js">$('#id').on('click', function () {
  // ...
});

</code></pre>
<h3 id="喋りながら書くと定着する本当"><a class="header" href="#喋りながら書くと定着する本当">喋りながら書くと定着する（本当）</a></h3>
<blockquote>
<p>だらーあいでぃーおんくりっくふぁんくしょんかっこかっこなみかっこえんたー...</p>
</blockquote>
<h2 id="練習-3"><a class="header" href="#練習-3">練習</a></h2>
<p>おみくじアプリケーションを完成させよう！</p>
<h3 id="仕様"><a class="header" href="#仕様">仕様</a></h3>
<ul>
<li>「おみくじを引くボタン」をクリックしたら以下のどれかを画面に表示！</li>
<li>「大吉・中吉・小吉・凶・大凶」</li>
</ul>
<h3 id="ヒント-1"><a class="header" href="#ヒント-1">ヒント</a></h3>
<p>下記の流れで考えよう！</p>
<ul>
<li>ボタンをクリックしたらなにかする．</li>
<li>ランダムな数値を発生させる．</li>
<li>条件分岐をつくって，対応する「大吉，中吉，...」を画面に表示させる．</li>
</ul>
<pre><code class="language-js">$('#button').on('click', function () {
  // 0から4でランダムな数を作成
  // 0だったら大吉，1だったら中吉．．．
  // 結果をidで指定した場所に表示
});

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題"><a class="header" href="#課題">課題</a></h1>
<p><strong>じゃんけんアプリを実装！！！！！</strong></p>
<h2 id="じゃんけんアプリの仕様"><a class="header" href="#じゃんけんアプリの仕様">じゃんけんアプリの仕様</a></h2>
<ol>
<li>「グー」「チョキ」「パー」のボタンを設置</li>
<li>どれかをクリックしたら「コンピュータの出した手は？」を変更
<ul>
<li>「コンピュータ：グー」「コンピュータ：チョキ」など</li>
</ul>
</li>
<li>「結果は？」の箇所に
<ul>
<li>「あなたの負け」「あなたの勝ち」「あいこ」のどれかを表示！</li>
</ul>
</li>
</ol>
<p>※上記を最低ラインとして製作</p>
<p>※これを土台にしてガンガン発展させよう！！</p>
<h2 id="課題に対する考え方"><a class="header" href="#課題に対する考え方">課題に対する考え方</a></h2>
<table><thead><tr><th>✅</th><th>❎</th></tr></thead><tbody>
<tr><td>オリジナリティを表現する</td><td>誰かに言われたものを作る</td></tr>
<tr><td>プロダクトを創る</td><td>プログラムを書く</td></tr>
<tr><td><strong>自分が好きなものをつくる</strong></td><td>受けが良さそうなものをつくる</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_メモパッド"><a class="header" href="#js_メモパッド">JS_メモパッド</a></h1>
<h2 id="本講義の内容とゴール-1"><a class="header" href="#本講義の内容とゴール-1">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-1"><a class="header" href="#本講義の内容-1">本講義の内容</a></h3>
<ul>
<li>配列や繰り返し処理に触れる．</li>
<li>ブラウザにデータを保存する．</li>
<li>複数件のデータをまとめる処理を実装する．</li>
</ul>
<h3 id="本講義のゴール-1"><a class="header" href="#本講義のゴール-1">本講義のゴール</a></h3>
<ul>
<li>いろいろなデータ形式を知る！</li>
<li>データの扱いになれる！</li>
<li>データを保存・読み出しをマスターする！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="配列"><a class="header" href="#配列">配列</a></h1>
<h2 id="配列arrayとは"><a class="header" href="#配列arrayとは">配列（array）とは</a></h2>
<ul>
<li>複数の値に順番をつけてまとめて扱う方法．奥が深い．超強い．</li>
<li>順番を「インデックス」と呼ぶ．「0」からスタート！
<ul>
<li>プログラミングでは「数字は0から始める」（稀に例外もあり）</li>
</ul>
</li>
</ul>
<pre><code class="language-js">const array = ['大吉', '中吉', '小吉', '凶', '大凶'];
alert(array[0]);

</code></pre>
<h2 id="配列の作り方"><a class="header" href="#配列の作り方">配列の作り方</a></h2>
<p>下記のどちらかで作成可能．どちらでも良い（1が多い）．</p>
<ol>
<li><code>[]</code>で囲い，要素をカンマで区切る．</li>
<li><code>new Array()</code>の<code>()</code>内に要素をカンマ区切りで入れる．</li>
</ol>
<pre><code class="language-js">const list01 = ['月', '火', '水', '木', '金', '土', '日'];
const list02 = new Array('月', '火', '水', '木', '金', '土', '日&quot;);
console.log(list01);

</code></pre>
<h3 id="-key-point-8"><a class="header" href="#-key-point-8">💡 Key Point</a></h3>
<blockquote>
<p>配列はブラウザの検証画面に出力すると構造や内容が確認しやすい．</p>
</blockquote>
<h2 id="配列の長さ"><a class="header" href="#配列の長さ">配列の長さ</a></h2>
<p>配列の要素数を「長さ」と呼ぶ．長さは<code>配列名.length</code>で取得することができる．</p>
<p>繰り返し処理などで非常に有用である（後述）．</p>
<pre><code class="language-js">console.log(list01.length);   // 7

</code></pre>
<h2 id="配列のいいぞ"><a class="header" href="#配列のいいぞ">配列のいいぞ．．．</a></h2>
<p>条件分岐なんていらんかったんや．．．</p>
<pre><code class="language-js">const hands = ['グー', 'チョキ', 'パー'];
const randomNumber = Math.floor(Math.random() * hands.length);
const computerHand = hands[randomNumber];

console.log(computerHand);

</code></pre>
<p>結果のテーブルをつくるのもありやな．．．</p>
<pre><code class="language-js">const resultTable = [
  ['draw', 'win', 'lose'],
  ['lose', 'draw', 'win'],
  ['win', 'lose', 'draw'],
];

const userHand = 0;
const computerHand = 1;

const result = resultTable[userHand][computerHand];

console.log(result);

</code></pre>
<h2 id="よくある配列の処理"><a class="header" href="#よくある配列の処理">よくある配列の処理</a></h2>
<p>配列には値を追加したり削除したりできる．</p>
<pre><code class="language-js">const list01 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

// 先頭に追加
list01.unshift(0);    // [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

// 末尾に追加
list01.push(11);    // [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]

// 先頭を削除
list01.shift();   // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]

// 末尾を削除
list01.pop();   // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

// 反転
list01.reverse();   // [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="繰り返し処理"><a class="header" href="#繰り返し処理">繰り返し処理</a></h1>
<h2 id="繰り返し処理とは"><a class="header" href="#繰り返し処理とは">繰り返し処理とは</a></h2>
<p>同じ処理を指定した回数実行するやり方</p>
<ul>
<li>同じ処理を100回実行したいときに100回書くのか．．？</li>
<li>配列と相性が良い！</li>
<li>超むずい（使っていてもきちんと説明できないことも．．．）</li>
</ul>
<h2 id="書き方-2"><a class="header" href="#書き方-2">書き方</a></h2>
<p>繰り返し処理では次の3つの条件を指定する．</p>
<ol>
<li>開始条件</li>
<li>繰り返しを続ける条件</li>
<li>回数のカウントの仕方</li>
</ol>
<pre><code class="language-js">for(`開始条件`; `繰り返しを続ける条件`; `回数のカウントの仕方`){
  // 実際に繰り返したい処理
}

</code></pre>
<h3 id="-key-point-9"><a class="header" href="#-key-point-9">💡 Key Point</a></h3>
<blockquote>
<p>if文と同じく，まず構文の形をつくってしまおう．</p>
</blockquote>
<h2 id="コード例-1"><a class="header" href="#コード例-1">コード例</a></h2>
<ul>
<li>「<code>i</code>」の値を使って繰り返しをコントロールする．</li>
<li>条件をセミコロン「<code>;</code>」で区切る点に注意！！</li>
<li><code>i++</code>は「<code>i</code>を1ずつ増やす」を意味する．</li>
<li>「<code>i=0</code>で<code>{}</code>内を実行」「<code>i=1</code>で<code>{}</code>内を実行」...の繰り返し．</li>
</ul>
<pre><code class="language-js">for(let i=0; i &lt; 100; i++){
  console.log(i);
}

</code></pre>
<p>上のコードは以下と同じ意味．「<code>i &lt; 100</code>」なので99まで実行したら終了．</p>
<pre><code class="language-js">console.log(0);
console.log(1);
console.log(2);
// ...
console.log(98);
console.log(99);

</code></pre>
<h2 id="繰り返しの使用例"><a class="header" href="#繰り返しの使用例">繰り返しの使用例</a></h2>
<p>1901年から2021年を選択できる<code>&lt;select&gt;</code>を作成する．処理の流れは以下．</p>
<ol>
<li>開始年と終了年を定義しておく．</li>
<li>出力用の空文字を用意しておく．</li>
<li>繰り返し処理で「開始条件に開始年」「終了条件に終了年」を指定してタグを作成し，空文字に追加する．</li>
<li>繰り返し処理が終わったら指定した場所に出力する．</li>
</ol>
<pre><code class="language-js">// 1
const start = 1901;
const end = 2021;

// 2
let option = '';

// 3
for(let i = start; i &lt;= end; i++){
  option += '&lt;option&gt;' + i + '&lt;/option&gt;';
}

// 4
$('#hoge').html(option);

</code></pre>
<h2 id="繰り返し処理との組み合わせ"><a class="header" href="#繰り返し処理との組み合わせ">繰り返し処理との組み合わせ</a></h2>
<p>繰り返し処理を用いると配列内の要素を順番に使うことができる．<code>length</code>を使用すると配列の長さに関わらず対応できる．</p>
<pre><code class="language-js">const list01 = ['月', '火', '水', '木', '金', '土', '日'];

for(let i = 0; i &lt; list01.length; i++){
  console.log(list01[i]);
}

</code></pre>
<h2 id="配列と繰り返しでブラウザに要素を表示"><a class="header" href="#配列と繰り返しでブラウザに要素を表示">配列と繰り返しでブラウザに要素を表示</a></h2>
<p>よく出てくるパターン．データが入った配列からデータを取り出して画面に表示したい場面は多い．</p>
<p>流れは以下のとおり．</p>
<ol>
<li>空の出力用配列を用意しておく．</li>
<li>繰り返し処理を用いて，配列からデータを取り出し，タグに入れて1の配列に追加する．</li>
<li>繰り返し処理が終わったら出力用の配列を画面上の指定した部分に出力する．</li>
</ol>
<pre><code class="language-js">const list01 = ['月', '火', '水', '木', '金', '土', '日'];

// 1
const array = [];

// 2
for(let i = 0; i &lt; list01.length; i++){
  array.push('&lt;p&gt;' + list01[i] + '&lt;/p&gt;');
}

// 3
$('#echo').html(array);

</code></pre>
<h2 id="繰り返し処理のバリエーション"><a class="header" href="#繰り返し処理のバリエーション">繰り返し処理のバリエーション</a></h2>
<p>似たような構文がいくつか存在する．とりあえず好きなものを使用すればOK．</p>
<pre><code class="language-js">const list = [1, 2, 3, 4, 5];

for (let i = 0; i &lt; list.length; i++) {
  console.log(list[i]);
}

for (let x of list) {
  console.log(x);
}

list.forEach(function (x) {
  console.log(x);
})

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="オブジェクト"><a class="header" href="#オブジェクト">オブジェクト</a></h1>
<h2 id="オブジェクトとは"><a class="header" href="#オブジェクトとは">オブジェクトとは</a></h2>
<ul>
<li>配列と同様に複数の値を管理する方法</li>
<li>配列の「インデックス」に対して「キー」「バリュー」で管理．</li>
</ul>
<pre><code class="language-js">const jojo01 = {
  number: 1,
  title: 'ファントムブラッド',
  hero: 'ジョナサン・ジョースター',
  rival: 'ディオ・ブランドー',
  sound: 'メメタァ',
};
console.log(jojo01.sound);
console.log(jojo01['sound']);

</code></pre>
<h2 id="配列とオブジェクトの組み合わせ"><a class="header" href="#配列とオブジェクトの組み合わせ">配列とオブジェクトの組み合わせ</a></h2>
<p>この形は非常に多い．今後もたくさん出てくるので慣れておくことを推奨するッ！！</p>
<pre><code class="language-js">const jojo = [
  {
    number: 1,
    title: 'ファントムブラッド',
    hero: 'ジョナサン・ジョースター',
  },
  {
    number: 2,
    title: '戦闘潮流',
    hero: 'ジョセフ・ジョースター',
  },
  {
    number: 3,
    title: 'スターダストクルセイダース',
    hero: '空条承太郎',
  },
];

console.log(jojo[0].title);	// ファントムブラッド
console.log(jojo[2].hero);	// 空条承太郎

</code></pre>
<h2 id="練習-4"><a class="header" href="#練習-4">練習</a></h2>
<p>配列の練習</p>
<ul>
<li><code>list/array.html</code></li>
</ul>
<p>オブジェクトの練習</p>
<ul>
<li><code>list/object.html</code></li>
</ul>
<p>上記が楽勝な人</p>
<ul>
<li><code>list/challenge.html</code></li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="localstorageメモ帳初級"><a class="header" href="#localstorageメモ帳初級">LocalStorage（メモ帳初級）</a></h1>
<h2 id="localstorageとは"><a class="header" href="#localstorageとは">LocalStorageとは</a></h2>
<h3 id="変数やオブジェクトの問題"><a class="header" href="#変数やオブジェクトの問題">変数やオブジェクトの問題</a></h3>
<ul>
<li>ブラウザをリロードすると初期化される．</li>
<li>次回読み込んだときまで値を保存したいときにつらい！</li>
</ul>
<h3 id="localstorageができること"><a class="header" href="#localstorageができること">LocalStorageができること</a></h3>
<ul>
<li>ブラウザにデータを保存できる！
<ul>
<li>テキスト形式のデータのみ．</li>
</ul>
</li>
<li>「オリジン単位」ごとに5MBまで保存できる．</li>
<li>（自分で削除しないと永続的に保存される）</li>
</ul>
<blockquote>
<p>オリジン単位とは「http://www.example.com:80」のような「プロトコル://ドメイン名:ポート番号」のこと．</p>
<p><a href="https://gihyo.jp/dev/serial/01/javascript-security/0004?page=2">参考: https://gihyo.jp/dev/serial/01/javascript-security/0004?page=2</a></p>
</blockquote>
<h2 id="本日実装するアプリケーション"><a class="header" href="#本日実装するアプリケーション">本日実装するアプリケーション</a></h2>
<h3 id="メモ帳をつくろう"><a class="header" href="#メモ帳をつくろう">メモ帳をつくろう！</a></h3>
<ul>
<li>ブラウザ上のテキストエリアにメモを入力．</li>
<li>ブラウザに情報を保存．</li>
<li>リロードしても情報が保存されるようにする．</li>
</ul>
<h3 id="仕様-1"><a class="header" href="#仕様-1">仕様</a></h3>
<ul>
<li>saveボタンをクリックしたら情報を保存．</li>
<li>clearボタンをクリックしたら情報を削除．</li>
<li>リロード時に情報が保存されていれば自動的に表示．</li>
</ul>
<h3 id="完成イメージ"><a class="header" href="#完成イメージ">完成イメージ</a></h3>
<p>LocalStorageの内容は検証画面から確認できる．</p>
<p>「Application」 -&gt; 「LocalStorage」の順にクリックすると確認できる（下図の赤枠部分）．</p>
<p><img src="js/js02/./img/20210620233121.png" alt="メモ帳初級画面" /></p>
<h2 id="localstorageの使い方"><a class="header" href="#localstorageの使い方">LocalStorageの使い方</a></h2>
<h3 id="しくみ"><a class="header" href="#しくみ">しくみ</a></h3>
<p>「key」と「value」の形式でデータを保存する．key名を変えれば複数保存できるッ！</p>
<table><thead><tr><th>key</th><th>value</th></tr></thead><tbody>
<tr><td>memo01</td><td>コード！書かずにはいられないッ！</td></tr>
<tr><td>memo02</td><td>最終的に．．．動けばよかろうなのだァァァァッ！！</td></tr>
<tr><td>memo03</td><td>過程や！方法なぞ！どうでもよいのだァーッ</td></tr>
</tbody></table>
<h3 id="javascriptでの扱い方"><a class="header" href="#javascriptでの扱い方">JavaScriptでの扱い方</a></h3>
<p>今回はデータの登録（すでに同じkeyが存在する場合は上書き）とデータの取得を扱う．</p>
<table><thead><tr><th>内容</th><th>JavaScriptの書き方</th></tr></thead><tbody>
<tr><td>データ登録</td><td><code>localStorage.setItem(key, value);</code></td></tr>
<tr><td>データ取得</td><td><code>localStorage.getItem(key);</code></td></tr>
<tr><td>データ更新</td><td><code>localStorage.setItem(key, value);</code></td></tr>
<tr><td>データ削除</td><td><code>localStorage.removeItem(key);</code></td></tr>
<tr><td>データ全削除</td><td><code>localStorage.clear();</code></td></tr>
<tr><td>データの長さ</td><td><code>localStorage.length;</code></td></tr>
<tr><td>データの順番</td><td><code>localStorage.key(インデックス);</code></td></tr>
</tbody></table>
<h2 id="メモ帳に必要な処理"><a class="header" href="#メモ帳に必要な処理">メモ帳に必要な処理</a></h2>
<h3 id="1-データを保存するときの処理"><a class="header" href="#1-データを保存するときの処理">1. データを保存するときの処理</a></h3>
<ol>
<li>saveボタンのクリックでイベント発火．</li>
<li>テキストエリアの情報を取得．</li>
<li>LocalStorageに情報を保存．</li>
</ol>
<h3 id="2-データを削除するときの処理"><a class="header" href="#2-データを削除するときの処理">2. データを削除するときの処理</a></h3>
<ol>
<li>clearボタンクリックでイベント発火．</li>
<li>LocalStorageの情報を消去．</li>
<li>画面上の入力欄をクリア．</li>
</ol>
<h3 id="3-データを取得するときの処理"><a class="header" href="#3-データを取得するときの処理">3. データを取得するときの処理</a></h3>
<ol>
<li>読み込み時にLocalStorageのデータ有無を確認．</li>
<li>保存されていれば情報を取得．</li>
<li>テキストエリアに情報を表示．</li>
</ol>
<h2 id="データを保存するときの処理"><a class="header" href="#データを保存するときの処理">データを保存するときの処理</a></h2>
<ol>
<li>saveボタンのクリックでイベント発火．</li>
<li><code>.val()</code>でテキストエリアの情報を取得．</li>
<li><code>localStorage.setItem()</code>でLocalStorageに情報を保存．</li>
</ol>
<pre><code class="language-js">// memo01.html

$('#save').on('click', function () {
  const text = $('#text_area').val();
  localStorage.setItem('memo', text);
});

</code></pre>
<h3 id="-key-point-10"><a class="header" href="#-key-point-10">💡 Key Point</a></h3>
<blockquote>
<p>「localStorage」は手打ちせず補完に頼る！！</p>
</blockquote>
<h2 id="データを削除するときの処理"><a class="header" href="#データを削除するときの処理">データを削除するときの処理</a></h2>
<ol>
<li>clearボタンクリックでイベント発火．</li>
<li>key名を指定してLocalStorageの情報を消去．</li>
<li>画面上の入力欄をクリア（空文字で上書きする）．</li>
</ol>
<pre><code class="language-js">// memo01.html

$('#clear').on('click', function () {
  localStorage.removeItem('memo');
  $('#text_area').val('');
});

</code></pre>
<blockquote>
<p>「<code>.val()</code>」は<code>()</code>内に何か入れると入れた値で上書きする！</p>
</blockquote>
<h2 id="データを取得するときの処理"><a class="header" href="#データを取得するときの処理">データを取得するときの処理</a></h2>
<ol>
<li>読み込み時に条件分岐を用いてLocalStorageのデータ有無を確認．</li>
<li>保存されていれば情報を取得．</li>
<li>テキストエリアに情報を表示．</li>
</ol>
<pre><code class="language-js">// memo01.html

if (localStorage.getItem('memo')) {
  const text = localStorage.getItem('memo');
  $('#text_area').val(text);
}

</code></pre>
<blockquote>
<p>データがないのに処理しようとするとエラーになってしまう．データがないときは何もしない．</p>
</blockquote>
<h2 id="練習-5"><a class="header" href="#練習-5">練習</a></h2>
<p><code>memo01.html</code>に以下の処理を順番に実装しよう．</p>
<ol>
<li>saveボタンクリック時にデータの保存</li>
<li>clearボタンクリック時にデータの消去</li>
<li>読み込み時にデータの取得</li>
</ol>
<p>LocalStorageの中身は検証画面から確認しよう．それぞれ以下の状態になればOK！</p>
<ul>
<li>保存時にデータが保存され，検証画面から確認できる．</li>
<li>消去時に保存してあるデータが消去される．</li>
<li>リロード時に保存しているデータがあれば画面に表示される．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="jsonデータメモ帳中級"><a class="header" href="#jsonデータメモ帳中級">JSONデータ（メモ帳中級）</a></h1>
<h2 id="メモ帳初級の問題点"><a class="header" href="#メモ帳初級の問題点">メモ帳初級の問題点</a></h2>
<p>データが1件しか保存できない．複数のメモを個別に残しておきたいときに困る．</p>
<h2 id="複数件のデータを管理する"><a class="header" href="#複数件のデータを管理する">複数件のデータを管理する</a></h2>
<p>配列かオブジェクトを使えば複数件のデータをまとめることができる．これを用いればメモ欄が複数になっても管理できそうである．</p>
<h2 id="だめです"><a class="header" href="#だめです">だめです</a></h2>
<p>配列やオブジェクトは言語毎に形式が異なるため互換性がない（JavaScriptの配列はJavaScriptでしか扱えない）．</p>
<p>つまり，LocalStorageも配列やオブジェクトを保存することはできない．</p>
<p><img src="js/js02/./img/js_localstorage_json01.svg" alt="json解説01" /></p>
<h2 id="互換性のあるデータであるjson形式"><a class="header" href="#互換性のあるデータであるjson形式">互換性のあるデータであるJSON形式</a></h2>
<p>Webアプリケーションは複数の言語で構成されていることが多い．このような場合にお互いのデータをやり取りするため，互換性のある「JSON形式」が準備されている．</p>
<p>各言語では「自前の配列やオブジェクト」と「JSON形式のデータ」を相互に変換する処理が準備されている．</p>
<p><img src="js/js02/./img/js_localstorage_json02.svg" alt="json解説02" /></p>
<h2 id="メモ帳中級編のイメージ"><a class="header" href="#メモ帳中級編のイメージ">メモ帳中級編のイメージ</a></h2>
<p>タイトルと本文をまとめて保存できるようにする！</p>
<p><img src="js/js02/./img/20210620235722.png" alt="" /></p>
<h2 id="jsonの扱い方"><a class="header" href="#jsonの扱い方">JSONの扱い方</a></h2>
<p>JavaScriptには（他の言語でも）「配列やオブジェクトをJSONに変換する処理」と「JSONを配列やオブジェクトに戻す処理」が用意されている．</p>
<h3 id="配列やオブジェクトをjsonに変換する処理"><a class="header" href="#配列やオブジェクトをjsonに変換する処理">配列やオブジェクトをJSONに変換する処理</a></h3>
<p><code>JSON.stringify()</code>でJSON形式に変換できる．</p>
<pre><code class="language-js">const data = {
  title: '波紋の使い方',
  text: 'メメタァ'
};

const jsonData = JSON.stringify(data);
localStorage.setItem('memo', jsonData);

</code></pre>
<h3 id="jsonを配列やオブジェクトに戻す処理"><a class="header" href="#jsonを配列やオブジェクトに戻す処理">JSONを配列やオブジェクトに戻す処理</a></h3>
<p><code>JSON.parse()</code>でJSON形式から戻すことができる．</p>
<pre><code class="language-js">const jsonData = localStorage.getItem('memo');
const data = JSON.parse(jsonData);
console.log(data)

</code></pre>
<h2 id="練習-6"><a class="header" href="#練習-6">練習</a></h2>
<p>タイトルと本文の両方を保存できるメモ帳を実装しよう．</p>
<ul>
<li>動き方はメモ帳初級編と同様</li>
<li>saveボタンクリック時に
<ul>
<li>タイトルと本文の値を取得してまとめる．</li>
<li>まとめたデータをJSON形式に変換する．</li>
<li>JSON形式のデータをLocalStorageに保存．</li>
</ul>
</li>
<li>clearボタンクリック時にデータを消去</li>
<li>読み込み時に
<ul>
<li>LocalStorageからJSON形式のデータを取得する．</li>
<li>JSON形式のデータをオブジェクトに戻す．</li>
<li>オブジェクトからデータを取り出して画面に表示する．</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-1"><a class="header" href="#課題-1">課題</a></h1>
<p><strong>LocalStorageを使った何かを作ろう</strong></p>
<ul>
<li>タブで複数記述できるメモ帳</li>
<li>じゃんけんのスコア保存</li>
<li>ゲームのセーブ&amp;ロード機能</li>
<li>保存したデータをグラフ表示</li>
</ul>
<blockquote>
<p>大事なのは「データを保存できる」「データを読み出せる」の2点！</p>
<p>これを用いて何ができるか考えるのだッ！！</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_firebase"><a class="header" href="#js_firebase">JS_Firebase</a></h1>
<h2 id="事前準備"><a class="header" href="#事前準備">事前準備</a></h2>
<p>今回はGoogleのアカウントを使用します！</p>
<p>無料で取得できますので，事前に作成しておいてください！</p>
<ul>
<li>すでにお持ちの方は既存のアカウントでOKです！</li>
</ul>
<h2 id="本講義の内容とゴール-2"><a class="header" href="#本講義の内容とゴール-2">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-2"><a class="header" href="#本講義の内容-2">本講義の内容</a></h3>
<ul>
<li>関数を定義し，動かす一連の動作を実装する．</li>
<li>オンライン上のデータベースにデータを保存する．</li>
<li>オンライン上のデータを取得し，画面上にリアルタイムに表示する．</li>
</ul>
<h3 id="本講義のゴール-2"><a class="header" href="#本講義のゴール-2">本講義のゴール</a></h3>
<ul>
<li>関数を使って処理を実装できるようになる！</li>
<li>オンライン&amp;リアルタイムでデータ共有する！</li>
<li>複雑なデータを扱う場合にどう考えるかを把握する！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="関数"><a class="header" href="#関数">関数</a></h1>
<h2 id="関数functionとは"><a class="header" href="#関数functionとは">関数（function）とは</a></h2>
<ul>
<li>関数とは記述した処理をまとめて名前をつけて使い回せるようにしたもの．</li>
<li>一度処理を定義してしまえば，呼び出すだけで実行可能！</li>
</ul>
<h3 id="例-1"><a class="header" href="#例-1">例</a></h3>
<ul>
<li>関数には「定義」と「実行」が必要．</li>
<li>関数には必ず名前をつける．</li>
<li><code>{}</code>内に実行してほしい処理を記述する．</li>
<li>「実行」したいときは名前を呼び出す．</li>
</ul>
<pre><code class="language-js">// 関数の定義
function test(){
  console.log('関数は便利！');
}

// 関数の実行
test();

</code></pre>
<h2 id="引数と戻り値"><a class="header" href="#引数と戻り値">引数と戻り値</a></h2>
<p>関数は「なにかを入力して」「処理した結果を出力する」動きが基本となる．</p>
<h3 id="引数"><a class="header" href="#引数">引数</a></h3>
<p>引数とは「関数に入力する値」である．</p>
<ul>
<li>定義した関数に対して，処理に必要な値を入力する．</li>
<li>引数の数は一つでも複数でもOK！</li>
</ul>
<h3 id="戻り値"><a class="header" href="#戻り値">戻り値</a></h3>
<p>戻り値とは「関数から出力されてくる値」である．</p>
<ul>
<li>関数の中で計算などを実行した後，結果を返す処理．</li>
<li>関数内の変数，配列，オブジェクトなどで返せる．</li>
</ul>
<h3 id="例-2"><a class="header" href="#例-2">例</a></h3>
<p><code>a</code>と<code>b</code>の2つの数を入力し，「加算した結果」を出力する関数を考える．</p>
<p>この場合，<code>a</code>と<code>b</code>が「引数」で<code>total</code>が戻り値となる．</p>
<pre><code class="language-js">// 関数の定義
function add(a, b){
  const total = a + b;
  return total;
}

// 関数の実行
const sum = add(10, 20);
console.log(sum);   // 30

</code></pre>
<h2 id="数学の関数と同じ"><a class="header" href="#数学の関数と同じ">数学の関数と同じ</a></h2>
<p>プログラミングの関数は理解が難しいものの一つであるが，数学の関数と同じイメージを持つと理解しやすい．</p>
<h3 id="数学の関数"><a class="header" href="#数学の関数">数学の関数</a></h3>
<p>数学の関数は「何かの数値を入力」すると「決まった計算を実行した結果を出力」するものである．</p>
<p>例えば，<code>f(x) = x^2 + 2x + 1</code>と関数を定義すると．．．</p>
<ul>
<li><code>f(2) = 9</code>,</li>
<li><code>f(5) = 36</code>,</li>
<li><code>f(10) = 121</code></li>
</ul>
<p>となる．この場合，入力値・関数・出力値をまとめると以下のようになる．</p>
<table><thead><tr><th>入力値</th><th>関数</th><th>出力値</th></tr></thead><tbody>
<tr><td>2</td><td><code>f(x) = x^2 + 2x + 1</code></td><td>9</td></tr>
<tr><td>5</td><td><code>f(x) = x^2 + 2x + 1</code></td><td>36</td></tr>
<tr><td>10</td><td><code>f(x) = x^2 + 2x + 1</code></td><td>121</td></tr>
</tbody></table>
<h3 id="プログラミングの関数"><a class="header" href="#プログラミングの関数">プログラミングの関数</a></h3>
<p>上記の例をJavaScriptで書くと以下のようになる．</p>
<pre><code class="language-js">function calculate(x) {
  const result = x * x + 2 * x + 1;
  return result;
}

calculate(2);   // 9
calculate(5);   // 36
calculate(10);    // 121

</code></pre>
<p>この場合も「記述の仕方が異なるだけでやっていることは同じ」である．</p>
<table><thead><tr><th>入力値</th><th>関数</th><th>出力値</th></tr></thead><tbody>
<tr><td>2</td><td><code>calculate(x)</code></td><td>9</td></tr>
<tr><td>5</td><td><code>calculate(x)</code></td><td>36</td></tr>
<tr><td>10</td><td><code>calculate(x)</code></td><td>121</td></tr>
</tbody></table>
<h3 id="-key-point-11"><a class="header" href="#-key-point-11">💡 Key Point</a></h3>
<blockquote>
<p>引数と戻り値がない場合もある（ややこしいポイント）</p>
</blockquote>
<h2 id="言語にはじめから用意されている関数"><a class="header" href="#言語にはじめから用意されている関数">言語にはじめから用意されている関数</a></h2>
<p>これまでに使用した乱数関連も関数であるが，これらはJavaScriptがはじめから用意している関数である．</p>
<p>このような関数を「ビルドイン関数」と呼ぶ．</p>
<p>対して，開発者が自ら定義した関数を「ユーザ定義関数」と呼ぶ．</p>
<table><thead><tr><th align="right">引数</th><th>関数</th><th align="right">戻り値</th></tr></thead><tbody>
<tr><td align="right">なし</td><td><code>Math.random();</code></td><td align="right">0.534714863872</td></tr>
<tr><td align="right">3.1415926535</td><td><code>Math.floor(3.1415926535);</code></td><td align="right">3</td></tr>
</tbody></table>
<pre><code class="language-js">Math.random();    // 0.534714863872
  // 引数： なし
  // 戻り値： 0.534714863872

Math.floor(3.1415926535);   // 3
  // 引数： 3.1415926535
  // 戻り値： 3

</code></pre>
<h2 id="参考関数の記述方法"><a class="header" href="#参考関数の記述方法">【参考】関数の記述方法</a></h2>
<p>JavaScriptにおける関数の定義は以下の3種類を用いることができる．どの方法で記述しても実行方法は同じ．</p>
<p>（現段階では）どれでも同様と考えてOK．</p>
<pre><code class="language-js">function add1(a, b){
  return a + b;
}

const add2 = function(a, b){
  return a + b;
}

const add3 = (a, b) =&gt; {
  return a + b;
}

// 全部同じという理解でOK！
const result1 = add1(10, 20);
const result2 = add2(10, 20);
const result3 = add3(10, 20);

</code></pre>
<h2 id="関数の利用"><a class="header" href="#関数の利用">関数の利用</a></h2>
<h3 id="関数の利点"><a class="header" href="#関数の利点">関数の利点</a></h3>
<p>イベントごとに毎回同じ処理を書くのは面倒！</p>
<p>関数を定義しておけば，ボタン押したら実行するだけ！</p>
<h3 id="例-3"><a class="header" href="#例-3">例</a></h3>
<p>押したボタンに応じて，異なる範囲の乱数を発生させたい！</p>
<pre><code class="language-js">// 関数の定義
function generateRandomNumber(min, max){
  const rand = Math.floor(Math.random() * (max - min + 1) + min);
  return rand;
}

// 実行するときはこんな感じ
const result = generateRandomNumber(1, 9);
console.log(result);

</code></pre>
<h3 id="ボタンクリックイベントと組み合わせ"><a class="header" href="#ボタンクリックイベントと組み合わせ">ボタンクリックイベントと組み合わせ</a></h3>
<p>ボタンによって異なる範囲の乱数を発生させることもできる．</p>
<pre><code class="language-js">$('#btn01').on('click', function () {
 const result = generateRandomNumber(1, 10);
  $('#echo').text(result);
});

$('#btn02').on('click', function () {
 const result = generateRandomNumber(10, 20);
  $('#echo').text(result);
});

$('#btn03').on('click', function () {
 const result = generateRandomNumber(20, 100);
  $('#echo').text(result);
});

</code></pre>
<p>【参考】janken.htmlに関数を使用したじゃんけんの例もあります！</p>
<h2 id="練習-7"><a class="header" href="#練習-7">練習</a></h2>
<ul>
<li>最小値と最大値を入力してランダムな数を返す関数を定義しよう！</li>
<li>各ボタンのクリック時に関数を実行し，結果を<code>#echo</code>に出力しよう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="リアルタイムチャットの実装"><a class="header" href="#リアルタイムチャットの実装">リアルタイムチャットの実装</a></h1>
<h2 id="今回実装するアプリケーション"><a class="header" href="#今回実装するアプリケーション">今回実装するアプリケーション</a></h2>
<p>LocalStorageを利用したメモ帳アプリケーションでは，データを「ブラウザ」自体に保存する処理を実装した．</p>
<p>今回は更に発展させ，オンライン上にデータを保存する処理を実装し，リアルタイムに表示が更新されるチャットアプリケーションを実装する．</p>
<p><img src="js/js04/./img/js_firebase_about_chat_app.svg" alt="チャットアプリケーションのイメージ" /></p>
<p>このような動きを実装するために，Googleが提供する「Firebase」を活用する．</p>
<h2 id="firebasecloud-firestoreとは"><a class="header" href="#firebasecloud-firestoreとは">Firebase（Cloud Firestore）とは</a></h2>
<p>Firebaseは、クライアントからアクセス可能なデータベースとしてFirebase Realtime Database( 以下 Realtime Database)とCloud Firestoreの2つを用意しています．</p>
<p>Realtime Databaseは，リアルタイムでクライアント全体の状態を同期させる必要があるモバイルアプリ向けの効率的で低レイテンシなものです．</p>
<p>Realtime Databaseはクラウド上でホスティングされるNoSQLのデータベースです．データはすべてのクライアントにわたってリアルタイムに同期され、アプリがオフラインになっても利用可能です．クロスプラットフォームアプリを構築した場合でも，すべてのクライアン トが1つのRealtime Databaseを共有して，最新のデータへの更新を自動的に行います．またクライアントからも直接アクセスが可能なため自前のサーバなしで使えるデータベースとしても活用できます．</p>
<p>Cloud Firestoreは，直感的な新しいデータモデルで，Realtime Databaseの性能をさらに向上しており，Realtime Databaseよりも豊かで高速なクエリとスケールを備えています．Cloud Firestoreは2017年のGoogle I/Oで発表されたプロダクトであり，2018年5月現在はベータ版リリースです．</p>
<p>引用：WEB+DB PRESS vol.105 第4章（※2019年2月より正式版として運用されています．）</p>
<h2 id="つまり"><a class="header" href="#つまり">つまり．．？</a></h2>
<ul>
<li>サーバ上にデータを保存できる！</li>
<li>保存したデータをリアルタイムに同期できる！</li>
<li>異なるデバイスでもデータを共有可能！
<ul>
<li>PCとスマホでリアルタイムにデータを同期できる．</li>
</ul>
</li>
<li>JavaScriptのみで実装可能！
<ul>
<li>Swift, Go, Pythonなど他の言語でも使用可！</li>
</ul>
</li>
</ul>
<table><thead><tr><th></th><th>データの保存場所</th><th>データを使用できる範囲</th></tr></thead><tbody>
<tr><td>LocalStorage</td><td>ブラウザ</td><td>自分のPC（ブラウザ）</td></tr>
<tr><td>Firebase</td><td>オンライン上のサーバ</td><td>同じアプリケーションを動かしている端末全て</td></tr>
</tbody></table>
<p>Firebaseを活用するにはアカウントやプロジェクトの準備が必要になるため，次項から進める．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="firebaseの準備1プロジェクトの作成"><a class="header" href="#firebaseの準備1プロジェクトの作成">Firebaseの準備1（プロジェクトの作成）</a></h1>
<p>まずはFirebaseの「プロジェクト」を作成する．</p>
<p>Firebaseでは「プロジェクト」単位で管理を行う．</p>
<h2 id="管理画面へのアクセス"><a class="header" href="#管理画面へのアクセス">管理画面へのアクセス</a></h2>
<p>下記URLにアクセスしよう．</p>
<p><a href="https://firebase.google.com/">https://firebase.google.com/</a></p>
<ul>
<li>アクセスしたら右上の「ログイン」からログインする．</li>
<li>すでにログイン済みの場合は「コンソールへ移動」をクリックする．</li>
</ul>
<h2 id="プロジェクトの作成"><a class="header" href="#プロジェクトの作成">プロジェクトの作成</a></h2>
<p>下記画面から「プロジェクトの作成」をクリックする．</p>
<p><img src="js/js04/./img/20210616120245.png" alt="Firebaseプロジェクト作成" /></p>
<p>プロジェクトの名前を入力する．何のアプリケーションなのかわかるように名前をつけると良い．</p>
<p>同意するに✅を入れて「続行」をクリックする．</p>
<p><img src="js/js04/./img/20210616120512.png" alt="Firebaseプロジェクト情報入力1" /></p>
<p>アナリティクスは使用しないので外す．外さないとエラーが出ることがあるので外すこと．</p>
<p><img src="js/js04/./img/20210616120730.png" alt="アナリティクス外す" /></p>
<p>「プロジェクトを作成」をクリックして少し待つとプロジェクトが作成される．「続行」をクリックすると画面が切り替わる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="firebaseの準備2ソースコードの準備"><a class="header" href="#firebaseの準備2ソースコードの準備">Firebaseの準備2（ソースコードの準備）</a></h1>
<h2 id="プロジェクトとjavascriptの連携"><a class="header" href="#プロジェクトとjavascriptの連携">プロジェクトとJavaScriptの連携</a></h2>
<p>画面の下記部分をクリックする．</p>
<p><img src="js/js04/./img/20210616122043.png" alt="Webアプリ追加" /></p>
<p>ニックネームを入力するよう促されるので適当に入力する（プロジェクト名と同じが良い？）．</p>
<p>「Firebase Hosting」の✅は入れないこと．「アプリを登録」をクリックすると次の画面に切り替わる．</p>
<p><img src="js/js04/./img/20210616122207.png" alt="ニックネーム設定" /></p>
<p>コードが表示されるので全てコピーする．</p>
<p><img src="js/js04/./img/20210616122317.png" alt="コードコピー" /></p>
<p><code>chatapp.html</code>にコピーしたコードを貼り付ける．このコードがFirebaseのプロジェクトとソースコードでやり取りをするために必要になる．</p>
<p>貼り付けた<code>&lt;script&gt;</code>タグの中身を修正する．</p>
<blockquote>
<p>修正前</p>
<p><code>&lt;script src=&quot;https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js&quot;&gt;&lt;/script&gt;</code></p>
</blockquote>
<blockquote>
<p>修正後</p>
<p><code>&lt;script src=&quot;https://www.gstatic.com/firebasejs/8.6.7/firebase.js&quot;&gt;&lt;/script&gt;</code></p>
</blockquote>
<p>エディタ上で下記のような状態になっていればOK！</p>
<pre><code class="language-html">&lt;!-- chatapp.html --&gt;
&lt;!-- ここにFirebaseのコードを貼り付けよう --&gt;

&lt;!-- The core Firebase JS SDK is always required and must be listed first --&gt;
&lt;script src=&quot;https://www.gstatic.com/firebasejs/8.6.7/firebase.js&quot;&gt;&lt;/script&gt;

&lt;!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries --&gt;

&lt;script&gt;
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: &quot;AIzaSyBPm676fTHNHq2_hogehoge_wryyyyyy&quot;,
    authDomain: &quot;chat-app-test-4e1e4.firebaseapp.com&quot;,
    projectId: &quot;chat-app-test-4e1e4&quot;,
    storageBucket: &quot;chat-app-test-4e1e4.appspot.com&quot;,
    messagingSenderId: &quot;929064315016&quot;,
    appId: &quot;1:929064315016:web:79dd676be9a71b1803173d&quot;
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
&lt;/script&gt;

</code></pre>
<p>コードを貼り付けたらブラウザ画面の「コンソールに進む」ボタンをクリックする．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="firebaseの準備3データベースの準備"><a class="header" href="#firebaseの準備3データベースの準備">Firebaseの準備3（データベースの準備）</a></h1>
<h2 id="データベースの準備"><a class="header" href="#データベースの準備">データベースの準備</a></h2>
<p>データを実際に保存するためのデータベースを準備する．</p>
<p>コンソール画面から「構築」 -&gt; 「Firestore Database」 -&gt; 「データベースを作成」の順にクリック．</p>
<p><img src="js/js04/./img/20210616123536.png" alt="db準備" /></p>
<p>ルールは必ず「テストモードで開始」を選択して「次へ」をクリック．</p>
<p><img src="js/js04/./img/20210616123750.png" alt="dbルール設定" /></p>
<p>ロケーションは適当でOK．「有効にする」をクリックすると次の画面に移動する．</p>
<p><img src="js/js04/./img/20210616123858.png" alt="dbロケーション設定" /></p>
<h2 id="コレクションの作成"><a class="header" href="#コレクションの作成">コレクションの作成</a></h2>
<p>データを保存する際には「コレクション」と「ドキュメント」という単位で管理する．</p>
<p>これらは「フォルダ」と「ファイル」の関係によく似ている．</p>
<p><a href="https://firebase.google.com/docs/firestore/data-model?hl=ja">参考（ドキュメント）</a></p>
<table><thead><tr><th></th><th>データの容器</th><th>データの単位</th></tr></thead><tbody>
<tr><td>PC</td><td>フォルダ</td><td>ファイル</td></tr>
<tr><td>Firestore</td><td>コレクション</td><td>ドキュメント</td></tr>
</tbody></table>
<p>Firestoreの機能を利用するには「コレクション」を作成してテストデータを入力しておく．下記画面の「コレクションを開始」をクリックする．</p>
<p><img src="js/js04/./img/20210616124349.png" alt="コレクション開始" /></p>
<p>コレクションIDに「<code>chat</code>」を入力し「次へ」をクリックする．</p>
<p><img src="js/js04/./img/20210616124917.png" alt="コレクション作成" /></p>
<p>テスト用のドキュメントを作成する．ドキュメントの構成はメッセージを送信したユーザ名の<code>name</code>，メッセージの本文である<code>text</code>，送信日時を表す<code>time</code>の3項目とする．</p>
<p>下記の手順でドキュメントを作成しよう．</p>
<ul>
<li>ドキュメントIDは「自動ID」をクリック．</li>
<li>フィールドには「<code>name</code>」「<code>text</code>」「<code>time</code>」の3項目を設定．</li>
<li><code>name</code>と<code>text</code>には<code>String</code>，<code>time</code>には<code>timestamp</code>形式を選択する．</li>
<li>各フィールドには適当な値を入力しておく．</li>
</ul>
<p>設定したら「保存」をクリックする．</p>
<p><img src="js/js04/./img/20210616125231.png" alt="ドキュメント作成" /></p>
<p>下記のようにデータが保存されていればデータベースの準備は完了！</p>
<p><img src="js/js04/./img/20210616125644.png" alt="データ確認" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="チャット画面の実装とデータの送信"><a class="header" href="#チャット画面の実装とデータの送信">チャット画面の実装とデータの送信</a></h1>
<h2 id="チャット画面の実装"><a class="header" href="#チャット画面の実装">チャット画面の実装</a></h2>
<p>nameとtextの入力欄を作成する．</p>
<p>送信時にidを指定して入力した値を取得するため，<code>&lt;input&gt;</code>タグの2箇所と<code>&lt;button&gt;</code>にidを指定する．</p>
<pre><code class="language-html">&lt;!-- chatapp.html --&gt;

&lt;form&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;チャット入力画面&lt;/legend&gt;
    &lt;div&gt;
      name: &lt;input type=&quot;text&quot; id=&quot;name&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      text: &lt;input type=&quot;text&quot; id=&quot;text&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button type=&quot;button&quot; id=&quot;send&quot;&gt;send&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<p>下図のような画面となる．</p>
<p><img src="js/js04/./img/20210616144514.png" alt="チャット入力画面" /></p>
<h2 id="データ送信の処理"><a class="header" href="#データ送信の処理">データ送信の処理</a></h2>
<p>続いて，上記の入力画面でnameとtextを入力して送信ボタンをクリックしたタイミングでFirestore上に新しいデータを作成する処理を実装する．</p>
<h3 id="リアルタイム通信の準備"><a class="header" href="#リアルタイム通信の準備">リアルタイム通信の準備</a></h3>
<p>前項で作成したコレクションとやり取りをするため，下記のコードを追記する．追記場所は張り付けたFirebase関連のコード下くらいでOK．</p>
<h3 id="-key-point-12"><a class="header" href="#-key-point-12">💡 Key Point</a></h3>
<blockquote>
<p>このコードでは<code>chat</code>コレクションの接続情報を<code>db</code>に保存する．この1行を書いておくことで<code>db</code>に対してデータの追加や取得ができるようになる．</p>
</blockquote>
<pre><code class="language-js">// chatapp.html

const db = firebase.firestore().collection('chat');

</code></pre>
<h3 id="送信ボタンクリック時にデータを送信"><a class="header" href="#送信ボタンクリック時にデータを送信">送信ボタンクリック時にデータを送信</a></h3>
<p>続いて，送信ボタンクリック時にデータを送信する処理を実装する．</p>
<p>まずはボタンのクリックイベントを作成．</p>
<pre><code class="language-js">// chatapp.html

$('#send').on('click', function () {
  // 送信時に必要な処理
});

</code></pre>
<p>続いてクリックイベント内に「入力値を取得する処理」と「データを送信する処理」を記述する．</p>
<p>ポイントは，</p>
<ul>
<li>id指定して<code>.val()</code>で入力値を取得する．</li>
<li>データを送信する際にはオブジェクト形式にする必要がある．</li>
<li><code>time</code>はFirestoreの独自形式となるため，Firestore側で用意されている関数を使用する．</li>
</ul>
<pre><code class="language-js">// chatapp.html

const data = {
  name: $('#name').val(),
  text: $('#text').val(),
  time: firebase.firestore.FieldValue.serverTimestamp(),
};
db.add(data);
$('#text').val('');

</code></pre>
<h2 id="動作確認-1"><a class="header" href="#動作確認-1">動作確認</a></h2>
<p>コードを記述したらブラウザの画面から<code>name</code>と<code>text</code>を入力して．．．</p>
<p><img src="js/js04/./img/20210616145454.png" alt="動作確認（ブラウザ）" /></p>
<p>Firebaseのコンソール画面でデータが保存されていればOK！</p>
<p><img src="js/js04/./img/20210616145647.png" alt="動作確認（コンソール）" /></p>
<h2 id="練習-8"><a class="header" href="#練習-8">練習</a></h2>
<p>下記の処理を実装し，Firestoreにデータを保存しよう！</p>
<ol>
<li>入力画面の作成</li>
<li>データの送信処理</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="データのリアルタイム取得と画面表示"><a class="header" href="#データのリアルタイム取得と画面表示">データのリアルタイム取得と画面表示</a></h1>
<h2 id="保存されているデータの扱い"><a class="header" href="#保存されているデータの扱い">保存されているデータの扱い</a></h2>
<p>Firestoreではデータの取得方法はいくつか用意されているが，最大の特徴は「データベースの変更を検知して自動的にデータを取得できる」ことである．</p>
<p>（本来はサーバ側の言語での実装が必要であり，難易度も高い．WebSocketなどの実装が必要）</p>
<h2 id="処理の流れ"><a class="header" href="#処理の流れ">処理の流れ</a></h2>
<p>流れは送信と比較して複雑となる．理由は以下のとおり．</p>
<ul>
<li>動作のタイミングがつかみにくい．</li>
<li>取得したデータが非常に複雑な状態．</li>
<li>必要な3項目を取得するためにFirestore側で用意された関数を使用する必要がある．</li>
</ul>
<h2 id="データの取得"><a class="header" href="#データの取得">データの取得</a></h2>
<p>まずはFirestore上に保存されているデータを取得してconsoleに出力する．</p>
<ul>
<li>データに変更（追加，更新，削除など）が生じたタイミングで実行される<code>.onSnapshot()</code>を使用する．</li>
<li><code>.onSnapshot()</code>はデータベース上でデータの変更が発生したタイミングで<code>{}</code>内の処理を実行する．</li>
<li>Firestore上に保存されているデータは<code>querySnapshot.docs</code>に入っている．</li>
</ul>
<pre><code class="language-js">// chatapp.html

db.onSnapshot(function (querySnapshot) {
  console.log(querySnapshot.docs);
});

</code></pre>
<h2 id="データの取り出し"><a class="header" href="#データの取り出し">データの取り出し</a></h2>
<p>上記<code>querySnapshot.docs</code>は非常に複雑な形となっており，このまま扱うことは難しい．</p>
<p>そのため，必要なデータのみ抽出した「オブジェクト形式の配列」に変換する．</p>
<ol>
<li>空の配列を準備．</li>
<li><code>querySnapshot.docs</code>に対して繰り返し処理を用いて各要素に対して，
<ul>
<li><code>.id</code>でドキュメントID（名前）を取得する．</li>
<li><code>.data()</code>でドキュメント中身（3項目）を取得する．</li>
</ul>
</li>
<li>上記のデータのみを1で用意した配列に追加．</li>
</ol>
<pre><code class="language-js">// chatapp.html
// 前項の`console.log()`下に記述

const dataArray = [];
querySnapshot.docs.forEach(function (doc) {
  const data = {
    id: doc.id,
    data: doc.data(),
  };
  dataArray.push(data);
});

console.log(dataArray);

</code></pre>
<h3 id="-key-point-13"><a class="header" href="#-key-point-13">💡 Key Point</a></h3>
<blockquote>
<p>難しい形式のデータは変換して「自分が慣れている形式」に変換すると扱いやすい．</p>
</blockquote>
<h2 id="画面表示するためのタグ生成"><a class="header" href="#画面表示するためのタグ生成">画面表示するためのタグ生成</a></h2>
<p>必要な情報のみを抽出した配列が作成できたため，この配列から画面表示用のタグを作成する．</p>
<p>前項で作成した<code>dataArray</code>を基にして，</p>
<ol>
<li>空の配列を準備する．</li>
<li><code>dataArray</code>に繰り返しを用い，各要素をタグの形にする．</li>
<li>繰り返し処理終了後に指定したid部分に出力する．</li>
</ol>
<pre><code class="language-js">// chatapp.html
// 前項の`console.log()`下に記述

const tagArray = [];
dataArray.forEach(function (data) {
  tagArray.push(`
    &lt;div id=&quot;${data.id}&quot;&gt;
      &lt;p&gt;${data.data.name} at ${data.data.time}&lt;/p&gt;
      &lt;p&gt;${data.data.text}&lt;/p&gt;
    &lt;/div&gt;
  `);
});

$('#output').html(tagArray);

</code></pre>
<h2 id="動作確認-2"><a class="header" href="#動作確認-2">動作確認</a></h2>
<p>上記のコードを記述すると「Firestore上でデータが変更されたタイミング」で<code>{}</code>内の処理が実行され，最新のデータが画面に反映される．</p>
<p><img src="js/js04/./img/20210616152526.png" alt="データ取得" /></p>
<p>また，「Firestore上でデータが変更されたタイミング」で動作するため，複数タブで片方だけ操作した状態でもう片方の動作を確認することができる．</p>
<h2 id="練習-9"><a class="header" href="#練習-9">練習</a></h2>
<p>下記の順番でデータの表示を実装しよう．</p>
<ol>
<li>データ本体を取得．</li>
<li>データから必要なものだけを抽出．</li>
<li>抽出したデータからタグを作成．</li>
<li>タグを画面に表示．</li>
</ol>
<p>入力フォームからデータを送信し，一覧に追加されればOK．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="機能追加"><a class="header" href="#機能追加">機能追加</a></h1>
<p>データの取得と表示（データ送信と同時に画面更新）は実装ができたが，下記の問題点がある．</p>
<ul>
<li>時刻がわかりにくい．</li>
<li>最新がどれなのかわかりにくい．</li>
</ul>
<p>これらを解決するために以下の処理を実装していく．</p>
<h2 id="時刻データの表示形式変更"><a class="header" href="#時刻データの表示形式変更">時刻データの表示形式変更</a></h2>
<p>JavaScriptにおいて時刻処理は非常に煩雑である．時刻関連の処理を実装するためにはライブラリを使用したほうが実装の負荷が少なくバグも少ない．</p>
<h3 id="時刻変換関数"><a class="header" href="#時刻変換関数">時刻変換関数</a></h3>
<p>今回はサンプルコード内に時刻の形式を変換する関数（下記）を記述しておいたため，これを利用する．解説は省略．</p>
<pre><code class="language-js">// chatapp.html内に記述してある関数

function convertTimestampToDatetime(timestamp) {
  const _d = timestamp ? new Date(timestamp * 1000) : new Date();
  const Y = _d.getFullYear();
  const m = (_d.getMonth() + 1).toString().padStart(2, '0');
  const d = _d.getDate().toString().padStart(2, '0');
  const H = _d.getHours().toString().padStart(2, '0');
  const i = _d.getMinutes().toString().padStart(2, '0');
  const s = _d.getSeconds().toString().padStart(2, '0');
  return `${Y}/${m}/${d} ${H}:${i}:${s}`;
}

</code></pre>
<h3 id="関数を利用"><a class="header" href="#関数を利用">関数を利用</a></h3>
<p>本関数を利用して，タグ生成部分の処理で時刻形式を変換する．</p>
<pre><code class="language-js">// chatapp.html

const tagArray = [];
dataArray.forEach(function (data) {
  tagArray.push(`
    &lt;div id=&quot;${data.id}&quot;&gt;
      &lt;p&gt;${data.data.name} at ${convertTimestampToDatetime(data.data.time.seconds)}&lt;/p&gt;
      &lt;p&gt;${data.data.text}&lt;/p&gt;
    &lt;/div&gt;
  `);
});

</code></pre>
<h3 id="動作確認-3"><a class="header" href="#動作確認-3">動作確認</a></h3>
<p>下記のように人間が認識しやすい形式になって表示される．</p>
<p><img src="js/js04/./img/20210616154031.png" alt="時刻形式変換" /></p>
<h2 id="データの並び替え"><a class="header" href="#データの並び替え">データの並び替え</a></h2>
<p>本アプリケーションはチャット機能がメインであるため，送信日時が新しいメッセージが上部に表示されることが望ましい．</p>
<p>しかし，初期状態ではFirestore上のID名順でデータを取得しているため，<code>time</code>でソートされた状態でデータを取得できるようにしたい．</p>
<ul>
<li>データのソートには<code>.orderBy()</code>を利用する．</li>
<li><code>.orderBy()</code>には2つのデータを入力する．1つ目は「どの項目で並び替えをするか」2つ目は「昇順（<code>asc</code>）か降順（<code>desc</code>）」である．</li>
</ul>
<p>データ取得時の処理に追記する．</p>
<pre><code class="language-js">// chatapp.html

db.orderBy('time', 'desc').onSnapshot(function (querySnapshot) {
  // 省略
});

</code></pre>
<p>ブラウザで並び順が変更されているか確認しよう．</p>
<h2 id="おまけenterキーで送信"><a class="header" href="#おまけenterキーで送信">【おまけ】Enterキーで送信</a></h2>
<p>ボタンクリックではなく，メッセージ入力時にEnterキーを押して送信することもできる．</p>
<p>この場合，イベント情報から「入力したキーを識別するキーコード」を抽出してキーを判別する．</p>
<ul>
<li><code>function (e)</code>の<code>e</code>にイベント情報（この場合<code>keydown</code>）で取得可能なデータが格納される．</li>
<li><code>e.keyCode</code>でどのキーを押したかが識別可能であるため，Enterのキーコードを調べておけば条件分岐でデータ送信を行える．</li>
</ul>
<pre><code class="language-js">// chatapp.html

$('#text').on('keydown', function (e) {
  if (e.keyCode === 13) {
    const data = {
      name: $('#name').val(),
      text: $('#text').val(),
      time: firebase.firestore.FieldValue.serverTimestamp(),
    };
    db.add(data);
    $('#text').val('');
  }
});

</code></pre>
<p>このように，JavaScriptではイベントに関連した情報を取得することができる．これらを用いて画面の特定の部分をクリックしたときだけ発火させたり，決まった順にタイプしたときだけ発火させたりできる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題と提出時の注意点"><a class="header" href="#課題と提出時の注意点">課題と提出時の注意点</a></h1>
<p><strong>Firebaseを使用したアプリを実装しよう！</strong></p>
<p>Firebaseを用いることで複数の端末での双方向的なやり取りを実装することが可能となる．</p>
<p>今回はデータを追加していく方式で実装したが，データを削除したり上書きしたりすることも可能だ．</p>
<p>今回使用したFirestore以外にも様々な機能がある．本気出せばWebアプリケーションを全て実装してデプロイできるだけの可能性を秘めた技術であるッ！</p>
<ul>
<li>認証（Authentication）</li>
<li>ファイル保存（Storage）</li>
<li>デプロイ（Hosting）</li>
<li>サーバサイドの実装（Functions）</li>
</ul>
<h2 id="実装例"><a class="header" href="#実装例">実装例</a></h2>
<ul>
<li>スタンプ送信機能</li>
<li>オンラインでじゃんけん</li>
<li>出席管理システム</li>
<li>オリジナルSNS</li>
<li>MMORPGを開発</li>
</ul>
<h2 id="-注意点"><a class="header" href="#-注意点">⚠️ 注意点</a></h2>
<h3 id="apiキーの扱い"><a class="header" href="#apiキーの扱い">APIキーの扱い</a></h3>
<ul>
<li>FirebaseにはAPIキーが必要になります．</li>
<li>誰でも見られるGithubにあげてしまうとあまりよろしくない．</li>
</ul>
<p>Githubにpushする前に．．．</p>
<ul>
<li><code>git add .</code>する前にAPIキー部分は一旦削除しておきましょう．</li>
<li>提出フォームのコメント欄にAPIキーを記述してください！</li>
</ul>
<pre><code class="language-html">&lt;script&gt;
  // Your web app's Firebase configuration
  var firebaseConfig = {
    // 🔽この1行を`git add .`する前に一旦削除！削除したAPIキーは「提出フォームのAPIkey欄」に記述！
    apiKey: &quot;AIzaSyBPm676fTHNHq2_hogehoge_wryyyyyy&quot;,
    authDomain: &quot;chat-app-test-4e1e4.firebaseapp.com&quot;,
    projectId: &quot;chat-app-test-4e1e4&quot;,
    storageBucket: &quot;chat-app-test-4e1e4.appspot.com&quot;,
    messagingSenderId: &quot;929064315016&quot;,
    appId: &quot;1:929064315016:web:79dd676be9a71b1803173d&quot;
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
&lt;/script&gt;

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_api"><a class="header" href="#js_api">JS_API</a></h1>
<h2 id="事前準備-1"><a class="header" href="#事前準備-1">事前準備</a></h2>
<p>今回はマイクロソフトのアカウントを使用します！</p>
<p>無料で取得できますので，事前に作成しておいてください！</p>
<ul>
<li>下記参考サイトの「既に持ってるメアドを使う場合」でアカウントを作りましょう．</li>
<li>すでにお持ちの方は既存のアカウントでOKです！</li>
<li>不明点あればslackにコメントください！</li>
</ul>
<p><a href="https://kaoruya.org/blog/ms-account/#i-3">https://kaoruya.org/blog/ms-account/#i-3</a></p>
<h2 id="本講義の内容とゴール-3"><a class="header" href="#本講義の内容とゴール-3">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-3"><a class="header" href="#本講義の内容-3">本講義の内容</a></h3>
<ul>
<li>Google Books APIを用いたリクエストとレスポンスを扱う．</li>
<li>Bing Maps APIを用いて外部APIを用いた画面操作を行う．</li>
<li>自身のアイデアを元にAPIを探す．</li>
</ul>
<h3 id="本講義のゴール-3"><a class="header" href="#本講義のゴール-3">本講義のゴール</a></h3>
<ul>
<li>Webアプリケーションにおけるリクエストとレスポンスの概念を把握する．</li>
<li>JavaScriptを用いたAPI連携処理を実装することで，処理の基本的な流れを理解する．</li>
<li>自分のアイデアから関連するAPIを探し，実装にチャレンジできるようになる．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="apiとは"><a class="header" href="#apiとは">APIとは</a></h1>
<h2 id="apiの意味合い"><a class="header" href="#apiの意味合い">APIの意味合い</a></h2>
<p>Application Programming Interfaceの略．</p>
<p>あるアプリケーション（例えばGoogle MapやTwitterなど）の一部を外部に向けて公開することにより，第三者が開発したソフトウェアに機能を組み込めるようにしたものである．</p>
<p>世の中に存在するサービスの機能の一部を使わせてもらえるイメージ！</p>
<blockquote>
<p>Interface</p>
<ul>
<li>Interfaceは「あるもの」と「あるもの」をつなぐもの，という意味合い．</li>
<li>今回は（すでに動いている）アプリケーションと（開発者が実装する）プログラムをつなぐ．</li>
</ul>
</blockquote>
<h2 id="apiの一例"><a class="header" href="#apiの一例">APIの一例</a></h2>
<table><thead><tr><th>API名</th><th>概要</th></tr></thead><tbody>
<tr><td>Bing Maps API</td><td>リクエストに応じてブラウザに地図を表示したり，ルート検索したりする．</td></tr>
<tr><td>Google Books API</td><td>Google Booksが持っている書籍の情報から，キーワードなど指定してデータ- を返す．</td></tr>
<tr><td>Open Weather Map API</td><td>都市名や緯度経度を指定して，その日の天気や天気予報の情報を返す．</td></tr>
</tbody></table>
<h2 id="apiの利点"><a class="header" href="#apiの利点">APIの利点</a></h2>
<ul>
<li>他社のデータを利用できる！</li>
<li>自分で作らなくて良いので開発速度がアップ！</li>
<li>いろいろなAPIを組み合わせてアプリケーションを実装できる！</li>
</ul>
<h2 id="動き方のイメージ"><a class="header" href="#動き方のイメージ">動き方のイメージ</a></h2>
<p>基本は「リクエスト」と「レスポンス」！</p>
<p>API（外部のサーバ）にJavaScriptでリクエスト（要求）を送信し，API側にデータを返してもらったり処理を実行してもらったりする．</p>
<p>Webアプリケーションのサーバ側の処理をAPIに行ってもらうイメージ！</p>
<p><img src="js/js05/./img/js_api_about_api.svg" alt="APIの動き方" /></p>
<h3 id="apiにリクエストを送信してデータをもらうタイプこちらが一般的"><a class="header" href="#apiにリクエストを送信してデータをもらうタイプこちらが一般的">APIにリクエストを送信してデータをもらうタイプ（こちらが一般的）</a></h3>
<p>検索条件などを指定して，条件に合う情報を送ってもらう．</p>
<table><thead><tr><th>API</th><th>送信するデータ</th><th>受け取れるデータ</th></tr></thead><tbody>
<tr><td>Google Books API</td><td>本のタイトルに含まれるキーワード，著者，出版社，出版年，etc...</td><td>条件に該当する本のデータ</td></tr>
<tr><td>Open Weather Map API</td><td>都市名，緯度経度，etc</td><td>現在の気象情報，一週間分の天気予報，etc...</td></tr>
<tr><td>テキスト解析</td><td>テキストデータ</td><td>テキストの感情データ，要，約，etc...</td></tr>
<tr><td>画像認識</td><td>画像データ</td><td>画像に映っているもの名称，位置，etc...</td></tr>
<tr><td>音声認識</td><td>音声データ</td><td>音声を文字起こししたテキスト</td></tr>
</tbody></table>
<h3 id="apiに定められたコードを実行してブラウザを操作してもらうタイプ"><a class="header" href="#apiに定められたコードを実行してブラウザを操作してもらうタイプ">APIに定められたコードを実行してブラウザを操作してもらうタイプ</a></h3>
<p>条件を指定して，実際にブラウザ表示などをやってもらう．</p>
<table><thead><tr><th>API</th><th>やってもらえること</th></tr></thead><tbody>
<tr><td>Bing Maps API</td><td>場所などを指定して地図を表示，ルート検索，住所を緯度経度に変換，etc...</td></tr>
<tr><td>Google Maps API</td><td>地図表示，ストリートビュー表示，etc...</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="googlebooksapi"><a class="header" href="#googlebooksapi">GoogleBooksAPI</a></h1>
<h2 id="google-books-apiとは"><a class="header" href="#google-books-apiとは">Google Books APIとは</a></h2>
<p><a href="https://developers.google.com/books/docs/overview">ドキュメント</a></p>
<p>本APIに限らず，APIには必ずドキュメント（仕様書）が存在する．</p>
<p>ドキュメントには下記のような重要な情報が記載されているため，必ず目を通そう．</p>
<ul>
<li>APIにできること（得られるデータややってくれる処理など）．</li>
<li>APIの使い方やサンプルコード．</li>
<li>料金（無料のものと有料のものが存在する）．</li>
</ul>
<h2 id="特徴"><a class="header" href="#特徴">特徴</a></h2>
<ul>
<li>Google Booksに登録されている本のjsonデータを取得できる！</li>
<li>タイトルや著者などで条件を指定できる！</li>
<li>（仕様をよく読みましょう！）</li>
<li>API keyが不要！！！</li>
</ul>
<blockquote>
<p>API keyとは</p>
<ul>
<li>APIにリクエストを送るためにはユニークな文字列が必要．</li>
<li>設定を行ったアプリケーションのみ動作させるため．（無断で使用されないように．．！）</li>
<li>この文字列をAPIキーを呼び，APIの種類問わず必須の場合が多い．</li>
</ul>
</blockquote>
<h2 id="処理の流れ-1"><a class="header" href="#処理の流れ-1">処理の流れ</a></h2>
<ul>
<li>APIに定められたURLにリクエストを送信する．</li>
<li>送信の際には欲しいデータに必要な条件などを指定する．</li>
</ul>
<h2 id="http通信の準備"><a class="header" href="#http通信の準備">HTTP通信の準備</a></h2>
<p>APIへのリクエストには「HTTP通信」という方式で送信する．</p>
<p>JavaScriptでHTTP通信を行うには下記のような複数の方法が存在する．下のものほどオススメ．</p>
<table><thead><tr><th>方法</th><th>特徴</th></tr></thead><tbody>
<tr><td>XMLHttpRequest</td><td>生JS / 一番昔から存在する</td></tr>
<tr><td>$.ajax()</td><td>jQuery / これが出てきて流行った</td></tr>
<tr><td>fetch</td><td>生JS / 慣れないと分かりづらい</td></tr>
<tr><td>axios</td><td>ReactとかVueでも使われていて使い勝手が良い</td></tr>
</tbody></table>
<p>今回は<code>axios</code>ライブラリを使用する．ライブラリであるため，下記のコードで読み込みが必要となる．</p>
<p>最近のモダンなフレームワーク（React, Vue.jsなど）でも利用されているため，今の時点から慣れておくのも良き．</p>
<pre><code class="language-html">&lt;!-- booksapi.html --&gt;

&lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;

</code></pre>
<h2 id="リクエストの送信とデータの受け取り"><a class="header" href="#リクエストの送信とデータの受け取り">リクエストの送信とデータの受け取り</a></h2>
<p>Google Books APIで指定された下記のURLにリクエストする．</p>
<p><code>https://www.googleapis.com/books/v1/volumes</code></p>
<p>リクエストの際には，得たいデータの条件などを指定する．</p>
<ul>
<li>今回は「本のタイトルに<code>javascript</code>が含まれる」という条件を指定してみる．</li>
<li>本条件を指定する場合は，上記URLの最後に「<code>?q=intitle:javascript</code>」を追加する．</li>
<li>条件の指定の仕方はドキュメントに記載されている．APIによって指定方法が異なるため，必ずドキュメントを確認しよう．</li>
</ul>
<p>リクエストは<code>axios.get()</code>関数で実行する．</p>
<pre><code class="language-js">// booksapi.html

const requestUrl = 'https://www.googleapis.com/books/v1/volumes?q=intitle:javascript';

axios.get(requestUrl)
  .then(function (response) {
    // リクエスト成功時の処理（responseに結果が入っている）
    console.log(response);
  }).catch(function (error) {
    // リクエスト失敗時の処理（errorにエラー内容が入っている）
    console.log(error);
  }).finally(function () {
    // 成功失敗に関わらず必ず実行
    console.log('done!');
  });

</code></pre>
<h3 id="リクエストを送信するaxiosgetの動き方"><a class="header" href="#リクエストを送信するaxiosgetの動き方">リクエストを送信する<code>axios.get()</code>の動き方</a></h3>
<p><code>axios.get()</code>関数の<code>.then()</code>などは実行されるタイミングが下記のように決まっている．</p>
<table><thead><tr><th>記述</th><th>実行されるタイミング</th></tr></thead><tbody>
<tr><td><code>.then(function (response) {...})</code></td><td>情報の取得に成功した場合に<code>{}</code>内が実行される．<br>取得した情報は<code>response</code>に格納されている．</td></tr>
<tr><td><code>.catch(function (error) {...}</code></td><td>情報の取得に失敗した場合に<code>{}</code>内が実行される．<br>エラーの詳細が<code>error</code>に格納されている．</td></tr>
<tr><td><code>.finally(function () {...}</code></td><td>情報の取得成否にかかわらず<code>{}</code>内が実行される．</td></tr>
</tbody></table>
<h3 id="処理の順番"><a class="header" href="#処理の順番">処理の順番</a></h3>
<p>したがって，リクエストの成否によって下記のどちらかの順番で処理が実行されることとなる．</p>
<ul>
<li>リクエスト成功の場合
<ol>
<li><code>.then(function (response) {...})</code>の<code>{}</code>内に記述した処理．</li>
<li><code>.finally(function () {...}</code>の<code>{}</code>内に記述した処理．</li>
</ol>
</li>
<li>リクエスト失敗の場合
<ol>
<li><code>.catch(function (error) {...})</code>の<code>{}</code>内に記述した処理．</li>
<li><code>.finally(function () {...}</code>の<code>{}</code>内に記述した処理．</li>
</ol>
</li>
</ul>
<h3 id="-key-point-14"><a class="header" href="#-key-point-14">💡 Key Point</a></h3>
<blockquote>
<p>重要なのはリクエストに成功した場合の処理である．</p>
<p>APIから取得したデータを使いたい場合は<code>.then(function (response) {...})</code>の<code>{}</code>内に処理を記述しよう．</p>
</blockquote>
<h2 id="実行結果"><a class="header" href="#実行結果">実行結果</a></h2>
<p>上記のコードを実行すると，コンソールには以下のようなデータが表示される．</p>
<p>データ全体はオブジェクトとなっており，<code>data.items</code>に本のデータが配列形式でまとまっている．ブラウザの検証画面をみてデータ構造や本のタイトルがどこに含まれているのかなど確認しよう．</p>
<pre><code class="language-js">// 検証画面に表示される内容

{data: {…}, status: 200, statusText: &quot;&quot;, headers: {…}, config: {…}, …}
  config: {url: &quot;https://www.googleapis.com/books/v1/volumes?q=intitle:javascript&quot;, method: &quot;get&quot;, headers: {…}, transformRequest: Array(1), transformResponse: Array(1), …}
  data:
    items: Array(10)
      0: {kind: &quot;books#volume&quot;, id: &quot;yg0fBAAAQBAJ&quot;, etag: &quot;lfbwNFyvkDg&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/yg0fBAAAQBAJ&quot;, volumeInfo: {…}, …}
      1: {kind: &quot;books#volume&quot;, id: &quot;sREfBAAAQBAJ&quot;, etag: &quot;Bbo+KCTb+os&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/sREfBAAAQBAJ&quot;, volumeInfo: {…}, …}
      2: {kind: &quot;books#volume&quot;, id: &quot;EgEfBAAAQBAJ&quot;, etag: &quot;1Sqd8Kh1nDE&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/EgEfBAAAQBAJ&quot;, volumeInfo: {…}, …}
      3: {kind: &quot;books#volume&quot;, id: &quot;oeFeDwAAQBAJ&quot;, etag: &quot;VpC+UDGt4ak&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/oeFeDwAAQBAJ&quot;, volumeInfo: {…}, …}
      4: {kind: &quot;books#volume&quot;, id: &quot;EQ0fBAAAQBAJ&quot;, etag: &quot;IUx31Y7bo5w&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/EQ0fBAAAQBAJ&quot;, volumeInfo: {…}, …}
      5: {kind: &quot;books#volume&quot;, id: &quot;sLiKBgAAQBAJ&quot;, etag: &quot;W8AX5pJDoTw&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/sLiKBgAAQBAJ&quot;, volumeInfo: {…}, …}
      6: {kind: &quot;books#volume&quot;, id: &quot;MMGlDwAAQBAJ&quot;, etag: &quot;uasA3kSjFmg&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/MMGlDwAAQBAJ&quot;, volumeInfo: {…}, …}
      7: {kind: &quot;books#volume&quot;, id: &quot;OH-ynAEACAAJ&quot;, etag: &quot;BGSumK/B93U&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/OH-ynAEACAAJ&quot;, volumeInfo: {…}, …}
      8: {kind: &quot;books#volume&quot;, id: &quot;0pfxN9xhwMIC&quot;, etag: &quot;0m0saY33NmY&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/0pfxN9xhwMIC&quot;, volumeInfo: {…}, …}
      9: {kind: &quot;books#volume&quot;, id: &quot;VI-EoAEACAAJ&quot;, etag: &quot;SvupF5US57Q&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/VI-EoAEACAAJ&quot;, volumeInfo: {…}, …}
      length: 10
    kind: &quot;books#volumes&quot;
    totalItems: 200
  headers: {cache-control: &quot;private&quot;, content-encoding: &quot;gzip&quot;, content-length: &quot;7804&quot;, content-type: &quot;application/json; charset=UTF-8&quot;, date: &quot;Sun, 06 Jun 2021 07:45:18 GMT&quot;, …}
  request: XMLHttpRequest {readyState: 4, timeout: 0, withCredentials: false, upload: XMLHttpRequestUpload, onreadystatechange: ƒ, …}
  status: 200
  statusText: &quot;&quot;

</code></pre>
<h2 id="練習-10"><a class="header" href="#練習-10">練習</a></h2>
<p>Google Books APIを使って下記を実行しよう！</p>
<ol>
<li>検索の条件を自由に設定してURLを作成しよう！</li>
<li>本の情報をconsole.log()で出力しよう！</li>
<li>本のタイトルをブラウザ上に一覧表示してみよう！</li>
<li>（タイトルにリンクを張る，本の画像を表示，などもチャレンジ）</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="位置情報の活用"><a class="header" href="#位置情報の活用">位置情報の活用</a></h1>
<h2 id="位置情報とその使われ方"><a class="header" href="#位置情報とその使われ方">位置情報とその使われ方</a></h2>
<p>近年位置情報の活用幅や重要性は増しており，サービスの8割程度で利用されているとも言われている．</p>
<p><a href="https://japan.cnet.com/article/20417587/">参考1</a></p>
<p><a href="https://forbesjapan.com/articles/detail/38376">参考2</a></p>
<h3 id="gpsなどを用いた位置情報"><a class="header" href="#gpsなどを用いた位置情報">GPSなどを用いた位置情報</a></h3>
<ul>
<li>位置情報とマップの組み合わせ</li>
<li>今まではユーザの現在地がわからなかった．</li>
<li>ユーザの現在位置を視覚的に表示できるため，どこに行けばよいかがわかる．</li>
<li>地図上に店舗データなどを表示できる．</li>
<li>道を間違っても自動的に現在地からのルートが分かる</li>
</ul>
<h3 id="wifiを用いた位置情報"><a class="header" href="#wifiを用いた位置情報">Wifiを用いた位置情報</a></h3>
<ul>
<li>店舗のマーケティングリサーチ</li>
<li>電波強度で顧客を分類する．
<ul>
<li>強ければ店内，弱ければ店外．</li>
</ul>
</li>
<li>接続時間で顧客を分類する．
<ul>
<li>時間が長ければ店内，短ければ店外．</li>
<li>営業時間内なら顧客，時間外は通行人．</li>
</ul>
</li>
</ul>
<h3 id="ビーコンを用いた位置情報"><a class="header" href="#ビーコンを用いた位置情報">ビーコンを用いた位置情報</a></h3>
<ul>
<li>店内の販促ツール．
<ul>
<li>棚の近くにビーコンを設置．</li>
<li>ユーザが近づくとLINEにクーポンを配信．</li>
</ul>
</li>
<li>ユーザにアプリ等のツールが必要ない．</li>
<li>購入レシートを送信するとポイントが当たる．</li>
<li>再度の来店を促す．</li>
</ul>
<h2 id="javscriptでの位置情報取得"><a class="header" href="#javscriptでの位置情報取得">JavScriptでの位置情報取得</a></h2>
<p>JavaScriptには標準で位置情報を取得する関数が組み込まれている．</p>
<h3 id="種類"><a class="header" href="#種類">種類</a></h3>
<p>下記2種類の方法で位置情報を取得することができる．</p>
<table><thead><tr><th>方法</th><th>概要</th></tr></thead><tbody>
<tr><td>getCurrentPosition</td><td>処理を実行したタイミングで一度だけ位置情報を取得する．</td></tr>
<tr><td>watchPosition</td><td>処理を実行すると，位置情報を常に取得し続ける．<br>バッテリー消費に注意！</td></tr>
</tbody></table>
<h3 id="オプション"><a class="header" href="#オプション">オプション</a></h3>
<p>また，上記の処理を実行する際には3種類のオプションを設定することができる．</p>
<p>オプションはオブジェクト形式で設定し，上記処理を実行する際に読み込むことで適用される．</p>
<table><thead><tr><th>オプション名</th><th>内容や設定のしかた</th></tr></thead><tbody>
<tr><td>enableHighAccuracy</td><td>対応端末でGPSを使用するかどうかの設定．<br><code>true</code>または<code>false</code>で指定．</td></tr>
<tr><td>maximumAge</td><td>指定時間以内であれば前回取得した位置情報の値を用いる．<br>ミリ秒で指定．</td></tr>
<tr><td>timeout</td><td>タイムアウト時間を設定する．<br>ミリ秒で指定．</td></tr>
</tbody></table>
<h2 id="処理の流れとコード"><a class="header" href="#処理の流れとコード">処理の流れとコード</a></h2>
<p>位置情報を取得する処理を記述する場合には，下記の3項目が必要となるため，予め用意しておく必要がある．</p>
<ol>
<li>位置情報の取得に成功した場合に実行される関数（サンプルでは<code>showPosition</code>）．</li>
<li>位置情報の取得に失敗した場合に実行される関数（サンプルでは<code>showError</code>）．</li>
<li>位置情報の取得に必要なオプション（前項で紹介したもの，サンプルでは<code>option</code>）．</li>
</ol>
<p>⚠️ 上記3項目は下記コード（位置情報取得の処理）よりも上に書いておく必要がある．</p>
<h3 id="位置情報取得の処理"><a class="header" href="#位置情報取得の処理">位置情報取得の処理</a></h3>
<pre><code class="language-js">// geolocation.html

navigator.geolocation.getCurrentPosition(showPosition, showError, option);

</code></pre>
<h3 id="位置情報の取得に成功した場合に実行される関数"><a class="header" href="#位置情報の取得に成功した場合に実行される関数">位置情報の取得に成功した場合に実行される関数</a></h3>
<p>位置情報の取得に成功すると，自動的に関数の引数（下記では<code>position</code>）に位置情報が入ってくる．</p>
<p>まずはconsoleに出力して内容を確認しよう．</p>
<pre><code class="language-js">// geolocation.html

function showPosition (position) {
  console.log(position);
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  console.log(lat, lng);
};

</code></pre>
<h3 id="位置情報の取得に失敗した場合に実行される関数"><a class="header" href="#位置情報の取得に失敗した場合に実行される関数">位置情報の取得に失敗した場合に実行される関数</a></h3>
<p>位置情報の取得に失敗した場合は決まったエラーが返される．</p>
<p>エラーには番号（<code>1</code>, <code>2</code>, <code>3</code>）が振ってあり意味が決まっているため，それぞれに対応したメッセージを表示するように記述してある．</p>
<pre><code class="language-js">// geolocation.html

function showError (error) {
  const errorMessages = [
    '位置情報が許可されてません',
    '現在位置を特定できません',
    '位置情報を取得する前にタイムアウトになりました',
  ];
  alert(`error:${errorMessages[error.code - 1]}`);
}

</code></pre>
<h3 id="位置情報の取得に必要なオプション"><a class="header" href="#位置情報の取得に必要なオプション">位置情報の取得に必要なオプション</a></h3>
<p>オブジェクトの形式で3項目を指定する．</p>
<pre><code class="language-js">// geolocation.html

const option = {
  enableHighAccuracy: true,
  maximumAge: 20000,
  timeout: 1000000,
};

</code></pre>
<h2 id="動作確認-4"><a class="header" href="#動作確認-4">動作確認</a></h2>
<p>コードが実行されると「位置情報の取得を許可するかどうか」のダイアログが表示されるため，許可する．</p>
<p>位置情報が取得できると，コンソール画面には以下のような情報が表示される．</p>
<p>位置情報は緯度経度で表現され，それぞれ<code>latitude</code>と<code>longitude</code>の値が対応する．</p>
<pre><code class="language-js">GeolocationPosition {coords: GeolocationCoordinates, timestamp: 1622956582259}
  coords: GeolocationCoordinates
    accuracy: 200
    altitude: null
    altitudeAccuracy: null
    heading: null
    latitude: 35.69
    longitude: 139.69
    speed: null
timestamp: 1622956582259
</code></pre>
<h2 id="練習-11"><a class="header" href="#練習-11">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ol>
<li>読み込み時に位置情報を取得してconsole.log()に表示しよう！</li>
<li>できる人は取得した緯度と経度をブラウザに表示しよう！</li>
</ol>
<p>（位置情報の取得までに時間がかかることもあるので気長に待つ！）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="bingmapsapi準備"><a class="header" href="#bingmapsapi準備">BingMapsAPI/準備</a></h1>
<h2 id="bing-maps-apiとは"><a class="header" href="#bing-maps-apiとは">Bing Maps APIとは</a></h2>
<p>Microsoftが提供する地図APIである．位置情報との連携を中心に様々な機能を提供する．</p>
<p>今回は前項で取得した位置情報を利用し，現在地付近の地図をブラウザ上に表示するアプリケーションを実装する．</p>
<h3 id="特徴-1"><a class="header" href="#特徴-1">特徴</a></h3>
<ul>
<li>JavaScriptのみで実装可能．</li>
<li>機能を実現するために必要なコードはMicrosoftが定めている．決められたコードを記述するだけで様々な機能を実装可能．</li>
<li>支払い情報など登録する必要なく無料で使用可能．</li>
</ul>
<h3 id="機能例"><a class="header" href="#機能例">機能例</a></h3>
<ul>
<li>任意の地点・縮尺で地図の表示．</li>
<li>出発地，到着地を指定したルート検索．</li>
<li>地図上の任意の地点にピン，Infobox（吹き出し），などを設置．</li>
<li>住所から緯度経度を取得．</li>
<li>緯度経度から住所を取得．</li>
</ul>
<h2 id="準備"><a class="header" href="#準備">準備</a></h2>
<p>Bing Maps APIを使用するためにはいくつかの準備が必要となる．主な手順は以下のとおり．</p>
<ol>
<li>Microsoftアカウントが必要（事前準備済）．</li>
<li>Bing Maps API開発者アカウントの準備．</li>
<li>API keyの発行．</li>
<li>（実際にコードを記述する）</li>
</ol>
<h3 id="開発者アカウントの準備"><a class="header" href="#開発者アカウントの準備">開発者アカウントの準備</a></h3>
<p>まずは下記のURLにアクセス！</p>
<p><a href="https://www.bingmapsportal.com">https://www.bingmapsportal.com</a></p>
<p>下記の画面から「Sign In」ボタンをクリック．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup01.svg" alt="bingmapsAPI準備1" /></p>
<p>Microsoftアカウントでログインする．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup02.svg" alt="bingmapsAPI準備2" /></p>
<p>画面が切り替わるので「Yes, let's create a new account」をクリックし，アカウント情報を入力する．</p>
<p>メールアドレスはMicrosoftアカウントと同じものを使用すると管理しやすいだろう．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup03.svg" alt="bingmapsAPI準備3" /></p>
<h3 id="api-keyの発行"><a class="header" href="#api-keyの発行">API keyの発行</a></h3>
<p>アカウントが作成できたら，画面上部のタブの「My account」 -&gt; 「My Keys」をクリックする．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup04.svg" alt="bingmapsAPI準備4" /></p>
<p>アプリケーション名を入力し，API keyを作成する．アプリケーション名以外は初期状態のままで構わない．</p>
<p>アプリケーション名は「何のアプリケーションなのか」がわかる名前にしよう．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup05.svg" alt="bingmapsAPI準備5" /></p>
<p>作成が正常に完了すると自動的に画面が切り替わる．下図の「Show key」部分をクリックするとAPI keyが表示される．</p>
<p>API keyは後ほどコード内に記述する必要があるため，この画面は開いたままにしておくとスムーズである．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup06.svg" alt="bingmapsAPI準備6" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="bingmapsapi実践"><a class="header" href="#bingmapsapi実践">BingMapsAPI/実践</a></h1>
<p>API keyの準備が完了したら，実際にJavaScriptを書いてMapを表示してみよう．</p>
<h2 id="処理の流れ-2"><a class="header" href="#処理の流れ-2">処理の流れ</a></h2>
<p>位置情報の取得とAPI処理を組み合わせるため，実行される順番がやや複雑になる．コメントなどで順番がわかるようにしておくと自力で実装する際の助けとなるだろう．</p>
<ol>
<li>APIを使用するためのコード読み込み．</li>
<li>位置情報取得に成功した場合の関数，失敗した場合の関数，オプションを記述．</li>
<li>位置情報の取得（前項での処理と同様）</li>
<li>位置情報が取得できた場合は，id指定したHTML要素に現在地を中心としたマップを表示する（位置情報の取得に成功した場合に実行される関数内に記述する）．</li>
</ol>
<h2 id="コードの読み込み"><a class="header" href="#コードの読み込み">コードの読み込み</a></h2>
<p>Microsoftが提供するコードを読み込む．ここに自分のAPI keyを入力しておく．</p>
<pre><code class="language-html">&lt;!-- geo_and_map.html --&gt;

&lt;script src='https://www.bing.com/api/maps/mapcontrol?mkt=ja-jp&amp;key=API_KEY'&gt;&lt;/script&gt;

&lt;script&gt;
  // JSの処理
&lt;/script&gt;

</code></pre>
<h2 id="位置情報取得に成功した場合の関数失敗した場合の関数オプションを記述"><a class="header" href="#位置情報取得に成功した場合の関数失敗した場合の関数オプションを記述">位置情報取得に成功した場合の関数，失敗した場合の関数，オプションを記述．</a></h2>
<p>この3項目自体は前項の位置情報取得で使用したものと同様の記述をすればOK．</p>
<p>今回はそれぞれ以下のような内容．</p>
<ul>
<li>位置情報の取得に成功した場合に実行される関数（本項では<code>mapsInit</code>）．</li>
<li>位置情報の取得に失敗した場合に実行される関数（前項と全く同じ）．</li>
<li>位置情報の取得に必要なオプション（前項と全く同じ）．</li>
</ul>
<p>その他，マップの情報を格納するための変数（<code>map</code>）を定義しておく（これがないと動かないので注意！）．</p>
<h3 id="必要な関数を準備"><a class="header" href="#必要な関数を準備">必要な関数を準備</a></h3>
<pre><code class="language-js">// geo_and_map.html

// マップ情報格納用の変数
let map;

// 省略
const option = {...};

// 省略
function showError(error) {...};

// この後マップ表示の処理を書き込む
function mapsInit() {...};

</code></pre>
<h2 id="マップ表示処理の追加"><a class="header" href="#マップ表示処理の追加">マップ表示処理の追加</a></h2>
<p>マップの表示処理はMicrosoft側で決められているため，ドキュメントに従ってコードを記述すればOK．</p>
<p>流れとしては下記のとおり．</p>
<ol>
<li>位置情報から緯度経度を抽出する．</li>
<li>1で取得した緯度経度を中心にしてマップを表示する．</li>
</ol>
<p>マップを表示する際には下記の情報が必要となる．</p>
<ul>
<li>マップを表示したい要素のid名（<code>#map</code>）．</li>
<li>表示するマップの中心座標（緯度経度，<code>center</code>のオブジェクト）．</li>
<li>表示するマップの縮尺（<code>1</code>から<code>20</code>で指定）．</li>
</ul>
<pre><code class="language-js">// geo_and_map.html

function mapsInit(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  map = new Microsoft.Maps.Map('#map', {
    center: {
      latitude: lat, longitude: lng
    },
    zoom: 15,
  });
};

</code></pre>
<h2 id="位置情報取得処理"><a class="header" href="#位置情報取得処理">位置情報取得処理</a></h2>
<p>最後に，実際に位置情報を取得する処理を記述する．</p>
<p>コード自体は前項と同様だが，実行のタイミングに注意する必要がある．理由は以下．</p>
<ul>
<li>マップ表示のためにはMicrosoftが提供したコードを読み込む必要がある．</li>
<li>読み込みが完了する前にマップ表示の処理を実行しようとするとエラーになる．</li>
<li>そのため，読み込みが完了した後に「位置情報取得 -&gt; マップ表示」の処理が実行されるように記述しなければならない．</li>
</ul>
<p>この場合，<code>window.onload = function () {...}</code>を用いることで，全てのスクリプトが読み込ま出てから<code>{}</code>内が実行されるように記述できる．</p>
<pre><code class="language-js">// geo_and_map.html

window.onload = function () {
  navigator.geolocation.getCurrentPosition(mapsInit, showError, option);
};

</code></pre>
<h3 id="-key-point-15"><a class="header" href="#-key-point-15">💡 Key Point</a></h3>
<blockquote>
<p>API（特に外部のコードを読み込む場合）は読み込み -&gt; 実行の順番が重要になる場合が多い．</p>
</blockquote>
<h2 id="実行結果-1"><a class="header" href="#実行結果-1">実行結果</a></h2>
<p>正常に位置情報が取得でき，マップ表示処理が実行されると，以下のようにブラウザ上にマップが表示される．</p>
<p>実行場所やネットワーク環境によって場所は変化するため，実際の場所とあっていなくても気にしなくてOK．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_result01.png" alt="マップ表示結果" /></p>
<h2 id="練習-12"><a class="header" href="#練習-12">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ul>
<li>位置情報の取得に成功したときに関数を定義し，map表示の処理を記述．</li>
<li>位置情報を取得する処理を記述し，画面にマップが表示されることを確認！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="おまけbingmapsapi機能追加"><a class="header" href="#おまけbingmapsapi機能追加">【おまけ】BingMapsAPI/機能追加</a></h1>
<p>マップが表示されたら，マップ上にピンなどのオブジェクトを配置してみよう．</p>
<h2 id="ピンの生成"><a class="header" href="#ピンの生成">ピンの生成</a></h2>
<p>現在地をわかりやすくするピンを設定できる．</p>
<h3 id="処理の流れ-3"><a class="header" href="#処理の流れ-3">処理の流れ</a></h3>
<ol>
<li>「ピンを立てる関数」を定義する．
<ul>
<li>ピンの色などのオプションを指定する．</li>
<li>表示したいマップを指定する．</li>
</ul>
</li>
<li>前項で実装したマップ表示後に「ピンを立てる関数」を実行する．</li>
</ol>
<h3 id="ピンを立てる関数の定義"><a class="header" href="#ピンを立てる関数の定義">ピンを立てる関数の定義</a></h3>
<p>マップ表示と同様にMicrosoftが処理を用意しているため，ドキュメントに従って記述すればOK．</p>
<p>本関数の中身は以下の流れ．</p>
<ul>
<li>「ピンを表示したい位置の緯度」「経度」「表示したいマップ」の3つを入力する．</li>
<li>入力された緯度経度をMicrosoftのフォーマットに変換する．</li>
<li>ピンの位置と色・表示設定を指定する．</li>
<li>入力されたマップ上にピンを配置する．</li>
</ul>
<pre><code class="language-js">// geo_and_map.html

function pushPin(lat, lng, map) {
  const location = new Microsoft.Maps.Location(lat, lng)
  const pin = new Microsoft.Maps.Pushpin(location, {
    color: 'navy',
    visible: true,
  });
  map.entities.push(pin);
};

</code></pre>
<h3 id="ピンを立てる関数の実行"><a class="header" href="#ピンを立てる関数の実行">ピンを立てる関数の実行</a></h3>
<p>マップ表示後に関数を実行する．</p>
<pre><code class="language-js">// geo_and_map.html

function mapsInit(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  map = new Microsoft.Maps.Map('#map', {
    center: {
      latitude: lat, longitude: lng
    },
    zoom: 15,
  });
  pushPin(lat, lng, map);
};

</code></pre>
<h2 id="infoboxの生成"><a class="header" href="#infoboxの生成">infoboxの生成</a></h2>
<p>infobox（吹き出し）を生成する関数を定義する．吹き出し内には任意のテキストや画像を表示することができる．</p>
<h3 id="処理の流れ-4"><a class="header" href="#処理の流れ-4">処理の流れ</a></h3>
<ol>
<li>「Infoboxを立てる関数」を定義する．
<ul>
<li>Infoboxの表示内容などのオプションを指定する．</li>
<li>表示したいマップを指定する．</li>
</ul>
</li>
<li>前項で実装したマップ表示後に「Infoboxを立てる関数」を実行する．</li>
</ol>
<h3 id="infoboxを生成する関数の定義"><a class="header" href="#infoboxを生成する関数の定義">Infoboxを生成する関数の定義</a></h3>
<p>これまでと同様にMicrosoftが処理を用意しているため，ドキュメントに従って記述すればOK．</p>
<p>本関数の中身は以下の流れ．</p>
<ul>
<li>「Infoboxを表示したい位置の緯度」「経度」「表示したいマップ」の3つを入力する．</li>
<li>入力された緯度経度をMicrosoftのフォーマットに変換する．</li>
<li>Infoboxの位置と表示内容を指定する．</li>
<li>入力されたマップ上にInfoboxを配置する．</li>
</ul>
<pre><code class="language-js">// geo_and_map.html

function generateInfobox(lat, lng, map) {
  const location = new Microsoft.Maps.Location(lat, lng)
  const infobox = new Microsoft.Maps.Infobox(location, {
    title: `G's ACADEMY`,
    description: &quot;JavaScript!!!&quot;
  });
  infobox.setMap(map);
};

</code></pre>
<h3 id="infoboxを生成する関数の実行"><a class="header" href="#infoboxを生成する関数の実行">Infoboxを生成する関数の実行</a></h3>
<p>マップ表示後に関数を実行する．</p>
<pre><code class="language-js">// geo_and_map.html

function mapsInit(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  map = new Microsoft.Maps.Map('#map', {
    center: {
      latitude: lat, longitude: lng
    },
    zoom: 15,
  });
  pushPin(lat, lng, map);
  generateInfobox(lat, lng, map);
};

</code></pre>
<h2 id="実行結果-2"><a class="header" href="#実行結果-2">実行結果</a></h2>
<p>マップ上にピンとInfoboxが表示される．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_result02.png" alt="ピン表示結果" /></p>
<h2 id="その他の機能"><a class="header" href="#その他の機能">その他の機能</a></h2>
<p>ここまで紹介した機能はほんの一部！！</p>
<h3 id="ドキュメントも読んでみよう"><a class="header" href="#ドキュメントも読んでみよう">ドキュメントも読んでみよう！</a></h3>
<p><a href="https://bingmapsv8samples.azurewebsites.net">https://bingmapsv8samples.azurewebsites.net</a></p>
<h3 id="山崎先生が作ったサンプル集かなり参考になる"><a class="header" href="#山崎先生が作ったサンプル集かなり参考になる">山崎先生が作ったサンプル集！！（かなり参考になる！！）</a></h3>
<p><a href="https://mapapi.org">https://mapapi.org</a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="その他のapi紹介"><a class="header" href="#その他のapi紹介">その他のAPI紹介</a></h1>
<p>今回扱った内容以外にも様々なAPIが存在する．</p>
<p>APIを扱う場合は下記がポイントとなる．</p>
<ul>
<li>自分が実現しようとしていることに対して活用できそうなAPIはないか．</li>
<li>複数のAPIを連携させることで，新しい価値を生み出せないか．</li>
</ul>
<p>まずはどんなAPIが存在するのか，探すことから始めよう！</p>
<h2 id="例-4"><a class="header" href="#例-4">例</a></h2>
<table><thead><tr><th>機能</th><th>概要</th><th>API例</th></tr></thead><tbody>
<tr><td>画像認識</td><td>画像に含まれる物体の名前，表示位置などの推定値を返す</td><td>Google Cloud Vision APIなど．</td></tr>
<tr><td>翻訳</td><td>翻訳したいテキストと翻訳先の言語名を送信すると翻訳されたテキストを返す．</td><td>Microsoft Translator Text APIなど．</td></tr>
<tr><td>テキスト解析</td><td>テキストの感情などを分析してスコアを返す．</td><td>Natural Language APIなど．</td></tr>
<tr><td>ECサイトの情報</td><td>キーワードやカテゴリなどの条件で扱っている商品のリストを返す．</td><td>楽天商品検索APIなど．</td></tr>
<tr><td>天気情報</td><td>任意の地点（都市名や緯度経度）から気象情報や天気予報を返す．</td><td>Open Weather Map APIなど．</td></tr>
</tbody></table>
<h2 id="まずは探せ"><a class="header" href="#まずは探せ">まずは探せ！！</a></h2>
<p><a href="https://www.apibank.jp">https://www.apibank.jp</a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-2"><a class="header" href="#課題-2">課題</a></h1>
<p><strong>「API」を使用したアプリケーションを実装！！</strong></p>
<h2 id="考え方"><a class="header" href="#考え方">考え方</a></h2>
<ul>
<li>APIを組み合わせる！</li>
<li>FirebaseやLocalStorageを組み込んでもOK！</li>
<li>API自体を作ってもいいぞ．．！</li>
</ul>
<h2 id="アレンジの例"><a class="header" href="#アレンジの例">アレンジの例</a></h2>
<ul>
<li>ゾンビと対戦するマップ</li>
<li>ワンタップで周辺のレストランを検索</li>
<li>その日の天気や気温で近くの飲食店をレコメンド</li>
<li>政府の統計情報からマーケット分析</li>
<li>twitter bot, LINE bot, etc...</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php"><a class="header" href="#php">PHP</a></h1>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php事前準備"><a class="header" href="#php事前準備">PHP事前準備</a></h1>
<h2 id="サーバとクライアント"><a class="header" href="#サーバとクライアント">サーバとクライアント</a></h2>
<p>サーバで動作する言語（サーバサイド）</p>
<ul>
<li>webサーバ上でプログラムが実行される．</li>
<li>PHP, Ruby, Python, JAVA, (node.js), etc…</li>
</ul>
<p>クライアント（webブラウザ）で動作する言語（クライアントサイド）</p>
<ul>
<li>webブラウザでプログラムが実行される．</li>
<li>html, css, JavaScript</li>
</ul>
<p>=&gt;サーバサイド言語の開発にはサーバ上で動作させるアプリケーション（xamppなど）が必要！</p>
<p>（自分のPC上でサーバを動かすイメージ）</p>
<h2 id="サーバのしくみと-xampp-の役割"><a class="header" href="#サーバのしくみと-xampp-の役割">サーバのしくみと XAMPP の役割</a></h2>
<h3 id="サーバの役割及び構成"><a class="header" href="#サーバの役割及び構成">サーバの役割及び構成</a></h3>
<p>Webアプリケーションはクライアントとサーバの組み合わせで構成されている．</p>
<p>サーバには「アプリケーションサーバ」と「DBサーバ」が存在し，相互に連携することでアプリケーションを構築している．</p>
<p>（詳しい仕組みの理解は後からでOK．）</p>
<p><img src="php/php_setup/./img/php_file_about_server.svg" alt="サーバのしくみ" /></p>
<h3 id="サーバサイド言語での開発とxamppの役割"><a class="header" href="#サーバサイド言語での開発とxamppの役割">サーバサイド言語での開発とXAMPPの役割</a></h3>
<p>上記のとおり，PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身のPCで開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身のPC内で擬似的なサーバを用意してPHPを動作させることができるのが「xampp」である．</p>
<p>xamppは以下の役割を提供する．</p>
<ul>
<li>PHPを動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php_setup/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="xampp環境構築"><a class="header" href="#xampp環境構築">XAMPP環境構築</a></h2>
<h3 id="ダウンロード"><a class="header" href="#ダウンロード">ダウンロード</a></h3>
<p>下記URLにアクセスする．</p>
<p><a href="https://www.apachefriends.org/jp/download.html">https://www.apachefriends.org/jp/download.html</a></p>
<blockquote>
<p><strong>！！注意！！</strong></p>
<p>資料作成時時点では<code>7.3.6 / PHP 7.3.6</code>となっているが，現時点（2021/09/06）では<code>8.0.9 / PHP 8.0.9</code>が最新なのでこちらを用いること！！</p>
</blockquote>
<p>↓アクセス画面
<img src="php/php_setup/./img/php_setup_xampp_download_01.svg" alt="xamppダウンロード画面" /></p>
<p>Macの人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_02.svg" alt="xamppダウンロード画面" /></p>
<p>Windowsの人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_03.svg" alt="xamppダウンロード画面" /></p>
<h3 id="インストール"><a class="header" href="#インストール">インストール</a></h3>
<p>ダウンロードしたらインストールを進める．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_04.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認サーバ起動"><a class="header" href="#動作確認サーバ起動">動作確認（サーバ起動）</a></h3>
<p>インストールが済んだらアプリケーションを立ち上げる．</p>
<p>Macの人は以下のようにサーバを起動させる．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_05.svg" alt="xamppダウンロード画面" /></p>
<p>Windowsの人は以下の画面．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_06.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認画面表示"><a class="header" href="#動作確認画面表示">動作確認（画面表示）</a></h3>
<h4 id="アプリケーションサーバ動作確認"><a class="header" href="#アプリケーションサーバ動作確認">アプリケーションサーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/">https://localhost/</a>にアクセスして下記画面が表示されればOK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_01.svg" alt="アプリケーションサーバ動作確認" /></p>
<h4 id="dbサーバ動作確認"><a class="header" href="#dbサーバ動作確認">DBサーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/phpmyadmin">https://localhost/phpmyadmin</a>にアクセスして下記画面が表示されればOK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_02.svg" alt="DBサーバ動作確認" /></p>
<h2 id="まとめ"><a class="header" href="#まとめ">まとめ</a></h2>
<p>下記3点が実施できていることを確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎"><a class="header" href="#php基礎">PHP基礎</a></h1>
<h2 id="本講義の内容とゴール-4"><a class="header" href="#本講義の内容とゴール-4">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-4"><a class="header" href="#本講義の内容-4">本講義の内容</a></h3>
<ul>
<li>PHPの基本的な開発手順．</li>
<li>PHPを用いた簡単な処理の実装．</li>
<li>データ送受信とファイル操作機能を用いたtodoリストアプリケーションの実装．</li>
</ul>
<h3 id="本講義のゴール-4"><a class="header" href="#本講義のゴール-4">本講義のゴール</a></h3>
<ul>
<li>Webアプリケーションの仕組みをと動きを把握する（大事）！</li>
<li>PHP（の開発手順）に慣れる！</li>
<li>PHPを用いたデータの送受信とファイルの操作ができるようになる！</li>
</ul>
<h2 id="準備-1"><a class="header" href="#準備-1">準備</a></h2>
<p>以下3点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php概要"><a class="header" href="#php概要">PHP概要</a></h1>
<h2 id="webアプリケーションの仕組み動き方"><a class="header" href="#webアプリケーションの仕組み動き方">Webアプリケーションの仕組み（動き方）</a></h2>
<p>Webアプリケーション（のソースコード）は世界のどこかにある「サーバ」に置かれている．</p>
<p><img src="php/php01/./img/php_file_web01.svg" alt="webの仕組み" /></p>
<p>Webアプリケーションを使用するときは，Webブラウザに「URL」を指定する．</p>
<ul>
<li>Webブラウザから「http」方式でURLに「リクエスト」を送る．</li>
<li>URLはWeb上にたくさんあるファイルを必ず1つ指定できるようになっている（ユニークな文字列）．</li>
</ul>
<p>URLの構造は下記のようになっている．</p>
<pre><code class="language-txt">https://www.emperor-crimson.com/data/status.php
  ^       ^                      ^      ^
  |       |                      |      |
scheme hostname（サーバ名）    directory filename
</code></pre>
<h2 id="サーバ---クライアント型のアプリケーション"><a class="header" href="#サーバ---クライアント型のアプリケーション">サーバ - クライアント型のアプリケーション</a></h2>
<h3 id="サーバで動作する言語サーバサイド"><a class="header" href="#サーバで動作する言語サーバサイド">サーバで動作する言語（サーバサイド）</a></h3>
<p>サーバ上でプログラムが実行される．</p>
<p><img src="php/php01/./img/php_web_server.svg" alt="サーバサイド言語の動き方" /></p>
<ul>
<li>PHP</li>
<li>Ruby</li>
<li>Python</li>
<li>JAVA</li>
<li>Node.js</li>
<li>etc...</li>
</ul>
<h3 id="クライアントwebブラウザで動作する言語クライアントサイド"><a class="header" href="#クライアントwebブラウザで動作する言語クライアントサイド">クライアント（webブラウザ）で動作する言語（クライアントサイド）</a></h3>
<p><img src="php/php01/./img/php_web_client.svg" alt="クライアントサイド言語の動き方" /></p>
<p>webブラウザがプログラムを実行する．</p>
<ul>
<li>HTML</li>
<li>CSS</li>
<li>JavaScript</li>
</ul>
<h2 id="サーバサイドの役割"><a class="header" href="#サーバサイドの役割">サーバサイドの役割</a></h2>
<p>様々なWebアプリケーションが存在するが，基本のサーバサイド処理は同様である．</p>
<p>基本の機能は何らかのデータを扱うことである．</p>
<h3 id="例-5"><a class="header" href="#例-5">例</a></h3>
<ul>
<li>twitter     =&gt;  ツイート，検索，タイムラインの表示，etc</li>
<li>facebook		=&gt;  投稿，検索，記事の更新，コメント，etc</li>
<li>wordpress		=&gt;  ブログ記事の投稿，編集，削除，etc</li>
</ul>
<p>※：アプリケーションは必ずしもPHPで作られているわけではない！！</p>
<h3 id="-key-point-16"><a class="header" href="#-key-point-16">💡 Key Point</a></h3>
<blockquote>
<p>上記の処理は以下の4つに集約される．</p>
<ul>
<li>📝 データの「作成」（Create）</li>
<li>📖 データの「参照」（Read）</li>
<li>🔄 データの「更新」（Update）</li>
<li>🗑 データの「削除」（Delete）</li>
</ul>
</blockquote>
<p>これら4種類の処理の頭文字をとって「CRUD」と呼ぶ．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎-1"><a class="header" href="#php基礎-1">PHP基礎</a></h1>
<h2 id="サーバサイド言語での開発"><a class="header" href="#サーバサイド言語での開発">サーバサイド言語での開発</a></h2>
<p>PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身のPCで開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身のPC内で擬似的なサーバを用意してPHPを動作させることができるのが「xampp」である．</p>
<p>xamppは以下の役割を提供する．</p>
<ul>
<li>PHPを動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php01/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="開発の手順"><a class="header" href="#開発の手順">開発の手順</a></h2>
<p>xamppはPC内に<code>localhost</code>というサーバを用意してくれる．</p>
<p>このサーバ内にPHPファイルを配置することでPHPのコードを動かすことができる．</p>
<p>PC内では予め指定されたディレクトリ（<code>htdocs</code>）がサーバの役割をするよう決められているため，まずPHPファイルを指定のディレクトリに配置する作業が必要となる．</p>
<p>サンプルフォルダを下記のディレクトリへ移動する！</p>
<ul>
<li>windows : <code>C\xampp\htdocs\</code></li>
<li>mac : <code>/Applications/xampp/xamppfiles/htdocs/</code></li>
</ul>
<h3 id="-key-point-17"><a class="header" href="#-key-point-17">💡 Key Point</a></h3>
<blockquote>
<p><strong>【重要】開発の手順は以下の流れとなる．</strong></p>
<ol>
<li>xamppを起動する</li>
<li>phpファイルが入ったフォルダをhtdocsに配置</li>
<li>vs codeでhtdocsの上記フォルダを開く</li>
<li>phpのコードを書く</li>
<li>ブラウザでlocalhostにアクセスして動作確認</li>
</ol>
<p>以降，3-5の繰り返し！</p>
<p>※一通り終わったらxamppを終了させることを推奨（次回起動でコケる）</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎-2"><a class="header" href="#php基礎-2">PHP基礎</a></h1>
<h2 id="phpの記述"><a class="header" href="#phpの記述">PHPの記述</a></h2>
<p>PHPは「PHPファイル」に記述する．</p>
<h3 id="phpファイルの作成"><a class="header" href="#phpファイルの作成">PHPファイルの作成</a></h3>
<ul>
<li>拡張子を「<code>.php</code>」にする．</li>
<li>例：「<code>index.php</code>」「<code>create.php</code>」など．</li>
</ul>
<h3 id="開始タグと終了タグ"><a class="header" href="#開始タグと終了タグ">開始タグと終了タグ</a></h3>
<ul>
<li>「<code>&lt;?php</code>」で始まり「<code>?&gt;</code>」で終了（phpしか書かない場合，終了タグは省略可）．</li>
<li>開始タグと終了タグの間に書かれた処理がサーバ上で実行される！</li>
<li>タグ以外の部分（HTMLなど記述した場合）はサーバでは実行されない（そのままソースコードがブラウザに送信される）．</li>
</ul>
<pre><code class="language-php">&lt;?php
// ここにPHPの処理を書く
// ...
?&gt;

// ここから下に書いたコードはサーバで実行されない
// （HTMLなどを書く）
</code></pre>
<h2 id="変数と文字列"><a class="header" href="#変数と文字列">変数と文字列</a></h2>
<p>変数の扱いはJavaScriptと大きく変わらないが，以下の点に注意する．</p>
<ul>
<li>変数名は必ず「<code>$****</code>」←$で始めるルール！</li>
<li>文字列はシングルクォーテーションかダブルクォーテーションで囲む．</li>
<li><code>$</code>の次に数字はNG（JavaScriptと同様）．</li>
<li><code>_</code>などの記号はOK．</li>
</ul>
<pre><code class="language-php">// 数値
$number = 100;

// 文字列
$name = 'engineer';

// 数値スタートはNG
$1lang = 'php';

// 後の数字はOK
$lang2 = 'javascript';

// 記号もOK
$_lang = 'Rust';
</code></pre>
<p>変数と文字列は「<code>.</code>」でつなげる．</p>
<p>ダブルクォーテーションを用いる場合は<code>{}</code>で変数を埋め込むことができる（JavaScriptの<code>``</code>と<code>${}</code>に相当）．</p>
<pre><code class="language-php">$str1 = 'ジーズで' . $lang2 . 'を勉強中！';

// こっちのほうが楽かな．．！
$str2 = &quot;ジーズで{$lang2}を勉強中！&quot;;
</code></pre>
<h2 id="配列と連想配列"><a class="header" href="#配列と連想配列">配列と連想配列</a></h2>
<h3 id="配列-1"><a class="header" href="#配列-1">配列</a></h3>
<p>JavaScriptと同様の形式．</p>
<p>データを確認する際には<code>echo</code>または<code>var_dump()</code>を用いる．</p>
<ul>
<li><code>echo</code>で値自体を出力する．</li>
<li><code>var_dump()</code>では配列などの構造も見られる．</li>
<li>デバッグの基本は<code>var_dump()</code>（JavaScriptの<code>console.log()</code>的な）！！！</li>
</ul>
<pre><code class="language-php">// 配列
$array = ['JavaScript', 'PHP', 'Rust', 'COBOL'];

// `echo`で画面上にデータを表示できる．
echo $array[2]; // Rust

// 変数や配列の中身や構造を表示
var_dump($array);

</code></pre>
<h3 id="連想配列"><a class="header" href="#連想配列">連想配列</a></h3>
<p>連想配列はJavaScriptにおける「オブジェクト」に相当する．</p>
<ul>
<li>「キー」「バリュー」のセット．</li>
<li>キー名を指定して値を取り出すことができる．</li>
</ul>
<pre><code class="language-php">// 連想配列
$array2 = [
  &quot;フロント&quot; =&gt; &quot;JavaScript&quot;,
  &quot;サーバ&quot; =&gt; &quot;PHP&quot;,
  &quot;iOS&quot; =&gt; &quot;Swift&quot;,
  &quot;関数型&quot; =&gt; &quot;Haskell&quot;
];

// キー名を指定して値を取り出す
echo $array2['サーバ'];
</code></pre>
<h2 id="条件分岐-2"><a class="header" href="#条件分岐-2">条件分岐</a></h2>
<p>条件分岐の構文はJavaScriptと同様．</p>
<pre><code class="language-php">// 0から1のランダムな数を発生させる
$number = rand(0, 1);

// 1かそれ以外で条件分岐
if ($number == 1) {
  echo '値は1です';
} else {
  echo '値は1以外です';
}

</code></pre>
<p>条件分岐を使用したおみくじの例</p>
<pre><code class="language-php">// 1から5の乱数を作成
$random_number = rand(1, 5);

// 乱数の値で条件分岐
if ($random_number == 1) {
  $result =  '大吉';
} elseif ($random_number == ...) {
  $result = ...
} elseif (...) {
  // ...
}
echo $result;

</code></pre>
<h2 id="phpとhtmlの組み合わせ"><a class="header" href="#phpとhtmlの組み合わせ">PHPとHTMLの組み合わせ</a></h2>
<p><code>echo</code>で処理結果を出力できるが，ブラウザに値が表示されるだけで気が利いていない．</p>
<p>そこで，PHPとHTMLを組み合わせて画面を作成する機能を利用してみる．</p>
<ul>
<li>html内に<code>&lt;?=変数名?&gt;</code>と記述することでPHPの変数を埋め込める．</li>
<li>PHPで処理した結果からHTMLをつくるイメージ．</li>
</ul>
<pre><code class="language-php">&lt;?php
// いろいろな処理
$result = '大吉';
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;今日の運勢は&lt;?=$result?&gt;です！&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="-key-point-18"><a class="header" href="#-key-point-18">💡 Key Point</a></h3>
<blockquote>
<p>PHPとHTMLが動く順序を把握しよう！</p>
<ol>
<li>PHPの処理が実行される．</li>
<li>処理の結果作成された値がHTMLに埋め込まれ，HTMLが完成する．</li>
<li>HTMLのデータがブラウザに送信される．</li>
<li>画面にHTMLが表示される．</li>
</ol>
</blockquote>
<h2 id="phpの練習"><a class="header" href="#phpの練習">PHPの練習</a></h2>
<p><code>omikuji.php</code>におみくじの処理を作成し，HTMLと組み合わせて画面に結果を表示しよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="クライアント---サーバ間の通信"><a class="header" href="#クライアント---サーバ間の通信">クライアント - サーバ間の通信</a></h1>
<h2 id="サーバへデータを送るとは"><a class="header" href="#サーバへデータを送るとは">サーバへデータを送る，とは？？</a></h2>
<p>htmlファイルやphpファイルから別のphpファイルへデータを送る．
データを受け取ったphpファイルがDBへの保存などの処理を実行．</p>
<p>データ送信には以下の2種類が存在する．</p>
<ul>
<li>GET</li>
<li>POST</li>
</ul>
<p>どちらの場合も手順は同様．</p>
<h3 id="-key-point-19"><a class="header" href="#-key-point-19">💡 Key Point</a></h3>
<blockquote>
<p>必ず送信側ファイルと受信側ファイルの2つでやり取りを行う．</p>
</blockquote>
<h2 id="getでのデータ送受信"><a class="header" href="#getでのデータ送受信"><code>GET</code>でのデータ送受信</a></h2>
<h3 id="get方式でデータをやり取りする場合の流れ"><a class="header" href="#get方式でデータをやり取りする場合の流れ"><code>GET</code>方式でデータをやり取りする場合の流れ．</a></h3>
<h4 id="送信側の処理"><a class="header" href="#送信側の処理">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の3項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;todo_get_receive.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;GET&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理"><a class="header" href="#受信側の処理">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_GET</code>変数に値が格納される．</li>
<li><code>$_GET</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード"><a class="header" href="#送信側のコード">送信側のコード</a></h3>
<pre><code class="language-php">// todo_get.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;todo_get_confirm.php&quot; method=&quot;GET&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード"><a class="header" href="#受信側のコード">受信側のコード</a></h3>
<ul>
<li>GETで送信された情報は<code>$_GET</code>に入って送られる．</li>
<li>まず「情報が受け取れているかどうか」をチェックすることが大事！！</li>
<li>（情報が受け取れないと以降どうしようもない）</li>
<li><code>exit()</code>は以降の処理を中止する．</li>
</ul>
<pre><code class="language-php">// todo_get_confirm.php

&lt;?php

// 必ず最初にチェック！！内容を確認したらコメントアウトすること．
var_dump($_GET);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_GET['todo'];
$deadline = $_GET['deadline'];

?&gt;

</code></pre>
<h3 id="get方式の特徴"><a class="header" href="#get方式の特徴"><code>GET</code>方式の特徴</a></h3>
<ul>
<li>サーバから情報を取得する． URLに情報を追加して送信できる．</li>
<li>データの特定（自分の名前で検索）など，少量のデータ送信に向く（URLにデータが含まれている）．</li>
<li>URLにデータが含まれるため，URLをシェアするだけでデータを共有できる．</li>
</ul>
<h2 id="postでのデータ送受信"><a class="header" href="#postでのデータ送受信"><code>POST</code>でのデータ送受信</a></h2>
<h3 id="post方式でデータをやり取りする場合の流れほとんどgetと同様"><a class="header" href="#post方式でデータをやり取りする場合の流れほとんどgetと同様"><code>POST</code>方式でデータをやり取りする場合の流れ（ほとんど<code>GET</code>と同様）．</a></h3>
<h4 id="送信側の処理-1"><a class="header" href="#送信側の処理-1">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の3項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;todo_post_confirm.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;POST&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理-1"><a class="header" href="#受信側の処理-1">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_POST</code>変数に値が格納される．</li>
<li><code>$_POST</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード-1"><a class="header" href="#送信側のコード-1">送信側のコード</a></h3>
<pre><code class="language-php">// todo_post.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;todo_post_confirm.php&quot; method=&quot;POST&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード-1"><a class="header" href="#受信側のコード-1">受信側のコード</a></h3>
<ul>
<li>POSTで送信された情報は<code>$_POST</code>に入って送られる．</li>
<li>以降の流れは<code>GET</code>の場合と同様．</li>
</ul>
<pre><code class="language-php">// todo_post_confirm.php

&lt;?php

// POSTの場合も必ず最初にチェック！！
var_dump($_POST);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

?&gt;

</code></pre>
<h3 id="post方式の特徴"><a class="header" href="#post方式の特徴"><code>POST</code>方式の特徴</a></h3>
<ul>
<li>サーバにデータを送信するときに使用．情報を見えないように送信する方法</li>
<li>個人情報など．（送れるデータ量がGETと比較して多い）</li>
<li>ファイルを送信する場合にも使用</li>
</ul>
<h2 id="参考xss--クロスサイトスクリプティング"><a class="header" href="#参考xss--クロスサイトスクリプティング">【参考】XSS : クロスサイトスクリプティング</a></h2>
<p>formに悪意あるJavaScriptを埋め込まれて実行される場合がある．</p>
<p>HTMLにデータを埋め込む際に対策できる．</p>
<pre><code class="language-php">&lt;?php
$hoge = $_POST['hoge'];
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;JavaScriptが送信されると実行されてしまいます&lt;?=$hoge?&gt;&lt;/p&gt;
    &lt;p&gt;ただの文字列として処理されます&lt;?=htmlspecialchars($hoge, ENT_QUOTES);?&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre>
<h2 id="練習-13"><a class="header" href="#練習-13">練習</a></h2>
<ol>
<li><code>todo_get.php</code>と<code>todo_get_confirm.php</code>でGET方式のデータ送受信を実装しよう．</li>
<li><code>todo_post.php</code>と<code>todo_post_confirm.php</code>でPOST方式のデータ送受信を実装しよう．</li>
</ol>
<p>双方とも，データを受け取ったらHTML部分に受信内容を表示しよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイル操作書き込み"><a class="header" href="#ファイル操作書き込み">ファイル操作（書き込み）</a></h1>
<h2 id="実装するアプリケーションtodoリストの概要"><a class="header" href="#実装するアプリケーションtodoリストの概要">実装するアプリケーション（todoリスト）の概要</a></h2>
<p>サーバではマシン内のファイルを直接操作することができる（ブラウザ=クライアントサイドからは操作できない）．</p>
<p>この特徴を活かし，ユーザが入力して送信したデータをファイルに保存するtodoリストのアプリケーションを実装する．</p>
<p>まずは送信したデータをtxtファイルに書き込んで保存する</p>
<h3 id="やりたいこと"><a class="header" href="#やりたいこと">やりたいこと</a></h3>
<ol>
<li>フォームにデータを入力し，サーバに送信する．</li>
<li>サーバで受け取ったデータをtxtファイルに書き込んで保存する．</li>
<li>保存してあるデータを読み込んでHTMLを作成し，画面に表示する．</li>
</ol>
<h3 id="必要なファイル"><a class="header" href="#必要なファイル">必要なファイル</a></h3>
<ul>
<li>保存用のtxtファイル「<code>data</code>」ディレクトリの「<code>todo.txt</code>」（自動で作成されるので準備する必要はない）．</li>
<li>データを入力して送信するファイル（<code>todo_txt_input.php</code>）</li>
<li>データを受け取ってファイルに書き込むファイル（<code>todo_txt_create.php</code>）</li>
</ul>
<h2 id="ファイル書き込み処理の実装"><a class="header" href="#ファイル書き込み処理の実装">ファイル書き込み処理の実装</a></h2>
<h3 id="データ送信側ファイルの処理"><a class="header" href="#データ送信側ファイルの処理">データ送信側ファイルの処理</a></h3>
<ol>
<li>送信先のファイルを指定する（今回は<code>todo_txt_create.php</code>）．</li>
<li>送信方式を指定する（GET or POST）←今回はPOSTで実装．</li>
<li>inputタグにname属性を指定する．</li>
</ol>
<pre><code class="language-php">// todo_txt_input.php

// `action`, `method`, `name`の3つを指定する．
&lt;form action=&quot;todo_txt_create.php&quot; method=&quot;POST&quot;&gt;
  // ...
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;button&gt;submit&lt;/button&gt;
  &lt;/div&gt;
  // ...
&lt;/form&gt;

</code></pre>
<h3 id="データ受信側ファイルの処理"><a class="header" href="#データ受信側ファイルの処理">データ受信側ファイルの処理</a></h3>
<ol>
<li>データを受け取る</li>
<li>書き込み先のファイルを開く（なければ新たにファイルを作成）</li>
<li>他の人が書き込まないようロックする</li>
<li>データを書き込む</li>
<li>ロックを解除する</li>
<li>ファイルを閉じる</li>
<li>入力画面に移動</li>
</ol>
<pre><code class="language-php">// todo_txt_create.php

// まずは`var_dump($_POST);`で値を確認すること！！

// データの受け取り
$todo = $_POST[&quot;todo&quot;];
$deadline = $_POST[&quot;deadline&quot;];

// データ1件を1行にまとめる（最後に改行を入れる）
$write_data = &quot;{$deadline} {$todo}\n&quot;;

// ファイルを開く．引数が`a`である部分に注目！
$file = fopen('data/todo.txt', 'a');
// ファイルをロックする
flock($file, LOCK_EX);

// 指定したファイルに指定したデータを書き込む
fwrite($file, $write_data);

// ファイルのロックを解除する
flock($file, LOCK_UN);
// ファイルを閉じる
fclose($file);

// データ入力画面に移動する
header(&quot;Location:todo_txt_input.php&quot;);

</code></pre>
<h3 id="参考ファイル操作時の主なオプション"><a class="header" href="#参考ファイル操作時の主なオプション">【参考】ファイル操作時の主なオプション</a></h3>
<table><thead><tr><th>引数</th><th>意味合い</th></tr></thead><tbody>
<tr><td><strong><code>r</code></strong></td><td>読み込みのみで開く</td></tr>
<tr><td><code>r+</code></td><td>読み込み/書き込み用に開く</td></tr>
<tr><td><code>w</code></td><td>書き込みで開く&amp;内容を削除 → ファイルがなければ作成</td></tr>
<tr><td><code>w+</code></td><td>読み込み/書き込みで開く&amp;内容を削除 → ファイルがなければ作成</td></tr>
<tr><td><strong><code>a</code></strong></td><td>追加書き込みのみで開く → ファイルがなければ作成</td></tr>
<tr><td><code>a+</code></td><td>読み込み/追加書き込みで開く → ファイルがなければ作成</td></tr>
</tbody></table>
<p><a href="https://www.php.net/manual/ja/function.fopen.php">参考リンク</a></p>
<h2 id="練習-14"><a class="header" href="#練習-14">練習</a></h2>
<ol>
<li><code>todo_txt_input.php</code>のform欄の設定を記述しよう！</li>
<li><code>todo_txt_create.php</code>でデータを受け取り，ファイルに書き込もう！</li>
<li>書き込み処理の結果を<code>todo.txt</code>で確認しよう！
<ul>
<li>エディタからtxtファイルを開いて書き込まれていればOK．</li>
</ul>
</li>
</ol>
<h2 id="-macosの場合は権限の設定が必要"><a class="header" href="#-macosの場合は権限の設定が必要">⚠️ MacOSの場合は権限の設定が必要</a></h2>
<p>（WindowsOSの場合は設定不要）</p>
<ul>
<li>初期状態ではPHPからファイルを操作する権限が付与されていない．</li>
<li>以下の手順で権限を設定する．</li>
</ul>
<ol>
<li>「htdocsに入れた講義フォルダ」で</li>
<li>メニュー表示 =&gt; 情報を見る =&gt; 共有とアクセス権</li>
<li>全て「読み/書き」に変更 =&gt; 歯車ボタン =&gt; 内包している項目に適用</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイル操作読み込み"><a class="header" href="#ファイル操作読み込み">ファイル操作（読み込み）</a></h1>
<h2 id="ファイル読み込み処理画面表示の概要"><a class="header" href="#ファイル読み込み処理画面表示の概要">ファイル読み込み処理（&amp;画面表示）の概要</a></h2>
<h3 id="やりたいこと-1"><a class="header" href="#やりたいこと-1">やりたいこと</a></h3>
<ul>
<li>保存用ファイルから内容を読み出す．</li>
<li>読み出したデータをまとめ，HTMLに埋め込む．</li>
</ul>
<h3 id="必要なファイル-1"><a class="header" href="#必要なファイル-1">必要なファイル</a></h3>
<ul>
<li>ファイルのデータを読み込んで表示するファイル（<code>todo_txt_read.php</code>）</li>
</ul>
<h2 id="ファイル読み込み処理の実装"><a class="header" href="#ファイル読み込み処理の実装">ファイル読み込み処理の実装</a></h2>
<h3 id="処理の流れ-5"><a class="header" href="#処理の流れ-5">処理の流れ</a></h3>
<ol>
<li>出力用の変数を用意する．</li>
<li>txtファイルを開く（読み取り専用）．</li>
<li>ファイルをロックする．</li>
<li>txtファイルのデータを読み込み，繰り返し処理を用いて出力用の変数に入れる．</li>
<li>ロックを解除する．</li>
<li>ファイルを閉じる．</li>
<li>（HTML上で表示）</li>
</ol>
<pre><code class="language-php">// todo_txt_read.php

// データまとめ用の空文字変数
$str = '';

// ファイルを開く（読み取り専用）
$file = fopen('data/todo.txt', 'r');
// ファイルをロック
flock($file, LOCK_EX);

// fgets()で1行ずつ取得→$lineに格納
if ($file) {
  while ($line = fgets($file)) {
    // 取得したデータを`$str`に追加する
    $str .=&quot;&lt;tr&gt;&lt;td&gt;{$line}&lt;/td&gt;&lt;/tr&gt;&quot;;
  }
}

// ロックを解除する
flock($file, LOCK_UN);
// ファイルを閉じる
fclose($file);

// `$str`に全てのデータ（タグに入った状態）がまとまるので，HTML内の任意の場所に表示する．

</code></pre>
<h2 id="練習-15"><a class="header" href="#練習-15">練習</a></h2>
<ol>
<li><code>todo_txt_read.php</code>で<code>todo.txt</code>の内容を読み込もう（まずは<code>var_dump()</code>で確認）！</li>
<li>読み込んだデータをブラウザで表示しよう！</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-3"><a class="header" href="#課題-3">課題</a></h1>
<p><strong>csvファイルを用いたアンケートシステムをつくろう！</strong></p>
<h2 id="構成例"><a class="header" href="#構成例">構成（例）</a></h2>
<ul>
<li>入力画面（index.php）</li>
<li>書き込みファイル（create.php）</li>
<li>読み込みファイル（read.php）</li>
</ul>
<p>最低限ここまで！</p>
<h2 id="アンケート内容例"><a class="header" href="#アンケート内容例">アンケート内容（例）</a></h2>
<ul>
<li>名前，email，任意の質問を入力</li>
<li>入力内容をcsv形式で「data/data.csv」に保存</li>
<li>読み込みファイルでcsvファイルの内容を表示</li>
</ul>
<p>※例によってアンケート項目とか適当でOK！</p>
<h2 id="アップグレード"><a class="header" href="#アップグレード">アップグレード</a></h2>
<ul>
<li>同じ画面で送信と表示を実行</li>
<li>csvファイルの内容の集計結果をグラフ表示，デザインをかっこよく</li>
<li>結果に応じた評価機能とか統計解析とか</li>
<li>卒制のアイデアでつくってみる！！</li>
</ul>
<h2 id="phpとjsを組み合わせろ"><a class="header" href="#phpとjsを組み合わせろ">PHPとJSを組み合わせろ！！</a></h2>
<ul>
<li>PHPはJavaScriptと比較して自由度が低い．．！</li>
<li>PHPは狙ったデータを確実に取得できるように！！</li>
<li>凝った画面表示や動きはJSを使おう！！</li>
</ul>
<p><img src="php/php01/./img/php_file_php_js_flow.svg" alt="PHPとJSの処理の流れ" /></p>
<p>PHPのデータをJSに渡す例</p>
<pre><code class="language-php">&lt;?php
// これはPHPの配列
$hoge_array = ['PHP', 'JS', 'Rust', 'COBOL'];
?&gt;

&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;

    &lt;p&gt;ここでJSONが活躍するのじゃ．．！&lt;/p&gt;

    &lt;script&gt;
      // JSではPHPの配列を扱えないため，サーバ上でJSON形式に変換する
      const hogeArray = &lt;?=json_encode($hoge_array)?&gt;;
      console.log(hogeArray);

      // あとはわかるな．．？？
    &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db連携_crud処理前半"><a class="header" href="#php_db連携_crud処理前半">PHP_DB連携_CRUD処理前半</a></h1>
<h2 id="本講義の内容とゴール-5"><a class="header" href="#本講義の内容とゴール-5">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-5"><a class="header" href="#本講義の内容-5">本講義の内容</a></h3>
<ul>
<li>DBの基本的な扱い．</li>
<li>SQLを用いたDB操作（データ作成，データ参照）．</li>
<li>PHP上でのSQL実行とtodoリスト（Webアプリケーション）の連携を実装．</li>
</ul>
<h3 id="本講義のゴール-5"><a class="header" href="#本講義のゴール-5">本講義のゴール</a></h3>
<ul>
<li>DBの構成や動き方を理解する！</li>
<li>SQLでDBを操作する基本を理解する！</li>
<li>PHPでDBを操作できるようになる！</li>
</ul>
<h2 id="準備-2"><a class="header" href="#準備-2">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="dbの基本"><a class="header" href="#dbの基本">DBの基本</a></h1>
<h2 id="dbとは"><a class="header" href="#dbとは">DBとは</a></h2>
<ul>
<li>web上にデータを保存するためのもの．</li>
<li>構造はエクセルなどと対比するとイメージしやすい！</li>
<li>データを操作するにはSQL（言語）を用いる．</li>
</ul>
<h2 id="使い所"><a class="header" href="#使い所">使い所</a></h2>
<ul>
<li>webアプリケーションでデータを保存する場合のほとんど．</li>
</ul>
<h3 id="利用シーンの例"><a class="header" href="#利用シーンの例">利用シーンの例</a></h3>
<ul>
<li>ECサイトの商品データ（商品名，画像，説明文）</li>
<li>サービスに登録しているユーザの情報（ユーザ名，アドレス，etc）</li>
<li>ブログの投稿内容（投稿日時，タイトル，画像，本文，etc）</li>
</ul>
<h2 id="dbのデータ構造と概念"><a class="header" href="#dbのデータ構造と概念">DBのデータ構造と概念</a></h2>
<p>エクセルと同様のデータ構造となっている．実際にデータが格納されるのは「テーブル」であり，テーブルをどう設計するかがアプリケーションの根幹となる．</p>
<table><thead><tr><th>DBの概念</th><th>エクセルの概念</th></tr></thead><tbody>
<tr><td>データベース</td><td>エクセルファイル</td></tr>
<tr><td>テーブル</td><td>シート</td></tr>
<tr><td>レコード</td><td>行</td></tr>
<tr><td>カラム</td><td>列</td></tr>
</tbody></table>
<h3 id="-key-point-20"><a class="header" href="#-key-point-20">💡 Key Point</a></h3>
<blockquote>
<p>テーブル設計を行う際には，エクセルやスプレッドシートに書き出しながら作業すると視覚的に確認できるのでオススメ．</p>
</blockquote>
<h3 id="データ構造の例"><a class="header" href="#データ構造の例">データ構造の例</a></h3>
<p>ECサイトの商品データをイメージしたテーブルを下記に示す．</p>
<p>（下記のデーブル構造はまだ改善点があるが，後の講義で解説する．）</p>
<table><thead><tr><th align="right">id</th><th>product_name</th><th align="right">price</th><th>category</th><th>image_url</th></tr></thead><tbody>
<tr><td align="right">1</td><td>Laphroaig</td><td align="right">40</td><td>whisky</td><td>./images/laphroaig.png</td></tr>
<tr><td align="right">2</td><td>Ardbeg</td><td align="right">45</td><td>whisky</td><td>./images/ardbeg.png</td></tr>
<tr><td align="right">3</td><td>Caolila</td><td align="right">50</td><td>whisky</td><td>./images/caolila.png</td></tr>
<tr><td align="right">4</td><td>Kilchoman</td><td align="right">50</td><td>whisky</td><td>./images/kilchoman.png</td></tr>
<tr><td align="right">5</td><td>Bowmore</td><td align="right">45</td><td>whisky</td><td>./images/bowmore.png</td></tr>
<tr><td align="right">6</td><td>PortCharlotte</td><td align="right">55</td><td>whisky</td><td>./images/portcharlotte.png</td></tr>
<tr><td align="right">...</td><td>...</td><td align="right">..</td><td>...</td><td>...</td></tr>
</tbody></table>
<h3 id="dbの動き方のイメージ"><a class="header" href="#dbの動き方のイメージ">DBの動き方のイメージ</a></h3>
<p>「サーバ」には3種類存在し，相互に連携しながらWebアプリケーションを動作させている．ただし，Webサーバとアプリケーションサーバは区別の概念が難しいため，一旦「DBサーバとそれ以外」という理解で進めてしまってOK．</p>
<ul>
<li>「Webサーバ」：ブラウザにデータを返す．</li>
<li>「アプリケーションサーバ」：PHPなどのサーバサイド言語を動かす．</li>
<li>「DBサーバ」：データを提供する．</li>
</ul>
<p>ブラウザ，PHP，DBが連携するイメージを以下に示す．</p>
<p><img src="php/php02/./img/php_crud01_about-db.svg" alt="DBの動き方イメージ" /></p>
<h3 id="-key-point-21"><a class="header" href="#-key-point-21">💡 Key Point</a></h3>
<blockquote>
<p>処理の流れを把握しよう！</p>
<p>例えば，PHPとDBを連携させ，保存されているデータを画面に表示する流れは以下のとおりとなる．</p>
<ol>
<li>PHPからDBサーバに接続する．</li>
<li>DBを操作するSQLを実行し，必要なデータを取得する．</li>
<li>取得したデータをHTML上に反映させ，画面に表示する．</li>
</ol>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db--テーブルの作成"><a class="header" href="#db--テーブルの作成">DB / テーブルの作成</a></h1>
<h2 id="dbの作成"><a class="header" href="#dbの作成">DBの作成</a></h2>
<p>まずは基本単位となるDBを作成する．</p>
<p>1つのアプリケーションに対して1つのDB，というイメージでOK．</p>
<ul>
<li><a href="http://localhost/phpmyadmin/">http://localhost/phpmyadmin/</a>にアクセス</li>
<li>「<code>Databases</code>」タブをクリック</li>
<li>「<code>Database name</code>」に「gsacf_クラス種別&amp;番号2桁_受講番号2桁」を入力（DB名）
<ul>
<li>例：LAB5期受講番号00の場合 =&gt; <code>gsacf_l05_00</code></li>
</ul>
</li>
<li>「<code>utf8mb4_unicode_ci</code>」を選択→「作成」をクリック</li>
</ul>
<p>正常に作成されると，画面左側に作成したDB名が表示される．</p>
<h2 id="テーブルとカラムの作成"><a class="header" href="#テーブルとカラムの作成">テーブルとカラムの作成</a></h2>
<p>今回実装するtodoリストのデータ用テーブルを準備する．</p>
<p>テーブルは1つのDB内に複数作成し，相互に連携してWebアプリケーションのデータを構築する．</p>
<h3 id="テーブルの作成"><a class="header" href="#テーブルの作成">テーブルの作成</a></h3>
<p>以下の手順でテーブルを作成しよう．</p>
<ol>
<li>左側のDB一覧から前項で作成したDBを選択する．</li>
<li>名前欄に「<code>todo_table</code>」を入力（テーブル名）．</li>
<li>カラム数を「5」に設定する．</li>
<li>「Go」ボタンをクリック．</li>
</ol>
<h3 id="カラムの設定"><a class="header" href="#カラムの設定">カラムの設定</a></h3>
<p>テーブルに格納されるデータは定められた形式（文字列，数値，日付など）で保存しなければならない．</p>
<p>カラム設定時，各カラムに「名前」と「データ型」を設定する必要がある．下記の表に従ってカラム名とデータ型を設定しよう．</p>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>todo</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>deadline</code></td><td>DATE</td><td>-</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<ul>
<li>idは単一のデータを取得するためのもので，インデックスを「PRIMARY」に設定する必要がある．</li>
<li>また，idは自動的に数値を1から順に振るため，「A_I（Auto Increment）」にチェックしておく</li>
</ul>
<p>全て入力したら右下の「保存する」をクリック！！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="sqlによるdb操作"><a class="header" href="#sqlによるdb操作">SQLによるDB操作</a></h1>
<h2 id="sqlとは"><a class="header" href="#sqlとは">SQLとは</a></h2>
<p>DBの操作には「SQL（言語）」を使用する．</p>
<p>PHPでDBを操作するときは，コード内でSQL文を実行する．</p>
<p>フレームワークなどではコード内では実行しない場合もある．ただし，フレームワークが関数の実行結果としてSQLを生成して実行するため，DB操作は必ずSQLで行われる．</p>
<h2 id="基本のsql4種"><a class="header" href="#基本のsql4種">基本のSQL4種</a></h2>
<p>まずはデータ操作の基本となる4種類を押さえましょう！</p>
<ul>
<li><code>INSERT</code>：データの「作成」</li>
<li><code>SELECT</code>：データの「参照」</li>
<li><code>UPDATE</code>：データの「更新」</li>
<li><code>DELETE</code>：データの「削除」</li>
</ul>
<p>※SQL文は大文字で記載していますが，小文字でも動作する．他の言語（本講座ではPHP）と組み合わせる際に区別しやすいよう大文字で記載している．他の言語でも大文字で扱うことが多い．</p>
<h2 id="insertデータの作成"><a class="header" href="#insertデータの作成">INSERT（データの作成）</a></h2>
<p>指定したテーブルに対して新規データの作成を行う．</p>
<p>ポイントは以下！</p>
<ul>
<li>「カラム名の数と順序」と「値の数と順序」を一致させる必要がある．</li>
<li><code>id</code>カラムはDB側でAuto incrementの設定をしているため<code>NULL</code>を送信する．</li>
<li>作成日時や更新日時は<code>now()</code>を使用して実行時の日付時刻が入力されるようにする．</li>
</ul>
<pre><code class="language-sql">
-- INSERT文の基本構造
INSERT INTO テーブル名 (カラム1, カラム2, ...) VALUES (値1, 値2, ...);

-- 例
INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES(NULL, 'SQL練習', '2021-12-31', now(), now());

</code></pre>
<h2 id="selectデータの参照"><a class="header" href="#selectデータの参照">SELECT（データの参照）</a></h2>
<p>SELECT文はデータの参照に使用されるが，フィルタリングやソートなど多様なオプションが用意されている．</p>
<h3 id="select文の基本"><a class="header" href="#select文の基本">SELECT文の基本</a></h3>
<pre><code class="language-sql">-- SELECT文の基本構造
SELECT 表示するカラム名 FROM テーブル名;

-- 例

-- 「*」で全て指定
SELECT * FROM todo_table;

-- 1つのカラムを指定
SELECT todo FROM todo_table;

-- 複数カラム指定
SELECT todo, deadline FROM todo_table;

</code></pre>
<h3 id="フィルタリング"><a class="header" href="#フィルタリング">フィルタリング</a></h3>
<p>データの条件を設定してフィルタリングをおこなうことができる．フィルタリングには<code>WHERE</code>を使用する．</p>
<pre><code class="language-sql">-- 「WHERE」を使用して値の条件を指定できる
SELECT * FROM todo_table WHERE deadline='2021-12-31';

-- 演算子の使用
SELECT * FROM todo_table WHERE deadline &lt;= '2021-12-31';
SELECT * FROM todo_table WHERE deadline &gt;= '2021-12-01' AND deadline &lt;= '2021-12-31';

-- あいまい検索
SELECT * FROM todo_table WHERE todo LIKE 'PHP%';
SELECT * FROM todo_table WHERE todo LIKE '%提出';
SELECT * FROM todo_table WHERE todo LIKE '%課題%';

</code></pre>
<h3 id="ソート"><a class="header" href="#ソート">ソート</a></h3>
<p>並び替えには<code>ORDER BY</code>を使用する．</p>
<ul>
<li>基準となるカラム名を指定し，</li>
<li>昇順（<code>ASC</code>）か降順（<code>DESC</code>）を指定する．</li>
</ul>
<pre><code class="language-sql">-- ORDER BYを使用した並び替え
-- `deadline`カラムの値で降順に並び替え
SELECT * FROM todo_table ORDER BY deadline DESC;
-- `todo`カラムの値で昇順に並び替え
SELECT * FROM todo_table ORDER BY todo ASC;

</code></pre>
<h3 id="取得するデータ件数の制限"><a class="header" href="#取得するデータ件数の制限">取得するデータ件数の制限</a></h3>
<p><code>LIMIT</code>を用いてデータ件数の制限を行うことができる．最新10件，などの使い方がメジャー．</p>
<pre><code class="language-sql">-- LIMITで表示件数の制限
SELECT * FROM todo_table LIMIT 5;

-- 並び替えとの組み合わせ
SELECT * FROM todo_table ORDER BY deadline DESC LIMIT 5;

</code></pre>
<h2 id="updateデータの更新"><a class="header" href="#updateデータの更新">UPDATE（データの更新）</a></h2>
<p>UPDATEは次回の講義で扱う．</p>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="deleteデータの削除"><a class="header" href="#deleteデータの削除">DELETE（データの削除）</a></h2>
<p>DELETEは次回の講義で扱う．</p>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="参考sqlの練習"><a class="header" href="#参考sqlの練習">【参考】SQLの練習</a></h2>
<p><a href="https://sqlzoo.net/">https://sqlzoo.net/</a></p>
<p>初歩から応用までSQL問題が出題．当面は最初の方の基本的なデータ取得ができればOK．</p>
<h2 id="練習-16"><a class="header" href="#練習-16">練習</a></h2>
<p>SQLはphpmyadminの「SQLタブ」から記述&amp;実行できる．</p>
<ol>
<li>INSERT文を用いて<code>todo_table</code>にデータを10件程度作成しよう．</li>
<li>SELECT文を用いて作成したデータを取り出そう．
<ul>
<li>WHERE, ORDER BY, LIMITを試して，想定どおりのデータを取得できるかどうか確認！</li>
</ul>
</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携データ作成処理"><a class="header" href="#phpとdbの連携データ作成処理">PHPとDBの連携（データ作成処理）</a></h1>
<h2 id="必要なファイル-2"><a class="header" href="#必要なファイル-2">必要なファイル</a></h2>
<ul>
<li><code>todo_input.php</code>：データ入力画面．</li>
<li><code>todo_create.php</code>：DB接続，データ作成処理を実行．</li>
</ul>
<h2 id="処理の流れ-6"><a class="header" href="#処理の流れ-6">処理の流れ</a></h2>
<ol>
<li><code>todo_input.php</code>で入力されたデータを<code>todo_create.php</code>へ送信（post）．</li>
<li><code>todo_create.php</code>でデータを受け取り，DBへの新規データ作成．</li>
<li>作成完了後，<code>todo_input.php</code>（入力画面）へ移動．（<code>todo_create.php</code>では画面表示なし）</li>
</ol>
<h2 id="送信側の処理-2"><a class="header" href="#送信側の処理-2">送信側の処理</a></h2>
<p>フォームからデータを送信する．以下3点の漏れやスペルミスがないよう確認しよう．</p>
<ul>
<li>action</li>
<li>method</li>
<li>name</li>
</ul>
<pre><code class="language-php">// todo_input.php

&lt;form action=&quot;todo_create.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<h2 id="受信側の処理-2"><a class="header" href="#受信側の処理-2">受信側の処理</a></h2>
<p>データ受け取り側では以下の処理を実装する．</p>
<ul>
<li>必須項目の入力チェック</li>
<li>データの受け取り</li>
<li>DB接続</li>
<li>SQL作成&amp;実行</li>
<li>SQL実行後の処理</li>
</ul>
<h3 id="入力チェック"><a class="header" href="#入力チェック">入力チェック</a></h3>
<p>DBにデータを格納する場合，基本的にデータの欠損は許されない（データなしを許可する設定もある）．</p>
<p>そのため，以下の条件に合致する場合は以降の処理を中止してエラー画面を表示する．</p>
<ul>
<li>必須項目（todoとdeadline）のデータが送信されていない．</li>
<li>必須項目（todoとdeadline）が空で送信されている．</li>
</ul>
<pre><code class="language-php">// todo_create.php

if (
  !isset($_POST['todo']) || $_POST['todo']=='' ||
  !isset($_POST['deadline']) || $_POST['deadline']==''
) {
  exit('ParamError');
}

</code></pre>
<h3 id="参考エラーメッセージを出力する意味"><a class="header" href="#参考エラーメッセージを出力する意味">【参考】エラーメッセージを出力する意味</a></h3>
<p>どこで失敗したのかをわかるようにする！</p>
<ul>
<li>PHPではエラーを見つけづらい．．．</li>
<li>データを扱うので，異常なデータなどが作成されるとまずい．</li>
<li>どこでエラーが出ているのかわからないと詰む．</li>
<li>エラーにも種類がある！
<ul>
<li>どこでうまくいっていないのかを把握できるようにエラーの処理を記述！</li>
</ul>
</li>
</ul>
<h3 id="データ受け取り"><a class="header" href="#データ受け取り">データ受け取り</a></h3>
<p>前回講義のtxtファイルの場合と同様．POSTで送信しているため<code>$_POST</code>で受け取る．</p>
<pre><code class="language-php">// todo_create.php

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

</code></pre>
<h3 id="db接続"><a class="header" href="#db接続">DB接続</a></h3>
<p>DBに接続するコードは決まった形式（<code>PDO</code>）．</p>
<p>接続の際には以下の情報が必要になる．今回は<code>dbname</code>のみ設定が必要．</p>
<ul>
<li><code>dbname</code>：DBの名前</li>
<li><code>port</code>：接続ポート</li>
<li><code>host</code>：DBのホスト名</li>
<li><code>username</code>：DB接続時のユーザ名</li>
<li><code>password</code>：DB接続時のパスワード</li>
</ul>
<pre><code class="language-php">// todo_create.php

// 各種項目設定
$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

// DB接続
try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

// 「dbError:...」が表示されたらdb接続でエラーが発生していることがわかる．

</code></pre>
<h3 id="sql作成実行"><a class="header" href="#sql作成実行">SQL作成&amp;実行</a></h3>
<p>SQL（今回はINSERT文）を実行する場合も手順が決まっている．</p>
<ol>
<li>SQL文の記述．</li>
<li>バインド変数の設定．</li>
<li>SQL実行．</li>
</ol>
<pre><code class="language-php">// todo_create.php

// SQL作成&amp;実行
$sql = 'INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES (NULL, :todo, :deadline, now(), now())';

$stmt = $pdo-&gt;prepare($sql);

// バインド変数を設定
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);

// SQL実行（実行に失敗すると$statusにfalseが返ってくる）
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="補足バインド変数とsqlインジェクション"><a class="header" href="#補足バインド変数とsqlインジェクション">【補足】バインド変数とSQLインジェクション</a></h3>
<p>SQLインジェクションと呼ばれるハッキング手法が存在する．</p>
<p>例えば，下記のようにコードを記述されている場合．．．</p>
<pre><code class="language-php">$query = &quot;SELECT * FROM user WHERE id = '$user_id'&quot;;
</code></pre>
<p><code>$user_id</code>に「<code>' or 'A' = 'A</code>」を入れると，下記と同じ意味になってしまう！</p>
<pre><code class="language-sql">SELECT * FROM user;
</code></pre>
<p>-&gt; 不正にユーザのデータを取得できてしまう！！！</p>
<p>バインド変数を用いることで，SQL文として実行されないようにできる！</p>
<p>ユーザが入力した値をSQL文内で使用する場合には必ずバインド変数を使用すること．</p>
<h3 id="sql実行時の処理"><a class="header" href="#sql実行時の処理">SQL実行時の処理</a></h3>
<p>実行に失敗すると<code>$status</code>に<code>false</code>が返ってくるため，条件分岐して失敗を検出する．</p>
<p><code>$stmt-&gt;errorInfo()</code>と記述することでエラー内容（配列形式）を取得することができ，2番めのデータにエラーメッセージが格納されている．</p>
<p>SQLが正常に実行された場合は，データ入力画面に移動することとする．</p>
<pre><code class="language-php">// todo_create.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  header('Location:todo_input.php');
}

</code></pre>
<h2 id="練習-17"><a class="header" href="#練習-17">練習</a></h2>
<p>DBにデータを追加する処理を実装しよう！</p>
<ol>
<li><code>todo_input.php</code>にフォームを作成</li>
<li><code>todo_create.php</code>で
<ul>
<li>データを受け取る</li>
<li>DBに接続</li>
<li>SQL文を書いて実行</li>
</ul>
</li>
</ol>
<p>phpmyadminでテーブルを確認し，データが作成されていればOK！</p>
<ul>
<li>phpmyadminの「表示」タブをクリックすると最新のデータを読み込める．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携データ参照処理"><a class="header" href="#phpとdbの連携データ参照処理">PHPとDBの連携（データ参照処理）</a></h1>
<h2 id="必要なファイル-3"><a class="header" href="#必要なファイル-3">必要なファイル</a></h2>
<ul>
<li><code>todo_read.php</code>：DBからデータを取得してデータの一覧画面を作成する．</li>
</ul>
<h2 id="処理の流れ-7"><a class="header" href="#処理の流れ-7">処理の流れ</a></h2>
<ol>
<li>表示ファイル（<code>todo_read.php</code>）へアクセス時，DB接続する．</li>
<li>データ参照用SQL作成→実行．</li>
<li>取得したデータをHTMLに埋め込んで画面を表示．</li>
</ol>
<p>※必要に応じて，並び替えやフィルタリングを実施してみよう．</p>
<h2 id="dbデータ作成処理の実装"><a class="header" href="#dbデータ作成処理の実装">DBデータ作成処理の実装</a></h2>
<h3 id="db接続-1"><a class="header" href="#db接続-1">DB接続</a></h3>
<p>新規データ作成の場合と同様の処理．</p>
<pre><code class="language-php">// todo_read.php

$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

</code></pre>
<h3 id="sql作成実行-1"><a class="header" href="#sql作成実行-1">SQL作成&amp;実行</a></h3>
<p>データ作成処理と同様にSQLを記述して実行する．今回は「ユーザが入力したデータ」を使用しないのでバインド変数は不要．</p>
<p>また，<code>$status</code>には実行結果が入るが，この時点ではまだデータ自体の取得はできていない点に注意．</p>
<pre><code class="language-php">// todo_read.php

$sql = 'SELECT * FROM todo_table';
$stmt = $pdo-&gt;prepare($sql);
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="sql実行後の処理"><a class="header" href="#sql実行後の処理">SQL実行後の処理</a></h3>
<p>SQLの実行に失敗した場合はエラーを表示して処理を中止する．</p>
<p>SQLが正常に実行された場合は以下の流れで処理が実行される．</p>
<ul>
<li><code>fetchAll()</code>関数でデータ自体を取得する．</li>
<li>繰り返し処理を用いて，取得したデータからHTMLタグを生成する．</li>
<li>（HTML内の任意の位置に作成したタグを設置</li>
</ul>
<pre><code class="language-php">// todo_read.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
  $output = &quot;&quot;;
  foreach ($result as $record) {
    $output .= &quot;
      &lt;tr&gt;
        &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
        &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;/tr&gt;
    &quot;;
  }
}

</code></pre>
<h3 id="htmlにタグを埋め込み"><a class="header" href="#htmlにタグを埋め込み">HTMLにタグを埋め込み</a></h3>
<pre><code class="language-php">// todo_read.php

// html部分にデータを追加
&lt;tbody&gt;
  &lt;!-- ↓に&lt;tr&gt;&lt;td&gt;deadline&lt;/td&gt;&lt;td&gt;todo&lt;/td&gt;&lt;tr&gt;の形でデータが入る --&gt;
  &lt;?= $output ?&gt;
&lt;/tbody&gt;

</code></pre>
<h3 id="参考jsを用いたタグ生成"><a class="header" href="#参考jsを用いたタグ生成">【参考】JSを用いたタグ生成</a></h3>
<p>上記では「PHP内でタグを生成 → HTML内に埋め込み」という実装を行っているが，タグ生成部分をJSで行うこともできる．</p>
<p>どちらが正解というものではないので，自身のイメージしやすいパターンで実装すれば問題ない．</p>
<pre><code class="language-php">&lt;?php

// DB接続，SQL実行など

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  // PHPではデータを取得するところまで実施
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
}

?&gt;

&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;table&gt;
      &lt;tbody id=&quot;output&quot;&gt;&lt;/tbody&gt;
    &lt;table&gt;

    &lt;script&gt;
      // PHPのデータをJSに渡す
      const resultArray = &lt;?=json_encode($result) ?&gt;;
      // 配列からタグ生成し，#outputに表示する
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;


</code></pre>
<h2 id="練習-18"><a class="header" href="#練習-18">練習</a></h2>
<p>DBのデータを読み出して表示する処理を実装しよう！</p>
<p><code>todo_read.php</code>で</p>
<ul>
<li>DBに接続</li>
<li>SQL文を書いて実行</li>
<li>取得したデータをHTMLに埋め込み</li>
</ul>
<p>テーブルのデータが画面に一覧で表示されればOK！</p>
<p>できた人はSQL文を編集してフィルタリングやソートなどを実装してみよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題と提出時の注意点-1"><a class="header" href="#課題と提出時の注意点-1">課題と提出時の注意点</a></h1>
<p><strong>DBを使用したアプリを実装しよう！</strong></p>
<p>DBを扱うことでWebアプリケーションの基本的な機能を実装できる．日頃使っているWebアプリケーションの中で，DBやSQLがどのように使われているのかイメージしてみると，活用方法のイメージが湧くだろう．</p>
<h2 id="dbやテーブル"><a class="header" href="#dbやテーブル">DBやテーブル</a></h2>
<ul>
<li>DB名：今回作成したものを使用</li>
<li>テーブル構成：自由に！（講義で使用した<code>todo_table</code>の構成は変更しないこと！）</li>
</ul>
<h2 id="構成"><a class="header" href="#構成">構成</a></h2>
<p>基本は下記ファイル（処理）を作成！（ファイル構成や名前は変更してOK！）</p>
<ul>
<li>input.php	（作成画面）</li>
<li>create.php	（作成処理）</li>
<li>select.php	（参照&amp;表示処理）</li>
</ul>
<p>卒制のプロトタイプ的な作品とか，SNS的なものとか！</p>
<h2 id="-注意点-1"><a class="header" href="#-注意点-1">⚠️ 注意点</a></h2>
<ul>
<li>DB使用時にはDBに保存されたデータも必要．</li>
<li>DBのデータ（テーブルなど）もまとめて提出！</li>
<li>「DB」は必ず授業でつくったものを使用すること！</li>
</ul>
<p><img src="php/php02/./img/php_crud01_sql_export_01.svg" alt="sqlファイルエクスポート1" />
<img src="php/php02/./img/php_crud01_sql_export_02.svg" alt="sqlファイルエクスポート2" />
<img src="php/php02/./img/php_crud01_sql_export_03.svg" alt="sqlファイルエクスポート3" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db連携_crud処理後半"><a class="header" href="#php_db連携_crud処理後半">PHP_DB連携_CRUD処理後半</a></h1>
<h2 id="本講義の内容とゴール-6"><a class="header" href="#本講義の内容とゴール-6">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-6"><a class="header" href="#本講義の内容-6">本講義の内容</a></h3>
<ul>
<li>DB内のデータを更新する処理，削除する処理を実装する．</li>
<li>関数専用のファイルを作成し，読み込みを実行を行う．</li>
<li>todoリストの基本的な機能について実装を完了する．</li>
</ul>
<h3 id="本講義のゴール-6"><a class="header" href="#本講義のゴール-6">本講義のゴール</a></h3>
<ul>
<li>基本的なCRUD処理を実装し，処理の流れを理解する．</li>
<li>複数のファイルで使用する共通のコードの管理手法を学ぶ．</li>
<li>オリジナルWebサービスの構想からCRUD処理の設計につなげる．</li>
</ul>
<h3 id="todoアプリケーションの全体像"><a class="header" href="#todoアプリケーションの全体像">todoアプリケーションの全体像</a></h3>
<p><img src="php/php03/./img/php_crud02_app_construct.svg" alt="todoアプリ全体像" /></p>
<h2 id="準備-3"><a class="header" href="#準備-3">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db接続関数の作成"><a class="header" href="#db接続関数の作成">DB接続関数の作成</a></h1>
<h2 id="db接続は常に同じコード"><a class="header" href="#db接続は常に同じコード">DB接続は常に同じコード</a></h2>
<p>実は．．．</p>
<ul>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で記述したDB接続のコードは全く同じ！</li>
<li>今回作成する<code>todo_edit.php</code>, <code>todo_update.php</code>, <code>todo_delete.php</code>も同じ記述！</li>
</ul>
<p>であれば．．！</p>
<p>一つの関数にまとめられる！</p>
<p>=&gt; 関数用のファイルを作成しよう！（<code>functions.php</code>）</p>
<h2 id="関数の定義"><a class="header" href="#関数の定義">関数の定義</a></h2>
<p>DB接続の処理は様々なファイルで実行されるため，関数専用のファイル（<code>functions.php</code>）に記述して他のファイルから読み込むと効率が良い．</p>
<p>関数を実行すると，DB接続情報を出力するように実装すると良い（<code>return new PDO...</code>部分）．</p>
<pre><code class="language-php">// functions.php

function connect_to_db()
{
  $dbn='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
  $user = 'root';
  $pwd = '';
  try {
    return new PDO($dbn, $user, $pwd);
  } catch (PDOException $e) {
    exit('dbError:'.$e-&gt;getMessage());
  }
}

</code></pre>
<h2 id="関数の実行"><a class="header" href="#関数の実行">関数の実行</a></h2>
<p>上で定義した関数はDB接続が必要なファイルで<code>functions.php</code>を読み込むことで実行可能．</p>
<p>別ファイルの読み込みは<code>include()</code>関数を用いる．</p>
<pre><code class="language-php">// DB接続したいファイル（todo_create.php, todo_read.php, など）

include('functions.php');
$pdo = connect_to_db();

// 他のDB接続が必要なファイルでも上記の2行でOK！

</code></pre>
<h2 id="練習-19"><a class="header" href="#練習-19">練習</a></h2>
<ol>
<li><code>functions.php</code>にDB接続の関数を定義しよう！</li>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で<code>functions.php</code>を<code>include()</code>し，関数を実行しよう！</li>
</ol>
<p>今まで通りの動きが確認できればOK！</p>
<p>（これまでやっていた処理を関数にしただけなので，実行される内容はこれまでと変化なし）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携3編集画面の作成"><a class="header" href="#phpとdbの連携3編集画面の作成">PHPとDBの連携3（編集画面の作成）</a></h1>
<h2 id="処理の流れ-8"><a class="header" href="#処理の流れ-8">処理の流れ</a></h2>
<p>データ更新の処理はデータ作成処理の流れと似ている！</p>
<p>まずは本項で1と2を実装する．</p>
<ol>
<li>一覧画面に更新ページへのリンクを作成（urlにidを追加： todo_edit.php?id=**）</li>
<li>更新ページの作成（todo_edit.php）</li>
<li>更新処理の作成（todo_update.php）</li>
<li>一覧画面に戻る</li>
</ol>
<h2 id="一覧画面にリンク追加"><a class="header" href="#一覧画面にリンク追加">一覧画面にリンク追加</a></h2>
<p><code>&lt;a&gt;</code>を用いて編集画面（と削除処理）へのリンクを作成する．</p>
<p>GETメソッドが「データをURLに格納する」仕様を利用し，<code>&lt;a&gt;</code>のURLに各データの<code>id</code>を埋め込む．</p>
<pre><code class="language-php">// todo_read.php

foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;
      &lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<p>下図のようにリンクが表示されればOK．</p>
<p>リンクにマウスカーソルを当てると，ブラウザ左下にリンク先のURLが表示される．<code>id=**</code>の形で数値が表示されれば正しく指定されている．</p>
<p><img src="php/php03/./img/php_crud02_todo_read.png" alt="一覧画面リンク表示" /></p>
<h2 id="編集画面の作成"><a class="header" href="#編集画面の作成">編集画面の作成</a></h2>
<p>続いて，編集画面を実装する．</p>
<p>本画面の役割は</p>
<ul>
<li>現在テーブルに保存されている<code>todo</code>と<code>deadline</code>を表示する．</li>
<li>ユーザが画面上でデータを編集する．</li>
<li>ユーザが編集したデータをテーブル更新用ファイル（<code>todo_update.php</code>）に送信する．</li>
</ul>
<p>コードのポイントは以下．</p>
<ul>
<li>SELECT文を用いて<code>id</code>指定し，<code>fetch()</code>関数でデータを取得する．</li>
<li>取得したデータを<code>&lt;input&gt;</code>の初期値として設定する．</li>
<li>次の更新処理で<code>id</code>が必要になるため，<code>&lt;input type=&quot;hidden&quot;&gt;</code>を用いて<code>id</code>を送信する．</li>
</ul>
<pre><code class="language-php">include(&quot;functions.php&quot;);

$id = $_GET['id'];

$pdo = connect_to_db();

$sql = 'SELECT * FROM todo_table WHERE id=:id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_INT);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $record = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
}
?&gt;

// 以下HTML部分
&lt;form action=&quot;todo_update.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;DB連携型todoリスト（編集画面）&lt;/legend&gt;
    &lt;a href=&quot;todo_read.php&quot;&gt;一覧画面&lt;/a&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot; value=&quot;&lt;?= $record['todo'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot; value=&quot;&lt;?= $record['deadline'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?= $record['id'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<p>下図のように現在のデータが画面に表示されればOK．</p>
<p><img src="php/php03/./img/php_crud02_todo_edit.png" alt="編集画面データ表示" /></p>
<h2 id="練習-20"><a class="header" href="#練習-20">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>一覧画面に<code>todo_edit.php</code>へのリンクを追加！（<code>todo_delete.php</code>へのリンクも一緒に！）</li>
<li><code>todo_edit.php</code>ではデータをIDで検索し，該当するデータを画面に表示！</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携4データ更新処理の作成"><a class="header" href="#phpとdbの連携4データ更新処理の作成">PHPとDBの連携4（データ更新処理の作成）</a></h1>
<h2 id="データ更新のsql"><a class="header" href="#データ更新のsql">データ更新のSQl</a></h2>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="更新の処理"><a class="header" href="#更新の処理">更新の処理</a></h2>
<p>前項の編集画面からデータを受け取り，DBのデータを更新する．</p>
<p>処理の流れは<code>todo_create.php</code>とよく似ている．</p>
<h3 id="データチェックと受け取り"><a class="header" href="#データチェックと受け取り">データチェックと受け取り</a></h3>
<p>まずは<code>todo</code>，<code>deadline</code>，<code>id</code>のデータが揃っていることを確認し，データを受け取る．</p>
<pre><code class="language-php">// todo_update.php

if (
  !isset($_POST['todo']) || $_POST['todo'] == '' ||
  !isset($_POST['deadline']) || $_POST['deadline'] == '' ||
  !isset($_POST['id']) || $_POST['id'] == ''
) {
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;no input&quot;]);
  exit();
}

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];
$id = $_POST['id'];

</code></pre>
<h3 id="db接続とsql実行"><a class="header" href="#db接続とsql実行">DB接続とSQL実行</a></h3>
<p>続いてDB接続し，UPDATEのSQLを実行する．SQLが正常に実行された場合は一覧画面に移動する．</p>
<h3 id="-key-point-22"><a class="header" href="#-key-point-22">💡 Key Point</a></h3>
<blockquote>
<p>必ずWHEREでidを指定すること！！！</p>
</blockquote>
<pre><code class="language-php">// todo_update.php

include('functions.php');
$pdo = connect_to_db();

$sql = 'UPDATE todo_table SET todo=:todo, deadline=:deadline, updated_at=now() WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header('Location:todo_read.php');
  exit();
}

</code></pre>
<h2 id="練習-21"><a class="header" href="#練習-21">練習</a></h2>
<p><code>todo_update.php</code>でUPDATEの処理を実装しよう！</p>
<p>更新処理実行後，一覧ページでデータが更新されていればOK！</p>
<p>（phpmyadminでも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携5データ削除処理"><a class="header" href="#phpとdbの連携5データ削除処理">PHPとDBの連携5（データ削除処理）</a></h1>
<h2 id="データ削除のsql"><a class="header" href="#データ削除のsql">データ削除のSQL</a></h2>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="処理の流れ-9"><a class="header" href="#処理の流れ-9">処理の流れ</a></h2>
<ol>
<li>✅ 一覧画面に削除ページへのリンクを作成（urlにidを追加<code>todo_delete.php?id=**</code>）</li>
<li>削除処理の作成（<code>todo_delete.php</code>）</li>
<li>テーブルのデータを削除したら一覧画面に戻る</li>
</ol>
<h2 id="削除の実装"><a class="header" href="#削除の実装">削除の実装</a></h2>
<p>削除に必要なのは<code>id</code>のみである．編集画面に移動する場合と同様にGETで<code>id</code>を受け取る．</p>
<p>データを受け取ったら，下記の順で処理を記述する．</p>
<ul>
<li>DB接続</li>
<li>SQL実行（DELETE文）</li>
<li>一覧画面へ移動</li>
</ul>
<h3 id="-key-point-23"><a class="header" href="#-key-point-23">💡 Key Point</a></h3>
<blockquote>
<p>⚠️ DELETE文を実行する場合には必ずWHEREで<code>id</code>を指定すること．</p>
</blockquote>
<pre><code class="language-php">$id = $_GET['id'];

include('functions.php');
$pdo = connect_to_db();

$sql = 'DELETE FROM todo_table WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-22"><a class="header" href="#練習-22">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>✅ 一覧画面に<code>todo_delete.php</code>へのリンクを追加！</li>
<li><code>todo_delete.php</code>ではデータをIDで検索し，該当するデータを削除！</li>
<li>完了したら<code>todo_read.php</code>へ戻る．</li>
</ol>
<p>削除処理実行後，一覧ページでデータが削除されていればOK！</p>
<p>（phpmyadminでも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-4"><a class="header" href="#課題-4">課題</a></h1>
<h2 id="課題1"><a class="header" href="#課題1">課題1</a></h2>
<p><strong>前回の課題に機能追加しよう！</strong></p>
<ul>
<li>表示処理	&lt;- 更新画面へのリンクなど追加</li>
<li>更新画面</li>
<li>更新処理</li>
<li>削除処理</li>
</ul>
<p>もちろん新しいアイデアで作り直してもOK！</p>
<p>そろそろwebアプリケーションの全体（卒制含め）が実装できるぞッ！</p>
<p>※そろそろ作り始めないとキツイ．．！</p>
<h3 id="考えるときのポイント"><a class="header" href="#考えるときのポイント">考えるときのポイント</a></h3>
<ul>
<li>世の中のWebアプリケーションはどのようなCRUD処理を実行しているのかを考えてみる．</li>
<li>自分のアイデアではどこでどのようなCRUD処理が実行すればよいのかを当てはめてみる．</li>
<li>テーブルの項目が異なるけどやっている処理自体は同じ．</li>
</ul>
<h2 id="課題2"><a class="header" href="#課題2">課題2</a></h2>
<h3 id="ユーザ管理テーブルの作成"><a class="header" href="#ユーザ管理テーブルの作成">ユーザ管理テーブルの作成</a></h3>
<p>次回の講義ではユーザ情報を連携させた機能を実装する．その際に使用する<code>users_table</code>を作成しておこう．</p>
<h3 id="テーブル名"><a class="header" href="#テーブル名">テーブル名</a></h3>
<p><code>users_table</code></p>
<h3 id="カラム構造"><a class="header" href="#カラム構造">カラム構造</a></h3>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>username</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>password</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>is_admin</code></td><td>INT</td><td>1</td><td>管理者ユーザと一般ユーザの識別に使用</td></tr>
<tr><td><code>is_deleted</code></td><td>INT</td><td>1</td><td>論理削除に使用</td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<h3 id="ユーザ管理機能の実装"><a class="header" href="#ユーザ管理機能の実装">ユーザ管理機能の実装</a></h3>
<p>前項でつくったユーザのデータを管理する処理を実装しよう！</p>
<p>講義で作成したtodoリストと同じ手順で実装できるので，内容が理解不足の人は自分の課題に取り組む前に復習を兼ねて実装してみよう．</p>
<ul>
<li>ユーザ作成処理</li>
<li>ユーザ一覧参照&amp;表示処理</li>
<li>ユーザデータ更新処理</li>
<li>ユーザデータ削除処理</li>
</ul>
<p>サービス管理者がユーザのデータを操作するイメージなので画面のデザイン等は不要．</p>
<p>こちらは提出不要．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_セッション"><a class="header" href="#php_セッション">PHP_セッション</a></h1>
<h2 id="本講義の内容とゴール-7"><a class="header" href="#本講義の内容とゴール-7">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-7"><a class="header" href="#本講義の内容-7">本講義の内容</a></h3>
<ul>
<li>セッション機能の確認．</li>
<li>ログイン処理，ログアウト処理の実装．</li>
<li>todoリストをログインしていないと使えないようにする．</li>
</ul>
<h3 id="本講義のゴール-7"><a class="header" href="#本講義のゴール-7">本講義のゴール</a></h3>
<ul>
<li>ページ間でデータ共有する方法を知る！</li>
<li>プロダクトの中で最適なデータの管理方法を選べるようになる！</li>
<li>「ログインしているとはなにか」をマスター！</li>
</ul>
<h2 id="準備-4"><a class="header" href="#準備-4">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッションとは"><a class="header" href="#セッションとは">セッションとは</a></h1>
<h2 id="セッションとはなにか"><a class="header" href="#セッションとはなにか">セッションとはなにか</a></h2>
<ul>
<li>サーバに変数などを保存できる仕組み．</li>
<li>サーバ自体に変数を定義する．</li>
<li>サーバ上にあるどのファイルからでも値を取り出せる！</li>
</ul>
<h3 id="普通の変数を使用した例"><a class="header" href="#普通の変数を使用した例">普通の変数を使用した例</a></h3>
<p>各ファイルで用意した変数はそのファイル内でしか使用できない．</p>
<table><thead><tr><th>file</th><th>data</th></tr></thead><tbody>
<tr><td>hoge.php</td><td>$number = 100;</td></tr>
<tr><td>fuga.php</td><td>$keyword = 'ジーズ';</td></tr>
<tr><td>piyo.php</td><td>$array = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td></tr>
</tbody></table>
<h3 id="セッション変数を活用"><a class="header" href="#セッション変数を活用">セッション変数を活用</a></h3>
<p>セッション領域自体にデータを保存することができ，サーバ上のどのファイルからでもアクセスすることができる．</p>
<p>セッション変数は<code>$_SESSION</code>で記述する（後述）．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];
      </td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッションの使用とsession_id"><a class="header" href="#セッションの使用とsession_id">セッションの使用と「session_id」</a></h2>
<p>セッションは下記の流れで使用する．</p>
<ol>
<li>セッションの開始．
<ul>
<li>セッションがスタートすると「セッション領域」が作られる．</li>
<li>セッション領域識別用の id（<code>session_id</code>）が発行される．</li>
<li>セッションの機能が使えるようになり，情報を保存できる．</li>
<li>session_id の再生成ができる．</li>
</ul>
</li>
<li>必要に応じてセッション変数（<code>$_SESSION</code>）にデータを保存．</li>
<li><code>session_id</code>の再生成
<ul>
<li>悪意あるサイトに<code>session_id</code>を読まれてしまうとハッキングのリスク．</li>
<li>ページ移動などのタイミングで id を再生成し，最新版だけを有効にする．</li>
</ul>
</li>
<li>セッションの終了．
<ul>
<li>保存されている情報などを破棄する．</li>
</ul>
</li>
</ol>
<h3 id="session_id-の確認"><a class="header" href="#session_id-の確認">session_id の確認</a></h3>
<p>まずはセッションの開始を宣言する．
セッションに関連する機能を使用する場合には必ず記述する必要がある．</p>
<pre><code class="language-php">session_start();
</code></pre>
<p>セッションを開始すると自動的に id が発行されてブラウザに id が保存される．</p>
<p>id はサーバとブラウザの双方に保存され，下記の方法で確認することができる．</p>
<ol>
<li>PHP ファイル上で<code>session_id();</code>で取得可能．</li>
<li>ブラウザで「検証 → Application → Cookies → localhost」
<ul>
<li>現在有効な session_id が保存されている．</li>
</ul>
</li>
</ol>
<h3 id="session_id-の再生成"><a class="header" href="#session_id-の再生成">session_id の再生成</a></h3>
<p>session_id がバレると他の人に session の中身をいじられてしまう可能性がある．．！</p>
<p><code>session_regenerate_id();</code>を使用すると id を再生成して更新できる．</p>
<p>（保存されているデータ自体は変更なし）</p>
<p>使い所</p>
<ul>
<li>ログインしたら id 発行してログイン情報を管理．</li>
<li>ページ移動など特定の操作をしたタイミングで再生成して古い id を無効化する．</li>
</ul>
<pre><code class="language-php">// session_regenerate_id.php

&lt;?php
// セッションの開始
session_start();
$old_session_id = session_id();

// 再生成
session_regenerate_id(true);
$new_session_id = session_id();

// 新旧のidを画面に表示して更新されていることを確認
echo &quot;&lt;p&gt;旧id: {$old_session_id}&lt;/p&gt;&quot;;
echo &quot;&lt;p&gt;新id: {$new_session_id}&lt;/p&gt;&quot;;
exit();

?&gt;

</code></pre>
<h3 id="-key-point-24"><a class="header" href="#-key-point-24">💡 Key Point</a></h3>
<blockquote>
<p><code>session_regenerate_id(true);</code>の<code>true</code>が大切！！</p>
<p><code>true</code>を設定することで古い id を無効にすることができる．</p>
</blockquote>
<h3 id="セッションの終了"><a class="header" href="#セッションの終了">セッションの終了</a></h3>
<p>セッションの終了に際しては保存したデータの削除が必要になる．</p>
<p>以下の 3 つの手順でデータを削除する．</p>
<ol>
<li>セッション変数の削除．</li>
<li>ブラウザに保存されたセッション id の有効期間操作．</li>
<li>セッション領域の削除．</li>
</ol>
<p>これらの処理は後のステップで実装する．</p>
<pre><code class="language-php">// 指定したsession変数の削除
unset($_SESSION[key]);

// session情報の全削除
$_SESSION = array();

// ブラウザに保存した情報の有効期限を操作
setcookie(session_name(), '', time() - 42000, '/');

// session領域自体をを破壊
session_destroy();

</code></pre>
<p><a href="https://www.php.net/manual/ja/function.session-destroy.php">参考</a></p>
<h2 id="練習-23"><a class="header" href="#練習-23">練習</a></h2>
<p>下記の処理を実装してセッションと session_id の挙動を確認しよう．</p>
<ul>
<li>id を発行して確認しよう！</li>
<li>再生成して旧 id と新 id を表示しよう！</li>
</ul>
<p>検証画面で確認し，リロードの度に新 ID と一致すれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッション変数"><a class="header" href="#セッション変数">セッション変数</a></h1>
<p>セッション領域に保存される変数を使用することで，複数のファイルで横断的にデータを扱うことができる．</p>
<h2 id="セッション変数の形式"><a class="header" href="#セッション変数の形式">セッション変数の形式</a></h2>
<p>セッション変数は<code>$_SESSION</code>で記述する．</p>
<p>連想配列形式（JavaScript のオブジェクトに相当）で扱われる．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッション変数の定義"><a class="header" href="#セッション変数の定義">セッション変数の定義</a></h2>
<p>セッション変数を扱う際にも<code>session_start();</code>は必須！</p>
<p>セッション変数は<code>$_SESSION['キー名']</code>の形式で宣言するが，使い方は通常の変数と同様である．</p>
<pre><code class="language-php">// session01.php

&lt;?php
session_start();

// セッション変数に値を代入
$_SESSION['keyword'] = 'PHP';

echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="セッション変数の使用"><a class="header" href="#セッション変数の使用">セッション変数の使用</a></h2>
<p>セッション変数はセッション領域に保存されているので，ファイル内で定義していなくても呼び出すことができる．</p>
<p>使い方は通常の変数と同様．</p>
<pre><code class="language-php">// session02.php

&lt;?php

session_start();

// `$_SESSION['keyword']`はセッション変数なので定義していなくても呼び出せる
$string = $_SESSION['keyword'] . '&amp;MySQL';
echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="練習-24"><a class="header" href="#練習-24">練習</a></h2>
<p>下記の処理を記述して，セッション変数の動き方を確認しよう．</p>
<ul>
<li><code>session01.php</code>で session 変数を定義しよう！</li>
<li><code>session02.php</code>で定義した変数を呼び出して出力しよう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装-1ログインとログアウト"><a class="header" href="#認証処理の実装-1ログインとログアウト">認証処理の実装 1（ログインとログアウト）</a></h1>
<!-- ## ユーザテーブルの準備

ユーザのデータを格納するテーブルが必要になる．テーブルの構成は以下のとおりである．

|カラム名|データ型|長さ|その他設定項目|
|---|---|---|---|
|`id`|INT|12|インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．|
|`username`|VARCHAR|128||
|`password`|VARCHAR|128||
|`is_admin`|INT|1|管理者ユーザと一般ユーザの識別に使用|
|`is_deleted`|INT|1|論理削除に使用|
|`created_at`|DATETIME|-||
|`updated_at`|DATETIME|-||


テーブルを数件のテストデータを作成するため，下記のSQL文を実行する．

`phpmyadmin`画面で`dec_todo`のデータベースを選択し，`SQL`タブから実行する．

```sql
CREATE TABLE users_table(
  id int(12) not null primary key auto_increment,
  username varchar(128) not null,
  password varchar(128) not null,
  is_admin int(1) not null,
  is_deleted int(1) not null,
  created_at datetime not null,
  updated_at datetime not null
)
;
INSERT INTO users_table(
  id,
  username,
  password,
  is_admin,
  is_deleted,
  created_at,
  updated_at
)
VALUES(
  NULL,
  'testuser01',
  '111111',
  1,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser02',
  '222222',
  0,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser03',
  '333333',
  0,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser04',
  '444444',
  0,
  0,
  now(),
  now()
)
;

``` -->
<h2 id="処理に必要なファイル"><a class="header" href="#処理に必要なファイル">処理に必要なファイル</a></h2>
<p>ログイン処理に<code>todo_login.php</code>と<code>todo_login.php</code>，ログアウト処理に<code>todo_logout.php</code>を使用する．</p>
<table><thead><tr><th>file</th><th>役割</th></tr></thead><tbody>
<tr><td><code>todo_login.php</code></td><td>ログイン情報（username, password）を入力して送信する．</td></tr>
<tr><td><code>todo_login_act.php</code></td><td>送信されたデータを受け取り，DB 関連の処理を実行する．</td></tr>
<tr><td><code>todo_logout.php</code></td><td>セッション，ログイン情報を破棄する．</td></tr>
</tbody></table>
<h2 id="ログイン処理"><a class="header" href="#ログイン処理">ログイン処理</a></h2>
<h3 id="ログイン処理の流れ"><a class="header" href="#ログイン処理の流れ">ログイン処理の流れ</a></h3>
<ol>
<li>ログインフォーム情報を入力して送信（<code>todo_login.php</code>）</li>
<li>送信されたデータを受け取る（<code>todo_login_act.php</code>）</li>
<li>受け取ったデータが DB にあるかどうかチェック（<code>todo_login_act.php</code>）
<ul>
<li>成功時（DB にユーザのデータが存在した場合）
<ul>
<li>DB にログイン情報があればセッション変数に格納（<code>todo_login_act.php</code>）</li>
<li>セッション変数にログイン情報を保持して<code>todo_read.php</code>に移動</li>
</ul>
</li>
<li>失敗時（DB にユーザのデータが存在しなかった場合）
<ul>
<li><code>todo_login.php</code>に戻るリンクを表示する（ログイン失敗）</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="ログイン画面の実装"><a class="header" href="#ログイン画面の実装">ログイン画面の実装</a></h2>
<p>ログインフォームに<code>action</code>，<code>method</code>，<code>name</code>を設定する．</p>
<p>データを<code>todo_login_act.php</code>に送信する．</p>
<pre><code class="language-php">// todo_login.php

&lt;form action=&quot;todo_login_act.php&quot; method=&quot;POST&quot;&gt;
  // ...
  &lt;div&gt;
    username: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    password: &lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;button&gt;Login&lt;/button&gt;
  &lt;/div&gt;
  // ...
&lt;/form&gt;

</code></pre>
<h2 id="データ受け取り--ログイン処理"><a class="header" href="#データ受け取り--ログイン処理">データ受け取り → ログイン処理</a></h2>
<p>データを受け取ったら，ユーザのテーブルに該当するデータが存在するかどうかを確認する．</p>
<pre><code class="language-php">// todo_login_act.php

&lt;?php
session_start();
include('functions.php');

$username = $_POST['username'];
$password = $_POST['password'];

$pdo = connect_to_db();

// username，password，is_deletedの3項目全てを満たすデータを抽出する．
$sql = 'SELECT * FROM users_table WHERE username=:username AND password=:password AND is_deleted=0';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':username', $username, PDO::PARAM_STR);
$stmt-&gt;bindValue(':password', $password, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

</code></pre>
<p>データの有無で条件分岐する．</p>
<ul>
<li>データが存在しない場合はログイン画面へ移動するリンクを表示する．</li>
<li>データが存在した場合はセッション変数に session_id とユーザのデータを入れ，一覧画面に移動する．</li>
</ul>
<pre><code class="language-php">if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $val = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
  if (!$val) {
    echo &quot;&lt;p&gt;ログイン情報に誤りがあります&lt;/p&gt;&quot;;
    echo &quot;&lt;a href=todo_login.php&gt;ログイン&lt;/a&gt;&quot;;
    exit();
  } else {
    $_SESSION = array();
    $_SESSION['session_id'] = session_id();
    $_SESSION['is_admin'] = $val['is_admin'];
    $_SESSION['username'] = $val['username'];
    header(&quot;Location:todo_read.php&quot;);
    exit();
  }
}

</code></pre>
<h3 id="-key-point-25"><a class="header" href="#-key-point-25">💡 Key Point</a></h3>
<blockquote>
<p><code>session_id</code>はこの後使用するので必ず保存しよう．</p>
<p>ユーザデータはアプリケーションに必要なものを適宜選別してセッションに保存する．</p>
</blockquote>
<h2 id="ログアウト"><a class="header" href="#ログアウト">ログアウト</a></h2>
<p>ログアウトの処理は前項のセッション終了のコードそのもの．</p>
<p>ユーザの痕跡をなくすことが肝要．</p>
<pre><code class="language-php">// todo_logout.php

&lt;?php
session_start();
$_SESSION = array();
if (isset($_COOKIE[session_name()])) {
  setcookie(session_name(), '', time() - 42000, '/');
}
session_destroy();
header('Location:todo_login.php');
exit();

</code></pre>
<h2 id="練習-25"><a class="header" href="#練習-25">練習</a></h2>
<p>ログインとログアウトの処理を実装しよう！</p>
<ol>
<li>ログインフォームを実装！（<code>todo_login.php</code>）</li>
<li>ログイン処理を実装！（<code>todo_login_act.php</code>）</li>
<li>ログアウト処理を実装！（<code>todo_logout.php</code>）</li>
</ol>
<p>以下の動作が確認できれば OK．</p>
<ul>
<li>存在するユーザの username と password を入力して一覧ページが表示される．</li>
<li>存在しないユーザの username と password を入力してログインページへのリンクが表示される．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装-2認証状態の確認"><a class="header" href="#認証処理の実装-2認証状態の確認">認証処理の実装 2（認証状態の確認）</a></h1>
<p>todo リストの機能はログインしているときのみアクセスできるようにしたい！</p>
<p>現状では，ログアウトした状態でも URL を手打ちするとアクセスできてしまう．．．</p>
<ul>
<li>登録画面，一覧画面などはログイン済ユーザのみ見られるようにする</li>
<li>ログインをチェックし，ログインしていない状態ならログイン画面に移動</li>
</ul>
<h2 id="ログインしているとはなにか"><a class="header" href="#ログインしているとはなにか">「ログインしている」とはなにか</a></h2>
<p>以下の 2 つの状態を「ログインしていない」とみなす！！</p>
<ul>
<li>「セッション変数に<code>session_id</code>を持っていない」</li>
<li>「id が最新ではない」はログインしていない状態</li>
</ul>
<h2 id="関数の定義-1"><a class="header" href="#関数の定義-1">関数の定義</a></h2>
<p>上記 2 条件を用いてログインの有無を判断する関数を作成する．</p>
<p>関数の役割は</p>
<ol>
<li>ログインしていない場合はログインページへ強制送還．</li>
<li>ログインしている場合は<code>session_id</code>を更新してセッション変数に保存する．
<ul>
<li>セッション変数には常に最新の<code>session_id</code>が入っている状態にする．</li>
</ul>
</li>
</ol>
<p>複数のファイルでチェックを行うため，関数ファイルに記述しよう！</p>
<pre><code class="language-php">// functions.php

function check_session_id()
{
  if (!isset($_SESSION[&quot;session_id&quot;]) ||$_SESSION[&quot;session_id&quot;] != session_id()) {
    header('Location:todo_login.php');
    exit();
  } else {
    session_regenerate_id(true);
    $_SESSION[&quot;session_id&quot;] = session_id();
  }
}

</code></pre>
<h2 id="関数の実行-1"><a class="header" href="#関数の実行-1">関数の実行</a></h2>
<p>あとは定義した関数を「ログインしていないときに動いてほしくない PHP ファイル」で実行しよう．</p>
<p>セッションの機能を使用するため，<code>session_start();</code>を忘れないように注意！</p>
<p>下記ファイルで実行すると良き．</p>
<ul>
<li><code>todo_input.php</code></li>
<li><code>todo_read.php</code></li>
<li><code>todo_edit.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_update.php</code></li>
<li><code>todo_delete.php</code></li>
</ul>
<pre><code class="language-php">// ログインしていないときに動いてほしくないPHPファイル

&lt;?php
session_start();
include('functions.php');
check_session_id();

</code></pre>
<h3 id="-key-point-26"><a class="header" href="#-key-point-26">💡 Key Point</a></h3>
<blockquote>
<p>ログインしているユーザだけがアクセスできる画面と誰でもアクセスできる画面がそれぞれどの画面なのかを明確にすることが大切．</p>
<p>同様に管理者ユーザのみがアクセス可能な画面を切り分けることも同様の方法で可能．</p>
</blockquote>
<h2 id="練習-26"><a class="header" href="#練習-26">練習</a></h2>
<p>メインのコンテンツは未ログインだとアクセスできないようにしよう！</p>
<ul>
<li>ログイン状態を確認する関数をつくろう！（functions.php）</li>
<li>コンテンツのページで上記関数を実行しよう！</li>
</ul>
<p>ログアウトした状態で各ページにアクセスできない状態（ログインページに移動）になれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-5"><a class="header" href="#課題-5">課題</a></h1>
<p><strong>セッション機能を用いて管理機能を実装しよう</strong></p>
<p>DB を扱うことで Web アプリケーションの基本的な機能を実装できる．日頃使っている Web アプリケーションの中で，DB や SQL がどのように使われているのかイメージしてみると，活用方法のイメージが湧くだろう．</p>
<h2 id="まずは下記の機能を実装しよう既存-web-サービスのコピー実装もオススメ"><a class="header" href="#まずは下記の機能を実装しよう既存-web-サービスのコピー実装もオススメ">まずは下記の機能を実装しよう（既存 web サービスのコピー実装もオススメ！）</a></h2>
<ul>
<li>ログイン画面</li>
<li>ログイン処理</li>
<li>ログアウト処理</li>
</ul>
<h2 id="ユーザの種類によって権限を分けてみよう"><a class="header" href="#ユーザの種類によって権限を分けてみよう">ユーザの種類によって権限を分けてみよう</a></h2>
<p>todo リストの例</p>
<table><thead><tr><th>ユーザ種別</th><th>できること</th><th>アクセスできるページ</th></tr></thead><tbody>
<tr><td>ログインしていないユーザ</td><td>情報を見るだけ（登録，更新&amp;削除不可）</td><td>ログイン画面<br>編集不可の todo 一覧画面</td></tr>
<tr><td>一般ユーザ</td><td>情報の登録，表示，更新，削除が可能</td><td>ログイン画面<br>編集不可の todo 一覧画面<br>todo 一覧画面<br>todo 登録画面<br>todo 編集画面</td></tr>
<tr><td>管理者ユーザ</td><td>ユーザの登録，表示，更新，削除も可能</td><td>ログイン画面<br>編集不可の todo 一覧画面<br>todo 一覧画面<br>todo 登録画面<br>todo 編集画面<br>ユーザ一覧画面<br>ユーザ編集画面<br>ユーザ編集画面</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db応用_rdb"><a class="header" href="#php_db応用_rdb">PHP_DB応用_RDB</a></h1>
<h2 id="本講義の内容とゴール-8"><a class="header" href="#本講義の内容とゴール-8">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-8"><a class="header" href="#本講義の内容-8">本講義の内容</a></h3>
<ul>
<li>RDBのデータ構造紹介．</li>
<li>SQLを用いたデータ集計（Like機能）．</li>
<li>todoリスト一覧での集計結果表示．</li>
</ul>
<h3 id="本講義のゴール-8"><a class="header" href="#本講義のゴール-8">本講義のゴール</a></h3>
<ul>
<li>データ構造を知り，よくないテーブルのパターンを把握する！</li>
<li>データの件数をカウントし，集計する！</li>
<li>複数のテーブルを結合し，必要なデータをまとめる！</li>
</ul>
<h2 id="準備-5"><a class="header" href="#準備-5">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="rdb-の構造"><a class="header" href="#rdb-の構造">RDB の構造</a></h1>
<h2 id="rdbrelational-databaseとは"><a class="header" href="#rdbrelational-databaseとは">RDB（Relational Database）とは</a></h2>
<h3 id="複雑なデータが必要なとき"><a class="header" href="#複雑なデータが必要なとき">複雑なデータが必要なとき</a></h3>
<ul>
<li>一つのテーブルから取得できる情報は限られている．</li>
<li>EC で購入したユーザの情報と商品の情報を両方取得したい場合は．．？？</li>
</ul>
<h3 id="複数のテーブル同士を連携relationさせるッ"><a class="header" href="#複数のテーブル同士を連携relationさせるッ">複数のテーブル同士を連携（relation）させるッ！！</a></h3>
<ul>
<li>テーブルの設計段階で連携させたい id のカラムをつくっておく！</li>
<li>両方のテーブルを関連付けるテーブルを「SQL で」作成する！</li>
<li>大事なのはデータの構造を見極めること！！</li>
</ul>
<p>まずは下記 2 種類のデータ構造をマスターしよう！</p>
<h2 id="one-to-many学部テーブルと学生テーブル"><a class="header" href="#one-to-many学部テーブルと学生テーブル">One to Many（学部テーブルと学生テーブル）</a></h2>
<p>一つの学部には複数の学生が在籍するが，学生の所属は一つ．</p>
<h3 id="学部テーブルdepartment_table"><a class="header" href="#学部テーブルdepartment_table">学部テーブル（department_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>工学部</td></tr>
<tr><td align="right">2</td><td>理学部</td></tr>
<tr><td align="right">3</td><td>医学部</td></tr>
<tr><td align="right">4</td><td>歯学部</td></tr>
<tr><td align="right">5</td><td>農学部</td></tr>
<tr><td align="right">6</td><td>文学部</td></tr>
<tr><td align="right">7</td><td>経済学部</td></tr>
</tbody></table>
<h3 id="学生テーブルstudent_table"><a class="header" href="#学生テーブルstudent_table">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<p>「多」の側に対応する id を入れる構造にすれば OK．</p>
<p>誰がどこに所属しているかがわかるようになる！</p>
<table><thead><tr><th align="right">id</th><th>name</th><th align="right">department_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td><td align="right">1</td></tr>
<tr><td align="right">3</td><td>リサリサ</td><td align="right">2</td></tr>
<tr><td align="right">4</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">6</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td><td align="right">4</td></tr>
<tr><td align="right">8</td><td>川尻早人</td><td align="right">4</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td><td align="right">5</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td><td align="right">5</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td><td align="right">6</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td><td align="right">6</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td><td align="right">7</td></tr>
</tbody></table>
<h2 id="many-to-many学生テーブルと講義テーブル"><a class="header" href="#many-to-many学生テーブルと講義テーブル">Many to Many（学生テーブルと講義テーブル）</a></h2>
<p>学生は複数の講義を選択し，講義も複数の学生に提供される．</p>
<h3 id="学生テーブルstudent_table-1"><a class="header" href="#学生テーブルstudent_table-1">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">student_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<h3 id="講義テーブルclass_table"><a class="header" href="#講義テーブルclass_table">講義テーブル（class_table）</a></h3>
<table><thead><tr><th align="right">class_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>線形代数学</td></tr>
<tr><td align="right">2</td><td>微分積分学</td></tr>
<tr><td align="right">3</td><td>電子回路</td></tr>
<tr><td align="right">4</td><td>電気回路</td></tr>
<tr><td align="right">5</td><td>情報学</td></tr>
<tr><td align="right">6</td><td>情報数学</td></tr>
<tr><td align="right">7</td><td>統計学</td></tr>
<tr><td align="right">8</td><td>信号処理</td></tr>
<tr><td align="right">9</td><td>電磁気学</td></tr>
</tbody></table>
<h3 id="中間テーブル"><a class="header" href="#中間テーブル">中間テーブル</a></h3>
<p>この場合，「どの講義を」「どの学生が選択するか」を表す別のテーブルを作成する．</p>
<p>このテーブルのことを「中間テーブル」と呼ぶ．</p>
<table><thead><tr><th align="right">class_id</th><th align="right">student_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">1</td><td align="right">2</td></tr>
<tr><td align="right">1</td><td align="right">7</td></tr>
<tr><td align="right">7</td><td align="right">7</td></tr>
<tr><td align="right">3</td><td align="right">9</td></tr>
<tr><td align="right">1</td><td align="right">6</td></tr>
<tr><td align="right">3</td><td align="right">1</td></tr>
<tr><td align="right">5</td><td align="right">5</td></tr>
<tr><td align="right">7</td><td align="right">5</td></tr>
</tbody></table>
<h2 id="テーブルの設計"><a class="header" href="#テーブルの設計">テーブルの設計</a></h2>
<p>データ構造を考える際には，「どうすればうまくいくか」よりも「このパターンはマズイ」を押さえるとうまくいきやすい．</p>
<p>マズイパターンのことを「アンチパターン」と呼ぶが，まずは下記のパターンがないかどうか確認しよう．</p>
<h3 id="-key-point-27"><a class="header" href="#-key-point-27">💡 Key Point</a></h3>
<blockquote>
<p>出やすいアンチパターン</p>
<ul>
<li>ユーザの操作でテーブルが増える（減る）．</li>
<li>ユーザの操作でカラムが増える（減る）．</li>
<li>一つのセル（でいいのかな？）に複数のデータ（数値など）が入る．</li>
<li>なにかのデータを更新したときに，別のテーブルのデータを更新する必要がある．</li>
</ul>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装1データの追加1"><a class="header" href="#like機能の実装1データの追加1">Like機能の実装1（データの追加1）</a></h1>
<p>前回までに作成したtodoリストにLike機能（Many to Manyの関係）を追加する！</p>
<h2 id="アプリケーションの動作"><a class="header" href="#アプリケーションの動作">アプリケーションの動作</a></h2>
<ul>
<li>各ユーザは複数のtodoにLikeし，各todoは複数のユーザからLikeされる．</li>
<li>一覧画面のLikeボタンをクリックしたらLikeすることができ，Like数が一覧画面に表示される．</li>
<li>Likeは1ユーザ1Likeに制限する（自演禁止）．</li>
</ul>
<h2 id="必要な作業処理"><a class="header" href="#必要な作業処理">必要な作業・処理</a></h2>
<ul>
<li>ユーザテーブルといいねテーブルを作成．</li>
<li>Likeボタン追加．</li>
<li>Likeボタンクリック時にLikeデータを作成．</li>
<li>Like数を一覧画面に表示する．</li>
</ul>
<h2 id="likeテーブルを作成"><a class="header" href="#likeテーブルを作成">Likeテーブルを作成</a></h2>
<p>新しくテーブルを作成する．テーブル名は「<code>like_table</code>」とする．</p>
<p>このテーブルでは「どのユーザが」「どのtodoに」Likeしたのかを記録する役割を持つ．</p>
<p>前項の「中間テーブル」にあたる．</p>
<h3 id="カラム構造-1"><a class="header" href="#カラム構造-1">カラム構造</a></h3>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>user_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>todo_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<h2 id="todoリストのlike機能実装"><a class="header" href="#todoリストのlike機能実装">todoリストのLike機能実装</a></h2>
<h3 id="やりたいこと-2"><a class="header" href="#やりたいこと-2">やりたいこと</a></h3>
<p>いいねボタンをクリックしたら．．．</p>
<ul>
<li>like_tableに「誰が」「何に」いいねをしたのかを追加</li>
</ul>
<p>実装の方針</p>
<ul>
<li>todo_read.phpにいいねボタンを設置</li>
<li>GETでtodoのidとユーザのidを送信する</li>
<li>受け取り側のファイル（like_create.php）で受け取ったデータをdbに登録</li>
</ul>
<h2 id="todo一覧画面にlikeボタンの設置"><a class="header" href="#todo一覧画面にlikeボタンの設置">todo一覧画面にLikeボタンの設置</a></h2>
<p>一覧画面のタグ生成部分にLikeボタンを追記する．</p>
<p>user_idはログイン時にセッション変数に保存している値を使用している（<code>todo_login_act.php</code>を参照）．</p>
<p><code>user_id</code>と<code>todo_id</code>を<code>like_create.php</code>にGETで送信する．</p>
<pre><code class="language-php">// todo_read.php

$user_id = $_SESSION['id'];

// ↓タグ生成部分
$output .= &quot;&lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like&lt;/a&gt;&lt;/td&gt;&quot;;
// 以下編集ボタン，削除ボタンなど

</code></pre>
<h2 id="likeデータの追加"><a class="header" href="#likeデータの追加">Likeデータの追加</a></h2>
<p>LikeテーブルにGETで送信されてきた内容を追加する．</p>
<p>処理の流れ自体はシンプルなINSERT処理．</p>
<pre><code class="language-php">// like_create.php

include('functions.php');

$user_id = $_GET['user_id'];
$todo_id = $_GET['todo_id'];

$pdo = connect_to_db();

$sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, sysdate())';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-27"><a class="header" href="#練習-27">練習</a></h2>
<p>todoリストにLike機能を追加しよう．</p>
<ul>
<li><code>todo_read.php</code>にLikeボタンを追加．</li>
<li><code>like_create.php</code>でテーブルにデータ作成．</li>
</ul>
<p>Likeボタンをクリックして，Likeテーブルにデータが作成されていればOK．</p>
<p>（phpmyadminでデータを確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装2データの追加2"><a class="header" href="#like機能の実装2データの追加2">Like機能の実装2（データの追加2）</a></h1>
<h2 id="ここまでのlike機能の問題点"><a class="header" href="#ここまでのlike機能の問題点">ここまでのLike機能の問題点</a></h2>
<h3 id="現状"><a class="header" href="#現状">現状</a></h3>
<ul>
<li>連打すれば無限にLikeできてしまう．．．</li>
<li>Likeしている状況であれば，Likeを取り消す処理にしたい！</li>
</ul>
<h3 id="実装の方針"><a class="header" href="#実装の方針">実装の方針</a></h3>
<ul>
<li>Likeボタンをクリックしたら，まずtodoとuserでテーブルを検索する．</li>
<li>データが1件以上存在すればDELETEのSQLを実行する．</li>
<li>データが存在しなければINSERTのSQL（前項で実装したもの）を実行する．</li>
</ul>
<h2 id="like状態の調査"><a class="header" href="#like状態の調査">Like状態の調査</a></h2>
<p>前項で作成した<code>like_create.php</code>のINSERT処理の前にデータの件数を確認したい．</p>
<p>件数の確認には<code>COUNT()</code>関数を使用する．</p>
<pre><code class="language-php">// like_create.php

// 省略

$sql = 'SELECT COUNT(*) FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $like_count = $stmt-&gt;fetchColumn();
  // まずはデータ確認
  var_dump($like_count);
  exit();
}

</code></pre>
<h2 id="like数で条件分岐削除or作成"><a class="header" href="#like数で条件分岐削除or作成">Like数で条件分岐（削除or作成）</a></h2>
<p><code>$like_count</code>で条件に該当するデータの件数が取得できるのでまずは確認する．</p>
<p>データの件数が確認できたら，件数が0かそれ以外で条件分岐する．0件でなければDELETE文が作成され，0件の場合はINSERT文が作成される．</p>
<pre><code class="language-php">// like_create.php

if ($like_count != 0) {
  // いいねされている状態
  $sql = 'DELETE FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
} else {
  // いいねされていない状態
  $sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, sysdate())';
}

// 以下は前項と変更なし
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<p>このように記述することで，1ユーザ1Likeの状態を実現することができる．</p>
<h2 id="練習-28"><a class="header" href="#練習-28">練習</a></h2>
<p>todoリストのLike機能を編集しよう．</p>
<ul>
<li><code>like_create.php</code>でLike数カウント -&gt; 条件分岐してDELETE or INSERT．</li>
</ul>
<p>以下2条件で動作確認！</p>
<ul>
<li>「Likeされていない状態」でLikeボタンをクリックして，Likeテーブルにデータが作成されていればOK．</li>
<li>「Likeされている状態」でLikeボタンをクリックして，Likeテーブルのデータが削除されていればOK．</li>
</ul>
<p>phpmyadminでデータを確認し，10件程度データが入っている状態にしておこう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装3集計とlike数表示"><a class="header" href="#like機能の実装3集計とlike数表示">Like機能の実装3（集計とLike数表示）</a></h1>
<h2 id="やりたいこと-3"><a class="header" href="#やりたいこと-3">やりたいこと</a></h2>
<ul>
<li>ここまででLike数を1ユーザあたり1件に制限する処理を実装した．</li>
<li>しかし，現状ではLike状況を確認するにはphpmyadminにアクセスして確認するしかなくアプリケーション側に情報が表示されない．</li>
<li>そこで，本項ではLikeされた件数をtodo一覧画面に表示するための処理を実装する．</li>
</ul>
<h2 id="手順"><a class="header" href="#手順">手順</a></h2>
<ul>
<li>Like情報が保存されている「Likeテーブル」を用いて，各todoが何件Likeされているのかを集計する．</li>
<li>「todoテーブル」と「集計結果のテーブル」を結合し，両方のデータを一度に取得できるようにする．</li>
<li>取得したデータを画面に表示する．</li>
</ul>
<h2 id="集計"><a class="header" href="#集計">集計</a></h2>
<p>GROUP BYを使うと集計ができる！</p>
<h3 id="例phpmyadminで実行しよう"><a class="header" href="#例phpmyadminで実行しよう">例（phpmyadminで実行しよう！）</a></h3>
<pre><code class="language-sql">SELECT
  todo_id,
  COUNT(id) AS like_count
FROM
  like_table
GROUP BY
  todo_id
</code></pre>
<p>「<code>like_table</code>」の「<code>todo_id</code>」ごとに「idの数」を「<code>like_count</code>」というカラム名で表示する．</p>
<p>集計したカラムのカラム名は自由に設定できる（しなくても良い）が，後ほど再利用する場合は何らかの名前を指定しておくのがオススメ．</p>
<p>実行すると下記のような集計結果のテーブルが表示される．下記は一例なので，<code>like_table</code>のデータによって件数は変化する．</p>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="-key-point-28"><a class="header" href="#-key-point-28">💡 Key Point</a></h3>
<blockquote>
<p>このSQL文は「集計結果のテーブル」を出力する！！</p>
</blockquote>
<h3 id="注意点"><a class="header" href="#注意点">注意点</a></h3>
<ul>
<li>COUNT()で件数を取得しているが，集計関数以外だとエラーになる</li>
<li>その他の集計関数
<ul>
<li><code>MIN()</code>, <code>MAX()</code>, <code>SUM()</code>, etc...</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like-機能の実装-4データの結合"><a class="header" href="#like-機能の実装-4データの結合">Like 機能の実装 4（データの結合）</a></h1>
<h2 id="画面表示のためにデータをまとめる"><a class="header" href="#画面表示のためにデータをまとめる">画面表示のためにデータをまとめる．</a></h2>
<ul>
<li>現状，画面の表示は<code>todo_table</code>からデータなので，集計結果を組み込めない．．．</li>
<li>テーブルを結合させることで，集計結果もまとめて表示できる！</li>
</ul>
<h2 id="sql-の考え方"><a class="header" href="#sql-の考え方">SQL の考え方</a></h2>
<ul>
<li>「<code>todo_table</code>」と「集計結果のテーブル」をつなげる．</li>
<li>「<code>todo_table</code>の<code>id</code>」と「集計結果のテーブルの<code>todo_id</code>」を対応させる．</li>
<li>「集計結果のテーブル」は前項で取得したアレ</li>
</ul>
<h2 id="テーブルの結合join"><a class="header" href="#テーブルの結合join">テーブルの結合（JOIN）</a></h2>
<p>JOIN を使うとテーブルの結合ができる！</p>
<h3 id="例-6"><a class="header" href="#例-6">例</a></h3>
<p>JOIN を使う場合の書式は以下のとおり．この場合は以下の条件で結合する．</p>
<ul>
<li>別々のテーブルで管理している「ユーザ」と「ユーザが所属するカテゴリ」を 1 つの画面に表示したい．</li>
<li>「<code>user_table</code>」「<code>category_table</code>」を結合する．</li>
<li>結合する際には，「<code>user_table</code>の<code>category_id</code>カラム」と「<code>category_table</code>の<code>category_id</code>カラム」を対応させる．</li>
</ul>
<h3 id="user_table"><a class="header" href="#user_table">user_table</a></h3>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
</tbody></table>
<h3 id="category_table"><a class="header" href="#category_table">category_table</a></h3>
<table><thead><tr><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>ダイヤモンドは砕けない</td></tr>
<tr><td align="right">5</td><td>黄金の風</td></tr>
<tr><td align="right">6</td><td>ストーンオーシャン</td></tr>
<tr><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h3 id="sql-文"><a class="header" href="#sql-文">SQL 文</a></h3>
<pre><code class="language-sql">SELECT
  *
FROM
  user_table
  LEFT OUTER JOIN
    category_table
  ON  user_table.category_id = category_table.category_id
</code></pre>
<h3 id="join-したテーブル"><a class="header" href="#join-したテーブル">JOIN したテーブル</a></h3>
<p>このテーブルがあれば，画面に必要な情報を全て表示することができる．SQL 文の「ON」の後にどのカラムとどのカラムを対応させるのかと記述する．</p>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h2 id="今回の-todo-リストで結合したいテーブルの状況"><a class="header" href="#今回の-todo-リストで結合したいテーブルの状況">今回の todo リストで結合したいテーブルの状況</a></h2>
<p>「<code>todo_table</code>」と「集計結果のテーブル」を結合する．</p>
<h3 id="todo_table"><a class="header" href="#todo_table"><code>todo_table</code></a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL 練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td></tr>
<tr><td align="right">2</td><td>PHP 課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td></tr>
</tbody></table>
<h3 id="集計結果のテーブル"><a class="header" href="#集計結果のテーブル">集計結果のテーブル</a></h3>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="sql-文-1"><a class="header" href="#sql-文-1">SQL 文</a></h3>
<ul>
<li>今回は「<code>todo_table</code>の<code>id</code>」と「集計結果の<code>todo_id</code>」が対応させる．</li>
<li>「集計結果のテーブル」は前項で<code>GROUP BY</code>して出力したテーブル．このテーブルには<code>result-table</code>という名前をつける．</li>
</ul>
<pre><code class="language-sql">SELECT
  *
FROM
  todo_table
  LEFT OUTER JOIN
    (
      SELECT
        todo_id,
        COUNT(id) AS like_count
      FROM
        like_table
      GROUP BY
        todo_id
    ) AS result_table
  ON  todo_table.id = result_table.todo_id
</code></pre>
<h3 id="出力結果"><a class="header" href="#出力結果">出力結果</a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL 練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP 課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td><td align="right">NULL</td><td align="right">NULL</td></tr>
</tbody></table>
<h3 id="参考inner-join"><a class="header" href="#参考inner-join">【参考】INNER JOIN</a></h3>
<p><code>LEFT OUTER JOIN</code>の代わりに<code>INNER JOIN</code>を使用すると下記のテーブルが得られる．</p>
<p>（結合元のどちらかのテーブルでデータが欠損している場合は結合結果に表示されない）</p>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL 練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP 課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="画面に結合したデータを表示"><a class="header" href="#画面に結合したデータを表示">画面に結合したデータを表示</a></h3>
<p>一覧画面で上記のデータを参照し，画面に集計結果を表示する．</p>
<pre><code class="language-php">// todo_read.php

// 省略

$sql = 'SELECT * FROM todo_table LEFT OUTER JOIN (SELECT todo_id, COUNT(id) AS like_count FROM like_table GROUP BY todo_id) AS result_table ON todo_table.id = result_table.todo_id';

// タグ生成部分

foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      // ↓ここに`$record[&quot;like_count&quot;]`を追加！
      &lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like{$record[&quot;like_count&quot;]}&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<h2 id="練習-29"><a class="header" href="#練習-29">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ol>
<li><code>GROUP BY</code>を使って like_table のデータを集計しよう（phpmyadmin で確認）．</li>
<li><code>JOIN</code>を使用して<code>todo_table</code>と集計結果のテーブルを結合しよう（phpmyadmin で確認）．</li>
<li>2 で結合したテーブルを用いて，todo 一覧画面に集計結果を表示しよう．</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-6"><a class="header" href="#課題-6">課題</a></h1>
<p><strong>集計や結合を利用したアプリケーションを実装しよう</strong></p>
<p>集計や結合を使うことで既存のWebサービスの細かい処理も実装できるようになる．</p>
<p>Twitterの機能をコピーしてみる，ECサイトの仕組み（カートやお気に入り機能）を実装してみる，などもテーブル設計のヒントが得られるだろう．</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
