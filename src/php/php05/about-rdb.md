# RDB の構造

## RDB（Relational Database）とは

### 複雑なデータが必要なとき

- 一つのテーブルから取得できる情報は限られている．
- EC で購入したユーザの情報と商品の情報を両方取得したい場合は．．？？

### 複数のテーブル同士を連携（relation）させるッ！！

- テーブルの設計段階で連携させたい id のカラムをつくっておく！
- 両方のテーブルを関連付けるテーブルを「SQL で」作成する！
- 大事なのはデータの構造を見極めること！！

まずは下記 2 種類のデータ構造をマスターしよう！

## One to Many（学部テーブルと学生テーブル）

一つの学部には複数の学生が在籍するが，学生の所属は一つ．

### 学部テーブル（department_table）

|  id | name     |
| --: | -------- |
|   1 | 工学部   |
|   2 | 理学部   |
|   3 | 医学部   |
|   4 | 歯学部   |
|   5 | 農学部   |
|   6 | 文学部   |
|   7 | 経済学部 |

### 学生テーブル（student_table）

|  id | name                     |
| --: | ------------------------ |
|   1 | ディオ・ブランドー       |
|   2 | ツェペリ                 |
|   3 | リサリサ                 |
|   4 | カーズ                   |
|   5 | 花京院典明               |
|   6 | DIO                      |
|   7 | 吉良吉影                 |
|   8 | 川尻早人                 |
|   9 | パンナコッタ・フーゴ     |
|  10 | ディアボロ               |
|  11 | エルメェス・コステロ     |
|  12 | エンリコ・プッチ         |
|  13 | ジャイロ・ツェペリ       |
|  14 | ファニー・ヴァレンタイン |

「多」の側に対応する id を入れる構造にすれば OK．

誰がどこに所属しているかがわかるようになる！

|  id | name                     | department_id |
| --: | ------------------------ | ------------: |
|   1 | ディオ・ブランドー       |             1 |
|   2 | ツェペリ                 |             1 |
|   3 | リサリサ                 |             2 |
|   4 | カーズ                   |             2 |
|   5 | 花京院典明               |             3 |
|   6 | DIO                      |             3 |
|   7 | 吉良吉影                 |             4 |
|   8 | 川尻早人                 |             4 |
|   9 | パンナコッタ・フーゴ     |             5 |
|  10 | ディアボロ               |             5 |
|  11 | エルメェス・コステロ     |             6 |
|  12 | エンリコ・プッチ         |             6 |
|  13 | ジャイロ・ツェペリ       |             7 |
|  14 | ファニー・ヴァレンタイン |             7 |

## Many to Many（学生テーブルと講義テーブル）

学生は複数の講義を選択し，講義も複数の学生に提供される．

### 学生テーブル（student_table）

| student_id | name                     |
| ---------: | ------------------------ |
|          1 | ディオ・ブランドー       |
|          2 | ツェペリ                 |
|          3 | リサリサ                 |
|          4 | カーズ                   |
|          5 | 花京院典明               |
|          6 | DIO                      |
|          7 | 吉良吉影                 |
|          8 | 川尻早人                 |
|          9 | パンナコッタ・フーゴ     |
|         10 | ディアボロ               |
|         11 | エルメェス・コステロ     |
|         12 | エンリコ・プッチ         |
|         13 | ジャイロ・ツェペリ       |
|         14 | ファニー・ヴァレンタイン |

### 講義テーブル（class_table）

| class_id | name       |
| -------: | ---------- |
|        1 | 線形代数学 |
|        2 | 微分積分学 |
|        3 | 電子回路   |
|        4 | 電気回路   |
|        5 | 情報学     |
|        6 | 情報数学   |
|        7 | 統計学     |
|        8 | 信号処理   |
|        9 | 電磁気学   |

### 中間テーブル

この場合，「どの講義を」「どの学生が選択するか」を表す別のテーブルを作成する．

このテーブルのことを「中間テーブル」と呼ぶ．

| class_id | student_id |
| -------: | ---------: |
|        1 |          1 |
|        1 |          2 |
|        1 |          7 |
|        7 |          7 |
|        3 |          9 |
|        1 |          6 |
|        3 |          1 |
|        5 |          5 |
|        7 |          5 |

## テーブルの設計

データ構造を考える際には，「どうすればうまくいくか」よりも「このパターンはマズイ」を押さえるとうまくいきやすい．

マズイパターンのことを「アンチパターン」と呼ぶが，まずは下記のパターンがないかどうか確認しよう．

### 💡 Key Point

> 出やすいアンチパターン
>
> - ユーザの操作でテーブルが増える（減る）．
> - ユーザの操作でカラムが増える（減る）．
> - 一つのセル（でいいのかな？）に複数のデータ（数値など）が入る．
> - なにかのデータを更新したときに，別のテーブルのデータを更新する必要がある．
